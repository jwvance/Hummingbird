C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE USB_STD
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\USB_std.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.0\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -Generated_Source\PSoC3\USB_std.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB WL(2) PR(.\
                    -DP8051\DP8051_Keil_951\Debug/USB_std.lst) CD OT(2,SIZE) OJ(.\DP8051\DP8051_Keil_951\Debug\USB_std.obj)

line level    source

   1          /*******************************************************************************
   2          * File Name: USB_std.c
   3          * Version 2.70
   4          *
   5          * Description:
   6          *  USB Standard request handler.
   7          *
   8          * Note:
   9          *
  10          ********************************************************************************
  11          * Copyright 2008-2013, Cypress Semiconductor Corporation.  All rights reserved.
  12          * You may use this file only in accordance with the license, terms, conditions,
  13          * disclaimers, and limitations in the end user license agreement accompanying
  14          * the software package with which this file was provided.
  15          *******************************************************************************/
  16          
  17          #include "USB.h"
  18          #include "USB_cdc.h"
  19          #include "USB_pvt.h"
  20          #if defined(USB_ENABLE_MIDI_STREAMING)
  21              #include "USB_midi.h"
  22          #endif /*  USB_ENABLE_MIDI_STREAMING*/
  23          
  24          
  25          /***************************************
  26          *   Static data allocation
  27          ***************************************/
  28          
  29          #if defined(USB_ENABLE_FWSN_STRING)
                  static volatile uint8 *USB_fwSerialNumberStringDescriptor;
                  static volatile uint8 USB_snStringConfirm = USB_FALSE;
              #endif  /* USB_ENABLE_FWSN_STRING */
  33          
  34          #if defined(USB_ENABLE_FWSN_STRING)
              
                  /*******************************************************************************
                  * Function Name: USB_SerialNumString
                  ********************************************************************************
                  *
                  * Summary:
                  *  Application firmware may supply the source of the USB device descriptors
                  *  serial number string during runtime.
                  *
                  * Parameters:
                  *  snString:  pointer to string.
                  *
                  * Return:
                  *  None.
                  *
                  * Reentrant:
                  *  No.
                  *
                  *******************************************************************************/
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 2   

                  void  USB_SerialNumString(uint8 snString[]) 
                  {
                      USB_snStringConfirm = USB_FALSE;
                      if(snString != NULL)
                      {
                          /* Check descriptor validation */
                          if( (snString[0u] > 1u ) && (snString[1u] == USB_DESCR_STRING) )
                          {
                              USB_fwSerialNumberStringDescriptor = snString;
                              USB_snStringConfirm = USB_TRUE;
                          }
                      }
                  }
              
              #endif  /* USB_ENABLE_FWSN_STRING */
  69          
  70          
  71          /*******************************************************************************
  72          * Function Name: USB_HandleStandardRqst
  73          ********************************************************************************
  74          *
  75          * Summary:
  76          *  This Routine dispatches standard requests
  77          *
  78          * Parameters:
  79          *  None.
  80          *
  81          * Return:
  82          *  TRUE if request handled.
  83          *
  84          * Reentrant:
  85          *  No.
  86          *
  87          *******************************************************************************/
  88          uint8 USB_HandleStandardRqst(void) 
  89          {
  90   1          uint8 requestHandled = USB_FALSE;
  91   1          uint8 interfaceNumber;
  92   1          uint8 configurationN;
  93   1          #if defined(USB_ENABLE_STRINGS)
  94   1              volatile uint8 *pStr = 0u;
  95   1              #if defined(USB_ENABLE_DESCRIPTOR_STRINGS)
  96   1                  uint8 nStr;
  97   1                  uint8 descrLength;
  98   1              #endif /* USB_ENABLE_DESCRIPTOR_STRINGS */
  99   1          #endif /* USB_ENABLE_STRINGS */
 100   1          static volatile uint8 USB_tBuffer[USB_STATUS_LENGTH_MAX];
 101   1          const T_USB_LUT CYCODE *pTmp;
 102   1          USB_currentTD.count = 0u;
 103   1      
 104   1          if ((CY_GET_REG8(USB_bmRequestType) & USB_RQST_DIR_MASK) == USB_RQST_DIR_D2H)
 105   1          {
 106   2              /* Control Read */
 107   2              switch (CY_GET_REG8(USB_bRequest))
 108   2              {
 109   3                  case USB_GET_DESCRIPTOR:
 110   3                      if (CY_GET_REG8(USB_wValueHi) == USB_DESCR_DEVICE)
 111   3                      {
 112   4                          pTmp = USB_GetDeviceTablePtr();
 113   4                          USB_currentTD.pData = (volatile uint8 *)pTmp->p_list;
 114   4                          USB_currentTD.count = USB_DEVICE_DESCR_LENGTH;
 115   4                          requestHandled  = USB_InitControlRead();
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 3   

 116   4                      }
 117   3                      else if (CY_GET_REG8(USB_wValueHi) == USB_DESCR_CONFIG)
 118   3                      {
 119   4                          pTmp = USB_GetConfigTablePtr(CY_GET_REG8(USB_wValueLo));
 120   4                          if( pTmp != NULL )  /* Verify that requested descriptor exists */
 121   4                          {
 122   5                              USB_currentTD.pData = (volatile uint8 *)pTmp->p_list;
 123   5                              USB_currentTD.count = ((uint16)(USB_currentTD.pData)[ \
 124   5                                                USB_CONFIG_DESCR_TOTAL_LENGTH_HI] << 8u) | \
 125   5                                               (USB_currentTD.pData)[USB_CONFIG_DESCR_TOTAL_LENGTH_LOW];
 126   5                              requestHandled  = USB_InitControlRead();
 127   5                          }
 128   4                      }
 129   3                      #if defined(USB_ENABLE_STRINGS)
 130   3                      else if (CY_GET_REG8(USB_wValueHi) == USB_DESCR_STRING)
 131   3                      {
 132   4                          /* Descriptor Strings*/
 133   4                          #if defined(USB_ENABLE_DESCRIPTOR_STRINGS)
 134   4                              nStr = 0u;
 135   4                              pStr = (volatile uint8 *)&USB_STRING_DESCRIPTORS[0u];
 136   4                              while ( (CY_GET_REG8(USB_wValueLo) > nStr) && (*pStr != 0u) )
 137   4                              {
 138   5                                  /* Read descriptor length from 1st byte */
 139   5                                  descrLength = *pStr;
 140   5                                  /* Move to next string descriptor */
 141   5                                  pStr = &pStr[descrLength];
 142   5                                  nStr++;
 143   5                              }
 144   4                          #endif /*  USB_ENABLE_DESCRIPTOR_STRINGS */
 145   4                          /* Microsoft OS String*/
 146   4                          #if defined(USB_ENABLE_MSOS_STRING)
 147   4                              if( CY_GET_REG8(USB_wValueLo) == USB_STRING_MSOS )
 148   4                              {
 149   5                                  pStr = (volatile uint8 *)&USB_MSOS_DESCRIPTOR[0u];
 150   5                              }
 151   4                          #endif /*  USB_ENABLE_MSOS_STRING*/
 152   4                          /* SN string */
 153   4                          #if defined(USB_ENABLE_SN_STRING)
 154   4                              if( (CY_GET_REG8(USB_wValueLo) != 0u) &&
 155   4                                  (CY_GET_REG8(USB_wValueLo) ==
 156   4                                  USB_DEVICE0_DESCR[USB_DEVICE_DESCR_SN_SHIFT]) )
 157   4                              {
 158   5                                  
 159   5                                  #if defined(USB_ENABLE_IDSN_STRING)
 160   5                                      /* Read DIE ID and generate string descriptor in RAM */
 161   5                                      USB_ReadDieID(USB_idSerialNumberStringDescriptor);
 162   5                                      pStr = USB_idSerialNumberStringDescriptor;
 163   5                                  #elif defined(USB_ENABLE_FWSN_STRING)
                                              if(USB_snStringConfirm != USB_FALSE)
                                              {
                                                  pStr = USB_fwSerialNumberStringDescriptor;
                                              }
                                              else
                                              {
                                                  pStr = (volatile uint8 *)&USB_SN_STRING_DESCRIPTOR[0u];
                                              }
                                          #else
                                              pStr = (volatile uint8 *)&USB_SN_STRING_DESCRIPTOR[0u];
                                          #endif  /* defined(USB_ENABLE_IDSN_STRING) */
 175   5                              }
 176   4                          #endif    /*  USB_ENABLE_SN_STRING */
 177   4                          if (*pStr != 0u)
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 4   

 178   4                          {
 179   5                              USB_currentTD.count = *pStr;
 180   5                              USB_currentTD.pData = pStr;
 181   5                              requestHandled  = USB_InitControlRead();
 182   5                          }
 183   4                      }
 184   3                      #endif /*  USB_ENABLE_STRINGS */
 185   3                      else
 186   3                      {
 187   4                          requestHandled = USB_DispatchClassRqst();
 188   4                      }
 189   3                      break;
 190   3                  case USB_GET_STATUS:
 191   3                      switch ((CY_GET_REG8(USB_bmRequestType) & USB_RQST_RCPT_MASK))
 192   3                      {
 193   4                          case USB_RQST_RCPT_EP:
 194   4                              USB_currentTD.count = USB_EP_STATUS_LENGTH;
 195   4                              USB_tBuffer[0u] = USB_EP[ \
 196   4                                              CY_GET_REG8(USB_wIndexLo) & USB_DIR_UNUSED].hwEpState;
 197   4                              USB_tBuffer[1u] = 0u;
 198   4                              USB_currentTD.pData = &USB_tBuffer[0u];
 199   4                              requestHandled  = USB_InitControlRead();
 200   4                              break;
 201   4                          case USB_RQST_RCPT_DEV:
 202   4                              USB_currentTD.count = USB_DEVICE_STATUS_LENGTH;
 203   4                              USB_tBuffer[0u] = USB_deviceStatus;
 204   4                              USB_tBuffer[1u] = 0u;
 205   4                              USB_currentTD.pData = &USB_tBuffer[0u];
 206   4                              requestHandled  = USB_InitControlRead();
 207   4                              break;
 208   4                          default:    /* requestHandled is initialized as FALSE by default */
 209   4                              break;
 210   4                      }
 211   3                      break;
 212   3                  case USB_GET_CONFIGURATION:
 213   3                      USB_currentTD.count = 1u;
 214   3                      USB_currentTD.pData = (volatile uint8 *)&USB_configuration;
 215   3                      requestHandled  = USB_InitControlRead();
 216   3                      break;
 217   3                  case USB_GET_INTERFACE:
 218   3                      USB_currentTD.count = 1u;
 219   3                      USB_currentTD.pData = (volatile uint8 *)&USB_interfaceSetting[ \
 220   3                                                                                  CY_GET_REG8(USB_wIndexLo)];
 221   3                      requestHandled  = USB_InitControlRead();
 222   3                      break;
 223   3                  default: /* requestHandled is initialized as FALSE by default */
 224   3                      break;
 225   3              }
 226   2          }
 227   1          else {
 228   2              /* Control Write */
 229   2              switch (CY_GET_REG8(USB_bRequest))
 230   2              {
 231   3                  case USB_SET_ADDRESS:
 232   3                      USB_deviceAddress = CY_GET_REG8(USB_wValueLo);
 233   3                      requestHandled = USB_InitNoDataControlTransfer();
 234   3                      break;
 235   3                  case USB_SET_CONFIGURATION:
 236   3                      configurationN = CY_GET_REG8(USB_wValueLo);
 237   3                      if(configurationN > 0)
 238   3                      {   /* Verify that configuration descriptor exists */
 239   4                          pTmp = USB_GetConfigTablePtr(configurationN - 1u);
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 5   

 240   4                      }
 241   3                      /* Responds with a Request Error when configuration number is invalid */
 242   3                      if (((configurationN > 0) && (pTmp != NULL)) || (configurationN == 0u))
 243   3                      {
 244   4                          /* Set new configuration if it has been changed */
 245   4                          if(configurationN != USB_configuration)        
 246   4                          {
 247   5                              USB_configuration = configurationN;
 248   5                              USB_configurationChanged = USB_TRUE;
 249   5                              USB_Config(USB_TRUE);
 250   5                          }
 251   4                          requestHandled = USB_InitNoDataControlTransfer();
 252   4                      }
 253   3                      break;
 254   3                  case USB_SET_INTERFACE:
 255   3                      if (USB_ValidateAlternateSetting() != 0u)
 256   3                      {
 257   4                          interfaceNumber = CY_GET_REG8(USB_wIndexLo);
 258   4                          USB_interfaceNumber = interfaceNumber;
 259   4                          USB_configurationChanged = USB_TRUE;
 260   4                          #if ((USB_EP_MA == USB__MA_DYNAMIC) && \
 261   4                               (USB_EP_MM == USB__EP_MANUAL) )
                                      USB_Config(USB_FALSE);
                                  #else
 264   4                              USB_ConfigAltChanged();
 265   4                          #endif /*  (USB_EP_MA == USB__MA_DYNAMIC) */
 266   4                          /* Update handled Alt setting changes status */
 267   4                          USB_interfaceSetting_last[interfaceNumber] =
 268   4                               USB_interfaceSetting[interfaceNumber];
 269   4                          requestHandled = USB_InitNoDataControlTransfer();
 270   4                      }
 271   3                      break;
 272   3                  case USB_CLEAR_FEATURE:
 273   3                      switch (CY_GET_REG8(USB_bmRequestType) & USB_RQST_RCPT_MASK)
 274   3                      {
 275   4                          case USB_RQST_RCPT_EP:
 276   4                              if (CY_GET_REG8(USB_wValueLo) == USB_ENDPOINT_HALT)
 277   4                              {
 278   5                                  requestHandled = USB_ClearEndpointHalt();
 279   5                              }
 280   4                              break;
 281   4                          case USB_RQST_RCPT_DEV:
 282   4                              /* Clear device REMOTE_WAKEUP */
 283   4                              if (CY_GET_REG8(USB_wValueLo) == USB_DEVICE_REMOTE_WAKEUP)
 284   4                              {
 285   5                                  USB_deviceStatus &= (uint8)~USB_DEVICE_STATUS_REMOTE_WAKEUP;
 286   5                                  requestHandled = USB_InitNoDataControlTransfer();
 287   5                              }
 288   4                              break;
 289   4                          case USB_RQST_RCPT_IFC:
 290   4                              /* Validate interfaceNumber */
 291   4                              if (CY_GET_REG8(USB_wIndexLo) < USB_MAX_INTERFACES_NUMBER)
 292   4                              {
 293   5                                  USB_interfaceStatus[CY_GET_REG8(USB_wIndexLo)] &=
 294   5                                                                      (uint8)~(CY_GET_REG8(USB_wValueLo));
 295   5                                  requestHandled = USB_InitNoDataControlTransfer();
 296   5                              }
 297   4                              break;
 298   4                          default:    /* requestHandled is initialized as FALSE by default */
 299   4                              break;
 300   4                      }
 301   3                      break;
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 6   

 302   3                  case USB_SET_FEATURE:
 303   3                      switch (CY_GET_REG8(USB_bmRequestType) & USB_RQST_RCPT_MASK)
 304   3                      {
 305   4                          case USB_RQST_RCPT_EP:
 306   4                              if (CY_GET_REG8(USB_wValueLo) == USB_ENDPOINT_HALT)
 307   4                              {
 308   5                                  requestHandled = USB_SetEndpointHalt();
 309   5                              }
 310   4                              break;
 311   4                          case USB_RQST_RCPT_DEV:
 312   4                              /* Set device REMOTE_WAKEUP */
 313   4                              if (CY_GET_REG8(USB_wValueLo) == USB_DEVICE_REMOTE_WAKEUP)
 314   4                              {
 315   5                                  USB_deviceStatus |= USB_DEVICE_STATUS_REMOTE_WAKEUP;
 316   5                                  requestHandled = USB_InitNoDataControlTransfer();
 317   5                              }
 318   4                              break;
 319   4                          case USB_RQST_RCPT_IFC:
 320   4                              /* Validate interfaceNumber */
 321   4                              if (CY_GET_REG8(USB_wIndexLo) < USB_MAX_INTERFACES_NUMBER)
 322   4                              {
 323   5                                  USB_interfaceStatus[CY_GET_REG8(USB_wIndexLo)] &=
 324   5                                                                      (uint8)~(CY_GET_REG8(USB_wValueLo));
 325   5                                  requestHandled = USB_InitNoDataControlTransfer();
 326   5                              }
 327   4                              break;
 328   4                          default:    /* requestHandled is initialized as FALSE by default */
 329   4                              break;
 330   4                      }
 331   3                      break;
 332   3                  default:    /* requestHandled is initialized as FALSE by default */
 333   3                      break;
 334   3              }
 335   2          }
 336   1          return(requestHandled);
 337   1      }
 338          
 339          
 340          #if defined(USB_ENABLE_IDSN_STRING)
 341          
 342              /***************************************************************************
 343              * Function Name: USB_ReadDieID
 344              ****************************************************************************
 345              *
 346              * Summary:
 347              *  This routine read Die ID and generate Serial Number string descriptor.
 348              *
 349              * Parameters:
 350              *  descr:  pointer on string descriptor.
 351              *
 352              * Return:
 353              *  None.
 354              *
 355              * Reentrant:
 356              *  No.
 357              *
 358              ***************************************************************************/
 359              void USB_ReadDieID(uint8 descr[]) 
 360              {
 361   1              uint8 i;
 362   1              uint8 j = 0u;
 363   1              uint8 value;
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 7   

 364   1              const char8 CYCODE hex[16u] = "0123456789ABCDEF";
 365   1      
 366   1              /* Check descriptor validation */
 367   1              if( descr != NULL)
 368   1              {
 369   2                  descr[0u] = USB_IDSN_DESCR_LENGTH;
 370   2                  descr[1u] = USB_DESCR_STRING;
 371   2      
 372   2                  /* fill descriptor */
 373   2                  for(i = 2u; i < USB_IDSN_DESCR_LENGTH; i += 4u)
 374   2                  {
 375   3                      value = CY_GET_XTND_REG8((void CYFAR *)(USB_DIE_ID + j));
 376   3                      j++;
 377   3                      descr[i] = (uint8)hex[value >> 4u];
 378   3                      descr[i + 2u] = (uint8)hex[value & 0x0Fu];
 379   3                  }
 380   2              }
 381   1          }
 382          
 383          #endif /*  USB_ENABLE_IDSN_STRING */
 384          
 385          
 386          /*******************************************************************************
 387          * Function Name: USB_ConfigReg
 388          ********************************************************************************
 389          *
 390          * Summary:
 391          *  This routine configures hardware registers from the variables.
 392          *  It is called from USB_Config() function and from RestoreConfig
 393          *  after Wakeup.
 394          *
 395          * Parameters:
 396          *  None.
 397          *
 398          * Return:
 399          *  None.
 400          *
 401          *******************************************************************************/
 402          void USB_ConfigReg(void) CYREENTRANT
 403          {
 404   1          uint8 ep;
 405   1          uint8 i;
 406   1          #if(USB_EP_MM == USB__EP_DMAAUTO)
                      uint8 epType = 0u;
                  #endif /*  USB_EP_MM == USB__EP_DMAAUTO */
 409   1      
 410   1          /* Set the endpoint buffer addresses */
 411   1          ep = USB_EP1;
 412   1          for (i = 0u; i < 0x80u; i+= 0x10u)
 413   1          {
 414   2              CY_SET_REG8((reg8 *)(USB_ARB_EP1_CFG_IND + i), USB_ARB_EPX_CFG_DEFAULT);
 415   2              #if(USB_EP_MM != USB__EP_MANUAL)
                          /* Enable all Arbiter EP Interrupts : err, buf under, buf over, dma gnt(mode2 only), in buf fu
             -ll */
                          CY_SET_REG8((reg8 *)(USB_ARB_EP1_INT_EN_IND + i), USB_ARB_EPX_INT_MASK);
                      #endif   /*  USB_EP_MM != USB__EP_MANUAL */
 419   2      
 420   2              if(USB_EP[ep].epMode != USB_MODE_DISABLE)
 421   2              {
 422   3                  if((USB_EP[ep].addr & USB_DIR_IN) != 0u )
 423   3                  {
 424   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + i), USB_MODE_NAK_IN);
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 8   

 425   4                  }
 426   3                  else
 427   3                  {
 428   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + i), USB_MODE_NAK_OUT);
 429   4                      /* Prepare EP type mask for automatic memory allocation */
 430   4                      #if(USB_EP_MM == USB__EP_DMAAUTO)
                                  epType |= (uint8)(0x01u << (ep - USB_EP1));
                              #endif /*  USB_EP_MM == USB__EP_DMAAUTO */
 433   4                  }
 434   3              }
 435   2              else
 436   2              {
 437   3                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + i), USB_MODE_STALL_DATA_EP);
 438   3              }
 439   2      
 440   2              #if(USB_EP_MM != USB__EP_DMAAUTO)
 441   2                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CNT0_IND + i),   USB_EP[ep].bufferSize >> 8u);
 442   2                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CNT1_IND + i),   USB_EP[ep].bufferSize & 0xFFu);
 443   2      
 444   2                  CY_SET_REG8((reg8 *)(USB_ARB_RW1_RA_IND + i),     USB_EP[ep].buffOffset & 0xFFu);
 445   2                  CY_SET_REG8((reg8 *)(USB_ARB_RW1_RA_MSB_IND + i), USB_EP[ep].buffOffset >> 8u);
 446   2                  CY_SET_REG8((reg8 *)(USB_ARB_RW1_WA_IND + i),     USB_EP[ep].buffOffset & 0xFFu);
 447   2                  CY_SET_REG8((reg8 *)(USB_ARB_RW1_WA_MSB_IND + i), USB_EP[ep].buffOffset >> 8u);
 448   2              #endif /*  USB_EP_MM != USB__EP_DMAAUTO */
 449   2      
 450   2              ep++;
 451   2          }
 452   1      
 453   1          #if(USB_EP_MM == USB__EP_DMAAUTO)
                       /* BUF_SIZE depend on DMA_THRESS value: 55-32 bytes  44-16 bytes 33-8 bytes 22-4 bytes 11-2 bytes
             - */
                      USB_BUF_SIZE_REG = USB_DMA_BUF_SIZE;
                      USB_DMA_THRES_REG = USB_DMA_BYTES_PER_BURST;   /* DMA burst threshold */
                      USB_DMA_THRES_MSB_REG = 0u;
                      USB_EP_ACTIVE_REG = USB_ARB_INT_MASK;
                      USB_EP_TYPE_REG = epType;
                      /* Cfg_cmp bit set to 1 once configuration is complete. */
                      USB_ARB_CFG_REG = USB_ARB_CFG_AUTO_DMA | USB_ARB_CFG_AUTO_MEM |
                                                     USB_ARB_CFG_CFG_CPM;
                      /* Cfg_cmp bit set to 0 during configuration of PFSUSB Registers. */
                      USB_ARB_CFG_REG = USB_ARB_CFG_AUTO_DMA | USB_ARB_CFG_AUTO_MEM;
                  #endif /*  USB_EP_MM == USB__EP_DMAAUTO */
 466   1      
 467   1          CY_SET_REG8(USB_SIE_EP_INT_EN_PTR, 0xFFu);
 468   1      }
 469          
 470          
 471          /*******************************************************************************
 472          * Function Name: USB_Config
 473          ********************************************************************************
 474          *
 475          * Summary:
 476          *  This routine configures endpoints for the entire configuration by scanning
 477          *  the configuration descriptor.
 478          *
 479          * Parameters:
 480          *  clearAltSetting: It configures the bAlternateSetting 0 for each interface.
 481          *
 482          * Return:
 483          *  None.
 484          *
 485          * USB_interfaceClass - Initialized class array for each interface.
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 9   

 486          *   It is used for handling Class specific requests depend on interface class.
 487          *   Different classes in multiple Alternate settings does not supported.
 488          *
 489          * Reentrant:
 490          *  No.
 491          *
 492          *******************************************************************************/
 493          void USB_Config(uint8 clearAltSetting) CYREENTRANT
 494          {
 495   1          uint8 ep;
 496   1          uint8 cur_ep;
 497   1          uint8 i;
 498   1          uint8 epType;
 499   1          const uint8 *pDescr;
 500   1          #if(USB_EP_MM != USB__EP_DMAAUTO)
 501   1              uint16 buffCount = 0u;
 502   1          #endif /*  USB_EP_MM != USB__EP_DMAAUTO */
 503   1      
 504   1          const T_USB_LUT CYCODE *pTmp;
 505   1          const T_USB_EP_SETTINGS_BLOCK CYCODE *pEP;
 506   1      
 507   1          /* Clear all of the endpoints */
 508   1          for (ep = 0u; ep < USB_MAX_EP; ep++)
 509   1          {
 510   2              USB_EP[ep].attrib = 0u;
 511   2              USB_EP[ep].hwEpState = 0u;
 512   2              USB_EP[ep].apiEpState = USB_NO_EVENT_PENDING;
 513   2              USB_EP[ep].epToggle = 0u;
 514   2              USB_EP[ep].epMode = USB_MODE_DISABLE;
 515   2              USB_EP[ep].bufferSize = 0u;
 516   2              USB_EP[ep].interface = 0u;
 517   2      
 518   2          }
 519   1      
 520   1          /* Clear Alternate settings for all interfaces */
 521   1          if(clearAltSetting != 0u)
 522   1          {
 523   2              for (i = 0u; i < USB_MAX_INTERFACES_NUMBER; i++)
 524   2              {
 525   3                  USB_interfaceSetting[i] = 0x00u;
 526   3                  USB_interfaceSetting_last[i] = 0x00u;
 527   3              }
 528   2          }
 529   1      
 530   1          /* Init Endpoints and Device Status if configured */
 531   1          if(USB_configuration > 0u)
 532   1          {
 533   2              pTmp = USB_GetConfigTablePtr(USB_configuration - 1u);
 534   2              /* Set Power status for current configuration */
 535   2              pDescr = (const uint8 *)pTmp->p_list;
 536   2              if((pDescr[USB_CONFIG_DESCR_ATTRIB] & USB_CONFIG_DESCR_ATTRIB_SELF_POWERED) != 0u)
 537   2              {
 538   3                  USB_deviceStatus |=  USB_DEVICE_STATUS_SELF_POWERED;
 539   3              }
 540   2              else
 541   2              {
 542   3                  USB_deviceStatus &=  (uint8)~USB_DEVICE_STATUS_SELF_POWERED;
 543   3              }
 544   2              /* Move to next element */
 545   2              pTmp = &pTmp[1u];
 546   2              ep = pTmp->c;  /* For this table, c is the number of endpoints configurations  */
 547   2      
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 10  

 548   2              #if ((USB_EP_MA == USB__MA_DYNAMIC) && \
 549   2                   (USB_EP_MM == USB__EP_MANUAL) )
                          /* Configure for dynamic EP memory allocation */
                          /* p_list points the endpoint setting table. */
                          pEP = (T_USB_EP_SETTINGS_BLOCK *) pTmp->p_list;
                          for (i = 0u; i < ep; i++)
                          {
                              /* Compare current Alternate setting with EP Alt */
                              if(USB_interfaceSetting[pEP->interface] == pEP->altSetting)
                              {
                                  cur_ep = pEP->addr & USB_DIR_UNUSED;
                                  epType = pEP->attributes & USB_EP_TYPE_MASK;
                                  if (pEP->addr & USB_DIR_IN)
                                  {
                                      /* IN Endpoint */
                                      USB_EP[cur_ep].apiEpState = USB_EVENT_PENDING;
                                      USB_EP[cur_ep].epMode = (epType == USB_EP_TYPE_ISOC) ?
                                                                      USB_MODE_ISO_IN : USB_MODE_ACK_IN;
                                      #if defined(USB_ENABLE_CDC_CLASS)
                                          if(((pEP->bMisc == USB_CLASS_CDC_DATA) ||
                                              (pEP->bMisc == USB_CLASS_CDC)) &&
                                              (epType != USB_EP_TYPE_INT))
                                          {
                                              USB_cdc_data_in_ep = cur_ep;
                                          }
                                      #endif  /*  USB_ENABLE_CDC_CLASS*/
                                      #if ( defined(USB_ENABLE_MIDI_STREAMING) && \
                                                           (USB_MIDI_IN_BUFF_SIZE > 0) )
                                          if((pEP->bMisc == USB_CLASS_AUDIO) &&
                                             (epType == USB_EP_TYPE_BULK))
                                          {
                                              USB_midi_in_ep = cur_ep;
                                          }
                                      #endif  /*  USB_ENABLE_MIDI_STREAMING*/
                                  }
                                  else
                                  {
                                      /* OUT Endpoint */
                                      USB_EP[cur_ep].apiEpState = USB_NO_EVENT_PENDING;
                                      USB_EP[cur_ep].epMode = (epType == USB_EP_TYPE_ISOC) ?
                                                                  USB_MODE_ISO_OUT : USB_MODE_ACK_OUT;
                                      #if defined(USB_ENABLE_CDC_CLASS)
                                          if(((pEP->bMisc == USB_CLASS_CDC_DATA) ||
                                              (pEP->bMisc == USB_CLASS_CDC)) &&
                                              (epType != USB_EP_TYPE_INT))
                                          {
                                              USB_cdc_data_out_ep = cur_ep;
                                          }
                                      #endif  /*  USB_ENABLE_CDC_CLASS*/
                                      #if ( defined(USB_ENABLE_MIDI_STREAMING) && \
                                                   (USB_MIDI_OUT_BUFF_SIZE > 0) )
                                          if((pEP->bMisc == USB_CLASS_AUDIO) &&
                                             (epType == USB_EP_TYPE_BULK))
                                          {
                                              USB_midi_out_ep = cur_ep;
                                          }
                                      #endif  /*  USB_ENABLE_MIDI_STREAMING*/
                                  }
                                  USB_EP[cur_ep].bufferSize = pEP->bufferSize;
                                  USB_EP[cur_ep].addr = pEP->addr;
                                  USB_EP[cur_ep].attrib = pEP->attributes;
                              }
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 11  

                              pEP = &pEP[1u];
                          }
                      #else /* Configure for static EP memory allocation  */
 613   2                  for (i = USB_EP1; i < USB_MAX_EP; i++)
 614   2                  {
 615   3                      /* p_list points the endpoint setting table. */
 616   3                      pEP = (const T_USB_EP_SETTINGS_BLOCK CYCODE *) pTmp->p_list;
 617   3                      /* Find max length for each EP and select it (length could be different in different Alt s
             -ettings) */
 618   3                      /* but other settings should be correct with regards to Interface alt Setting */
 619   3                      for (cur_ep = 0u; cur_ep < ep; cur_ep++)
 620   3                      {
 621   4                          /* EP count is equal to EP # in table and we found larger EP length than have before*/
 622   4                          if(i == (pEP->addr & USB_DIR_UNUSED))
 623   4                          {
 624   5                              if(USB_EP[i].bufferSize < pEP->bufferSize)
 625   5                              {
 626   6                                  USB_EP[i].bufferSize = pEP->bufferSize;
 627   6                              }
 628   5                              /* Compare current Alternate setting with EP Alt*/
 629   5                              if(USB_interfaceSetting[pEP->interface] == pEP->altSetting)
 630   5                              {
 631   6                                  epType = pEP->attributes & USB_EP_TYPE_MASK;
 632   6                                  if ((pEP->addr & USB_DIR_IN) != 0u)
 633   6                                  {
 634   7                                      /* IN Endpoint */
 635   7                                      USB_EP[i].apiEpState = USB_EVENT_PENDING;
 636   7                                      USB_EP[i].epMode = (epType == USB_EP_TYPE_ISOC) ?
 637   7                                                              USB_MODE_ISO_IN : USB_MODE_ACK_IN;
 638   7                                      /* Find and initialize CDC IN endpoint number */
 639   7                                      #if defined(USB_ENABLE_CDC_CLASS)
                                                  if(((pEP->bMisc == USB_CLASS_CDC_DATA) ||
                                                      (pEP->bMisc == USB_CLASS_CDC)) &&
                                                      (epType != USB_EP_TYPE_INT))
                                                  {
                                                      USB_cdc_data_in_ep = i;
                                                  }
                                              #endif  /*  USB_ENABLE_CDC_CLASS*/
 647   7                                      #if ( defined(USB_ENABLE_MIDI_STREAMING) && \
 648   7                                                   (USB_MIDI_IN_BUFF_SIZE > 0) )
 649   7                                          if((pEP->bMisc == USB_CLASS_AUDIO) &&
 650   7                                             (epType == USB_EP_TYPE_BULK))
 651   7                                          {
 652   8                                              USB_midi_in_ep = i;
 653   8                                          }
 654   7                                      #endif  /*  USB_ENABLE_MIDI_STREAMING*/
 655   7                                  }
 656   6                                  else
 657   6                                  {
 658   7                                      /* OUT Endpoint */
 659   7                                      USB_EP[i].apiEpState = USB_NO_EVENT_PENDING;
 660   7                                      USB_EP[i].epMode = (epType == USB_EP_TYPE_ISOC) ?
 661   7                                                          USB_MODE_ISO_OUT : USB_MODE_ACK_OUT;
 662   7                                      /* Find and initialize CDC IN endpoint number */
 663   7                                      #if defined(USB_ENABLE_CDC_CLASS)
                                                  if(((pEP->bMisc == USB_CLASS_CDC_DATA) ||
                                                      (pEP->bMisc == USB_CLASS_CDC)) &&
                                                      (epType != USB_EP_TYPE_INT))
                                                  {
                                                      USB_cdc_data_out_ep = i;
                                                  }
                                              #endif  /*  USB_ENABLE_CDC_CLASS*/
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 12  

 671   7                                      #if ( defined(USB_ENABLE_MIDI_STREAMING) && \
 672   7                                                   (USB_MIDI_OUT_BUFF_SIZE > 0) )
 673   7                                          if((pEP->bMisc == USB_CLASS_AUDIO) &&
 674   7                                             (epType == USB_EP_TYPE_BULK))
 675   7                                          {
 676   8                                              USB_midi_out_ep = i;
 677   8                                          }
 678   7                                      #endif  /*  USB_ENABLE_MIDI_STREAMING*/
 679   7                                  }
 680   6                                  USB_EP[i].addr = pEP->addr;
 681   6                                  USB_EP[i].attrib = pEP->attributes;
 682   6      
 683   6                                  #if(USB_EP_MM == USB__EP_DMAAUTO)
                                              break;      /* use first EP setting in Auto memory managment */
                                          #endif /*  USB_EP_MM == USB__EP_DMAAUTO */
 686   6                              }
 687   5                          }
 688   4                          pEP = &pEP[1u];
 689   4                      }
 690   3                  }
 691   2              #endif /*  (USB_EP_MA == USB__MA_DYNAMIC) */
 692   2      
 693   2              /* Init class array for each interface and interface number for each EP.
 694   2              *  It is used for handling Class specific requests directed to either an
 695   2              *  interface or the endpoint.
 696   2              */
 697   2              /* p_list points the endpoint setting table. */
 698   2              pEP = (const T_USB_EP_SETTINGS_BLOCK CYCODE *) pTmp->p_list;
 699   2              for (i = 0u; i < ep; i++)
 700   2              {
 701   3                  /* Configure interface number for each EP*/
 702   3                  USB_EP[pEP->addr & USB_DIR_UNUSED].interface = pEP->interface;
 703   3                  pEP = &pEP[1u];
 704   3              }
 705   2              /* Init pointer on interface class table*/
 706   2              USB_interfaceClass = USB_GetInterfaceClassTablePtr();
 707   2              /* Set the endpoint buffer addresses */
 708   2      
 709   2              #if(USB_EP_MM != USB__EP_DMAAUTO)
 710   2                  for (ep = USB_EP1; ep < USB_MAX_EP; ep++)
 711   2                  {
 712   3                      USB_EP[ep].buffOffset = buffCount;
 713   3                       buffCount += USB_EP[ep].bufferSize;
 714   3                  }
 715   2              #endif /*  USB_EP_MM != USB__EP_DMAAUTO */
 716   2      
 717   2              /* Configure hardware registers */
 718   2              USB_ConfigReg();
 719   2          } /* USB_configuration > 0 */
 720   1      }
 721          
 722          
 723          /*******************************************************************************
 724          * Function Name: USB_ConfigAltChanged
 725          ********************************************************************************
 726          *
 727          * Summary:
 728          *  This routine update configuration for the required endpoints only.
 729          *  It is called after SET_INTERFACE request when Static memory allocation used.
 730          *
 731          * Parameters:
 732          *  None.
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 13  

 733          *
 734          * Return:
 735          *  None.
 736          *
 737          * Reentrant:
 738          *  No.
 739          *
 740          *******************************************************************************/
 741          void USB_ConfigAltChanged(void) 
 742          {
 743   1          uint8 ep;
 744   1          uint8 cur_ep;
 745   1          uint8 i;
 746   1          uint8 epType;
 747   1          uint8 ri;
 748   1      
 749   1          const T_USB_LUT CYCODE *pTmp;
 750   1          const T_USB_EP_SETTINGS_BLOCK CYCODE *pEP;
 751   1      
 752   1      
 753   1          /* Init Endpoints and Device Status if configured */
 754   1          if(USB_configuration > 0u)
 755   1          {
 756   2              pTmp = USB_GetConfigTablePtr(USB_configuration - 1u);
 757   2              pTmp = &pTmp[1u];
 758   2              ep = pTmp->c;  /* For this table, c is the number of endpoints configurations  */
 759   2      
 760   2              /* Do not touch EP which doesn't need reconfiguration */
 761   2              /* When Alt setting changed, the only required endpoints need to be reconfigured */
 762   2              /* p_list points the endpoint setting table. */
 763   2              pEP = (const T_USB_EP_SETTINGS_BLOCK CYCODE *) pTmp->p_list;
 764   2              for (i = 0u; i < ep; i++)
 765   2              {
 766   3                  /*If Alt setting changed and new is same with EP Alt */
 767   3                  if((USB_interfaceSetting[pEP->interface] !=
 768   3                      USB_interfaceSetting_last[pEP->interface] ) &&
 769   3                     (USB_interfaceSetting[pEP->interface] == pEP->altSetting) &&
 770   3                     (pEP->interface == CY_GET_REG8(USB_wIndexLo)))
 771   3                  {
 772   4                      cur_ep = pEP->addr & USB_DIR_UNUSED;
 773   4                      ri = ((cur_ep - USB_EP1) << USB_EPX_CNTX_ADDR_SHIFT);
 774   4                      epType = pEP->attributes & USB_EP_TYPE_MASK;
 775   4                      if ((pEP->addr & USB_DIR_IN) != 0u)
 776   4                      {
 777   5                          /* IN Endpoint */
 778   5                          USB_EP[cur_ep].apiEpState = USB_EVENT_PENDING;
 779   5                          USB_EP[cur_ep].epMode = (epType == USB_EP_TYPE_ISOC) ?
 780   5                                                      USB_MODE_ISO_IN : USB_MODE_ACK_IN;
 781   5                      }
 782   4                      else
 783   4                      {
 784   5                          /* OUT Endpoint */
 785   5                          USB_EP[cur_ep].apiEpState = USB_NO_EVENT_PENDING;
 786   5                          USB_EP[cur_ep].epMode = (epType == USB_EP_TYPE_ISOC) ?
 787   5                                                      USB_MODE_ISO_OUT : USB_MODE_ACK_OUT;
 788   5                      }
 789   4                       /* Change the SIE mode for the selected EP to NAK ALL */
 790   4                       CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_NAK_IN_OUT);
 791   4                      USB_EP[cur_ep].bufferSize = pEP->bufferSize;
 792   4                      USB_EP[cur_ep].addr = pEP->addr;
 793   4                      USB_EP[cur_ep].attrib = pEP->attributes;
 794   4      
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 14  

 795   4                      /* Clear the data toggle */
 796   4                      USB_EP[cur_ep].epToggle = 0u;
 797   4      
 798   4                      /* Dynamic reconfiguration for mode 3 transfer */
 799   4                  #if(USB_EP_MM == USB__EP_DMAAUTO)
                              /* In_data_rdy for selected EP should be set to 0 */
                              * (reg8 *)(USB_ARB_EP1_CFG_IND + ri) &= (uint8)~USB_ARB_EPX_CFG_IN_DATA_RDY;
              
                              /* write the EP number for which reconfiguration is required */
                              USB_DYN_RECONFIG_REG = (cur_ep - USB_EP1) <<
                                                                  USB_DYN_RECONFIG_EP_SHIFT;
                              /* Set the dyn_config_en bit in dynamic reconfiguration register */
                              USB_DYN_RECONFIG_REG |= USB_DYN_RECONFIG_ENABLE;
                              /* wait for the dyn_config_rdy bit to set by the block,
                              *  this bit will be set to 1 when block is ready for reconfiguration.
                              */
                              while((USB_DYN_RECONFIG_REG & USB_DYN_RECONFIG_RDY_STS) == 0u)
                              {
                                  ;
                              }
                              /* Once dyn_config_rdy bit is set, FW can change the EP configuration. */
                              /* Change EP Type with new direction */
                              if((pEP->addr & USB_DIR_IN) == 0u)
                              {
                                  USB_EP_TYPE_REG |= (uint8)(0x01u << (cur_ep - USB_EP1));
                              }
                              else
                              {
                                  USB_EP_TYPE_REG &= (uint8)~(uint8)(0x01u << (cur_ep - USB_EP1));
                              }
                              /* dynamic reconfiguration enable bit cleared, pointers and control/status
                              *  signals for the selected EP is cleared/re-initialized on negative edge
                              *  of dynamic reconfiguration enable bit).
                              */
                              USB_DYN_RECONFIG_REG &= (uint8)~USB_DYN_RECONFIG_ENABLE;
                              /* The main loop has to re-enable DMA and OUT endpoint*/
                          #else
 832   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CNT0_IND + ri),
 833   4                                                                      USB_EP[cur_ep].bufferSize >> 8u);
 834   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CNT1_IND + ri),
 835   4                                                                      USB_EP[cur_ep].bufferSize & 0xFFu);
 836   4                      CY_SET_REG8((reg8 *)(USB_ARB_RW1_RA_IND + ri),
 837   4                                                                      USB_EP[cur_ep].buffOffset & 0xFFu);
 838   4                      CY_SET_REG8((reg8 *)(USB_ARB_RW1_RA_MSB_IND + ri),
 839   4                                                                      USB_EP[cur_ep].buffOffset >> 8u);
 840   4                      CY_SET_REG8((reg8 *)(USB_ARB_RW1_WA_IND + ri),
 841   4                                                                      USB_EP[cur_ep].buffOffset & 0xFFu);
 842   4                      CY_SET_REG8((reg8 *)(USB_ARB_RW1_WA_MSB_IND + ri),
 843   4                                                                      USB_EP[cur_ep].buffOffset >> 8u);
 844   4                  #endif /*  USB_EP_MM == USB__EP_DMAAUTO */
 845   4                  }
 846   3                  /* Get next EP element */
 847   3                  pEP = &pEP[1u];
 848   3              }
 849   2          }   /* USB_configuration > 0 */
 850   1      }
 851          
 852          
 853          /*******************************************************************************
 854          * Function Name: USB_GetConfigTablePtr
 855          ********************************************************************************
 856          *
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 15  

 857          * Summary:
 858          *  This routine returns a pointer a configuration table entry
 859          *
 860          * Parameters:
 861          *  confIndex:  Configuration Index
 862          *
 863          * Return:
 864          *  Device Descriptor pointer or NULL when descriptor isn't exists.
 865          *
 866          *******************************************************************************/
 867          const T_USB_LUT CYCODE *USB_GetConfigTablePtr(uint8 confIndex)
 868                                                                  CYREENTRANT
 869          {
 870   1          /* Device Table */
 871   1          const T_USB_LUT CYCODE *pTmp;
 872   1      
 873   1          pTmp = (const T_USB_LUT CYCODE *) USB_TABLE[USB_device].p_list;
 874   1      
 875   1          /* The first entry points to the Device Descriptor,
 876   1          *  the rest configuration entries.
 877   1          *  Set pointer to the first Configuration Descriptor
 878   1          */
 879   1          pTmp = &pTmp[1u];
 880   1          /* For this table, c is the number of configuration descriptors  */
 881   1          if(confIndex >= pTmp->c)   /* Verify that required configuration descriptor exists */
 882   1          {
 883   2              pTmp = (const T_USB_LUT CYCODE *) NULL;
 884   2          }
 885   1          else
 886   1          {
 887   2              pTmp = (const T_USB_LUT CYCODE *) pTmp[confIndex].p_list;
 888   2          }
 889   1          
 890   1          return( pTmp );
 891   1      }
 892          
 893          
 894          /*******************************************************************************
 895          * Function Name: USB_GetDeviceTablePtr
 896          ********************************************************************************
 897          *
 898          * Summary:
 899          *  This routine returns a pointer to the Device table
 900          *
 901          * Parameters:
 902          *  None.
 903          *
 904          * Return:
 905          *  Device Table pointer
 906          *
 907          *******************************************************************************/
 908          const T_USB_LUT CYCODE *USB_GetDeviceTablePtr(void)
 909                                                                      
 910          {
 911   1          /* Device Table */
 912   1          return( (const T_USB_LUT CYCODE *) USB_TABLE[USB_device].p_list );
 913   1      }
 914          
 915          
 916          /*******************************************************************************
 917          * Function Name: USB_GetInterfaceClassTablePtr
 918          ********************************************************************************
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 16  

 919          *
 920          * Summary:
 921          *  This routine returns Interface Class table pointer, which contains
 922          *  the relation between interface number and interface class.
 923          *
 924          * Parameters:
 925          *  None.
 926          *
 927          * Return:
 928          *  Interface Class table pointer.
 929          *
 930          *******************************************************************************/
 931          const uint8 CYCODE *USB_GetInterfaceClassTablePtr(void)
 932                                                                  CYREENTRANT
 933          {
 934   1          const T_USB_LUT CYCODE *pTmp;
 935   1          const uint8 CYCODE *pInterfaceClass;
 936   1          uint8 currentInterfacesNum;
 937   1      
 938   1          pTmp = USB_GetConfigTablePtr(USB_configuration - 1u);
 939   1          if( pTmp != NULL )
 940   1          {
 941   2              currentInterfacesNum  = ((const uint8 *) pTmp->p_list)[USB_CONFIG_DESCR_NUM_INTERFACES];
 942   2              /* Third entry in the LUT starts the Interface Table pointers */
 943   2              /* The INTERFACE_CLASS table is located after all interfaces */
 944   2              pTmp = &pTmp[currentInterfacesNum + 2u];
 945   2              pInterfaceClass = (const uint8 CYCODE *) pTmp->p_list;
 946   2          }
 947   1          else
 948   1          {
 949   2              pInterfaceClass = (const uint8 CYCODE *) NULL;
 950   2          }
 951   1          
 952   1          return( pInterfaceClass );
 953   1      }
 954          
 955          
 956          /*******************************************************************************
 957          * Function Name: USB_TerminateEP
 958          ********************************************************************************
 959          *
 960          * Summary:
 961          *  This function terminates the specified USBFS endpoint.
 962          *  This function should be used before endpoint reconfiguration.
 963          *
 964          * Parameters:
 965          *  Endpoint number.
 966          *
 967          * Return:
 968          *  None.
 969          *
 970          * Reentrant:
 971          *  No.
 972          *
 973          *******************************************************************************/
 974          void USB_TerminateEP(uint8 ep) 
 975          {
 976   1          uint8 ri;
 977   1      
 978   1          ep &= USB_DIR_UNUSED;
 979   1          ri = ((ep - USB_EP1) << USB_EPX_CNTX_ADDR_SHIFT);
 980   1      
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 17  

 981   1          if ((ep > USB_EP0) && (ep < USB_MAX_EP))
 982   1          {
 983   2              /* Set the endpoint Halt */
 984   2              USB_EP[ep].hwEpState |= (USB_ENDPOINT_STATUS_HALT);
 985   2      
 986   2              /* Clear the data toggle */
 987   2              USB_EP[ep].epToggle = 0u;
 988   2              USB_EP[ep].apiEpState = USB_NO_EVENT_ALLOWED;
 989   2      
 990   2              if ((USB_EP[ep].addr & USB_DIR_IN) != 0u)
 991   2              {
 992   3                  /* IN Endpoint */
 993   3                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_NAK_IN);
 994   3              }
 995   2              else
 996   2              {
 997   3                  /* OUT Endpoint */
 998   3                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_NAK_OUT);
 999   3              }
1000   2          }
1001   1      }
1002          
1003          
1004          /*******************************************************************************
1005          * Function Name: USB_SetEndpointHalt
1006          ********************************************************************************
1007          *
1008          * Summary:
1009          *  This routine handles set endpoint halt.
1010          *
1011          * Parameters:
1012          *  None.
1013          *
1014          * Return:
1015          *  requestHandled.
1016          *
1017          * Reentrant:
1018          *  No.
1019          *
1020          *******************************************************************************/
1021          uint8 USB_SetEndpointHalt(void) 
1022          {
1023   1          uint8 ep;
1024   1          uint8 ri;
1025   1          uint8 requestHandled = USB_FALSE;
1026   1      
1027   1          /* Set endpoint halt */
1028   1          ep = CY_GET_REG8(USB_wIndexLo) & USB_DIR_UNUSED;
1029   1          ri = ((ep - USB_EP1) << USB_EPX_CNTX_ADDR_SHIFT);
1030   1      
1031   1          if ((ep > USB_EP0) && (ep < USB_MAX_EP))
1032   1          {
1033   2              /* Set the endpoint Halt */
1034   2              USB_EP[ep].hwEpState |= (USB_ENDPOINT_STATUS_HALT);
1035   2      
1036   2              /* Clear the data toggle */
1037   2              USB_EP[ep].epToggle = 0u;
1038   2              USB_EP[ep].apiEpState |= USB_NO_EVENT_ALLOWED;
1039   2      
1040   2              if ((USB_EP[ep].addr & USB_DIR_IN) != 0u)
1041   2              {
1042   3                  /* IN Endpoint */
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 18  

1043   3                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_STALL_DATA_EP |
1044   3                                                                     USB_MODE_ACK_IN);
1045   3              }
1046   2              else
1047   2              {
1048   3                  /* OUT Endpoint */
1049   3                  CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_STALL_DATA_EP |
1050   3                                                                     USB_MODE_ACK_OUT);
1051   3              }
1052   2              requestHandled = USB_InitNoDataControlTransfer();
1053   2          }
1054   1      
1055   1          return(requestHandled);
1056   1      }
1057          
1058          
1059          /*******************************************************************************
1060          * Function Name: USB_ClearEndpointHalt
1061          ********************************************************************************
1062          *
1063          * Summary:
1064          *  This routine handles clear endpoint halt.
1065          *
1066          * Parameters:
1067          *  None.
1068          *
1069          * Return:
1070          *  requestHandled.
1071          *
1072          * Reentrant:
1073          *  No.
1074          *
1075          *******************************************************************************/
1076          uint8 USB_ClearEndpointHalt(void) 
1077          {
1078   1          uint8 ep;
1079   1          uint8 ri;
1080   1          uint8 requestHandled = USB_FALSE;
1081   1      
1082   1          /* Clear endpoint halt */
1083   1          ep = CY_GET_REG8(USB_wIndexLo) & USB_DIR_UNUSED;
1084   1          ri = ((ep - USB_EP1) << USB_EPX_CNTX_ADDR_SHIFT);
1085   1      
1086   1          if ((ep > USB_EP0) && (ep < USB_MAX_EP))
1087   1          {
1088   2              /* Clear the endpoint Halt */
1089   2              USB_EP[ep].hwEpState &= (uint8)~(USB_ENDPOINT_STATUS_HALT);
1090   2      
1091   2              /* Clear the data toggle */
1092   2              USB_EP[ep].epToggle = 0u;
1093   2              /* Clear toggle bit for already armed packet */
1094   2              CY_SET_REG8((reg8 *)(USB_SIE_EP1_CNT0_IND + ri), CY_GET_REG8(
1095   2                          (reg8 *)(USB_SIE_EP1_CNT0_IND + ri)) & (uint8)~USB_EPX_CNT_DATA_TOGGLE);
1096   2              /* Return API State as it was defined before */
1097   2              USB_EP[ep].apiEpState &= (uint8)~USB_NO_EVENT_ALLOWED;
1098   2      
1099   2              if ((USB_EP[ep].addr & USB_DIR_IN) != 0u)
1100   2              {
1101   3                  /* IN Endpoint */
1102   3                  if(USB_EP[ep].apiEpState == USB_IN_BUFFER_EMPTY)
1103   3                  {       /* Wait for next packet from application */
1104   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_NAK_IN);
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 19  

1105   4                  }
1106   3                  else    /* Continue armed transfer */
1107   3                  {
1108   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_ACK_IN);
1109   4                  }
1110   3              }
1111   2              else
1112   2              {
1113   3                  /* OUT Endpoint */
1114   3                  if(USB_EP[ep].apiEpState == USB_OUT_BUFFER_FULL)
1115   3                  {       /* Allow application to read full buffer */
1116   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_NAK_OUT);
1117   4                  }
1118   3                  else    /* Mark endpoint as empty, so it will be reloaded */
1119   3                  {
1120   4                      CY_SET_REG8((reg8 *)(USB_SIE_EP1_CR0_IND + ri), USB_MODE_ACK_OUT);
1121   4                  }
1122   3              }
1123   2              requestHandled = USB_InitNoDataControlTransfer();
1124   2          }
1125   1      
1126   1          return(requestHandled);
1127   1      }
1128          
1129          
1130          /*******************************************************************************
1131          * Function Name: USB_ValidateAlternateSetting
1132          ********************************************************************************
1133          *
1134          * Summary:
1135          *  Validates (and records) a SET INTERFACE request.
1136          *
1137          * Parameters:
1138          *  None.
1139          *
1140          * Return:
1141          *  requestHandled.
1142          *
1143          * Reentrant:
1144          *  No.
1145          *
1146          *******************************************************************************/
1147          uint8 USB_ValidateAlternateSetting(void) 
1148          {
1149   1          uint8 requestHandled = USB_TRUE;
1150   1          uint8 interfaceNum;
1151   1          const T_USB_LUT CYCODE *pTmp;
1152   1          uint8 currentInterfacesNum;
1153   1      
1154   1          interfaceNum = CY_GET_REG8(USB_wIndexLo);
1155   1          /* Validate interface setting, stall if invalid. */
1156   1          pTmp = USB_GetConfigTablePtr(USB_configuration - 1u);
1157   1          currentInterfacesNum  = ((const uint8 *) pTmp->p_list)[USB_CONFIG_DESCR_NUM_INTERFACES];
1158   1      
1159   1          if((interfaceNum >= currentInterfacesNum) || (interfaceNum >= USB_MAX_INTERFACES_NUMBER))
1160   1          {   /* Wrong interface number */
1161   2              requestHandled = USB_FALSE;
1162   2          }
1163   1          else
1164   1          {
1165   2              /* Save current Alt setting to find out the difference in Config() function */
1166   2              USB_interfaceSetting_last[interfaceNum] = USB_interfaceSetting[interfaceNum];
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 20  

1167   2              USB_interfaceSetting[interfaceNum] = CY_GET_REG8(USB_wValueLo);
1168   2          }
1169   1      
1170   1          return (requestHandled);
1171   1      }
1172          
1173          
1174          /* [] END OF FILE */
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 21  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION USB_HandleStandardRqst (BEGIN)
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 89
                                           ; SOURCE LINE # 90
0000 900000      R     MOV     DPTR,#requestHandled
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 94
0005 7B00              MOV     R3,#00H
0007 7A00              MOV     R2,#00H
0009 7900              MOV     R1,#00H
000B 900000      R     MOV     DPTR,#pStr
000E 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 102
0011 900000      E     MOV     DPTR,#USB_currentTD
0014 E4                CLR     A
0015 F0                MOVX    @DPTR,A
0016 A3                INC     DPTR
0017 E4                CLR     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 104
0019 906000            MOV     DPTR,#06000H
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
001E EF                MOV     A,R7
001F 5480              ANL     A,#080H
0021 FF                MOV     R7,A
0022 7E00              MOV     R6,#00H
0024 EF                MOV     A,R7
0025 6480              XRL     A,#080H
0027 4E                ORL     A,R6
0028 6003              JZ      $ + 5H
002A 020000      R     LJMP    ?C0001
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 107
002D 906001            MOV     DPTR,#06001H
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
0032 EF                MOV     A,R7
0033 120000      E     LCALL   ?C?CCASE
0036 0000        R     DW      ?C0016
0038 00                DB      00H
0039 0000        R     DW      ?C0003
003B 06                DB      06H
003C 0000        R     DW      ?C0021
003E 08                DB      08H
003F 0000        R     DW      ?C0022
0041 0A                DB      0AH
0042 0000              DW      00H
0044 0000        R     DW      ?C0024
                                           ; SOURCE LINE # 108
                                           ; SOURCE LINE # 109
0046         ?C0003:
                                           ; SOURCE LINE # 110
0046 906003            MOV     DPTR,#06003H
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
004B EF                MOV     A,R7
004C B40135            CJNE    A,#01H,?C0004
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 22  

                                           ; SOURCE LINE # 111
                                           ; SOURCE LINE # 112
004F 120000      R     LCALL   USB_GetDeviceTablePtr
0052 900000      R     MOV     DPTR,#pTmp
0055 EE                MOV     A,R6
0056 F0                MOVX    @DPTR,A
0057 A3                INC     DPTR
0058 EF                MOV     A,R7
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 113
005A 900000      R     MOV     DPTR,#pTmp
005D E0                MOVX    A,@DPTR
005E FE                MOV     R6,A
005F A3                INC     DPTR
0060 E0                MOVX    A,@DPTR
0061 FF                MOV     R7,A
0062 8F82              MOV     DPL,R7
0064 8E83              MOV     DPH,R6
0066 A3                INC     DPTR
0067 120000      E     LCALL   ?C?PLDCODE
006A 900000      E     MOV     DPTR,#USB_currentTD+02H
006D 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 114
0070 900000      E     MOV     DPTR,#USB_currentTD
0073 E4                CLR     A
0074 F0                MOVX    @DPTR,A
0075 A3                INC     DPTR
0076 7412              MOV     A,#012H
0078 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 115
0079 120000      E     LCALL   USB_InitControlRead
007C 900000      R     MOV     DPTR,#requestHandled
007F EF                MOV     A,R7
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 116
0081 020000      R     LJMP    ?C0024
0084         ?C0004:
                                           ; SOURCE LINE # 117
0084 906003            MOV     DPTR,#06003H
0087 E0                MOVX    A,@DPTR
0088 FF                MOV     R7,A
0089 EF                MOV     A,R7
008A 6402              XRL     A,#02H
008C 707A              JNZ     ?C0006
                                           ; SOURCE LINE # 118
                                           ; SOURCE LINE # 119
008E 906002            MOV     DPTR,#06002H
0091 E0                MOVX    A,@DPTR
0092 FF                MOV     R7,A
0093 120000      R     LCALL   _?USB_GetConfigTablePtr
0096 900000      R     MOV     DPTR,#pTmp
0099 EE                MOV     A,R6
009A F0                MOVX    @DPTR,A
009B A3                INC     DPTR
009C EF                MOV     A,R7
009D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 120
009E 900000      R     MOV     DPTR,#pTmp
00A1 E0                MOVX    A,@DPTR
00A2 FE                MOV     R6,A
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 23  

00A5 FF                MOV     R7,A
00A6 EF                MOV     A,R7
00A7 4E                ORL     A,R6
00A8 7003              JNZ     $ + 5H
00AA 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
00AD 900000      R     MOV     DPTR,#pTmp
00B0 E0                MOVX    A,@DPTR
00B1 FE                MOV     R6,A
00B2 A3                INC     DPTR
00B3 E0                MOVX    A,@DPTR
00B4 FF                MOV     R7,A
00B5 8F82              MOV     DPL,R7
00B7 8E83              MOV     DPH,R6
00B9 A3                INC     DPTR
00BA 120000      E     LCALL   ?C?PLDCODE
00BD 900000      E     MOV     DPTR,#USB_currentTD+02H
00C0 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 123
00C3 900000      E     MOV     DPTR,#USB_currentTD+02H
00C6 120000      E     LCALL   ?C?PLDXDATA
00C9 E9                MOV     A,R1
00CA 2403              ADD     A,#03H
00CC F9                MOV     R1,A
00CD EA                MOV     A,R2
00CE 3400              ADDC    A,#00H
00D0 FA                MOV     R2,A
00D1 120000      E     LCALL   ?C?CLDPTR
00D4 FF                MOV     R7,A
00D5 7E00              MOV     R6,#00H
00D7 EF                MOV     A,R7
00D8 7F00              MOV     R7,#00H
00DA FE                MOV     R6,A
00DB 900000      E     MOV     DPTR,#USB_currentTD+02H
00DE 120000      E     LCALL   ?C?PLDXDATA
00E1 E9                MOV     A,R1
00E2 2402              ADD     A,#02H
00E4 F9                MOV     R1,A
00E5 EA                MOV     A,R2
00E6 3400              ADDC    A,#00H
00E8 FA                MOV     R2,A
00E9 120000      E     LCALL   ?C?CLDPTR
00EC FD                MOV     R5,A
00ED 7C00              MOV     R4,#00H
00EF EE                MOV     A,R6
00F0 4C                ORL     A,R4
00F1 FE                MOV     R6,A
00F2 EF                MOV     A,R7
00F3 4D                ORL     A,R5
00F4 FF                MOV     R7,A
00F5 900000      E     MOV     DPTR,#USB_currentTD
00F8 EE                MOV     A,R6
00F9 F0                MOVX    @DPTR,A
00FA A3                INC     DPTR
00FB EF                MOV     A,R7
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 126
00FD 120000      E     LCALL   USB_InitControlRead
0100 900000      R     MOV     DPTR,#requestHandled
0103 EF                MOV     A,R7
0104 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 24  

                                           ; SOURCE LINE # 127
                                           ; SOURCE LINE # 128
0105 020000      R     LJMP    ?C0024
0108         ?C0006:
                                           ; SOURCE LINE # 130
0108 906003            MOV     DPTR,#06003H
010B E0                MOVX    A,@DPTR
010C FF                MOV     R7,A
010D EF                MOV     A,R7
010E 6403              XRL     A,#03H
0110 6003              JZ      $ + 5H
0112 020000      R     LJMP    ?C0009
                                           ; SOURCE LINE # 131
                                           ; SOURCE LINE # 134
0115 900000      R     MOV     DPTR,#nStr
0118 E4                CLR     A
0119 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 135
011A 7BFF              MOV     R3,#0FFH
011C 7A00        E     MOV     R2,#HIGH USB_STRING_DESCRIPTORS
011E 7900        E     MOV     R1,#LOW USB_STRING_DESCRIPTORS
0120 900000      R     MOV     DPTR,#pStr
0123 120000      E     LCALL   ?C?PSTXDATA
0126         ?C0010:
                                           ; SOURCE LINE # 136
0126 900000      R     MOV     DPTR,#nStr
0129 E0                MOVX    A,@DPTR
012A FF                MOV     R7,A
012B 906002            MOV     DPTR,#06002H
012E E0                MOVX    A,@DPTR
012F FE                MOV     R6,A
0130 EE                MOV     A,R6
0131 D3                SETB    C
0132 9F                SUBB    A,R7
0133 403D              JC      ?C0011
0135 900000      R     MOV     DPTR,#pStr
0138 120000      E     LCALL   ?C?PLDXDATA
013B 120000      E     LCALL   ?C?CLDPTR
013E FF                MOV     R7,A
013F EF                MOV     A,R7
0140 6030              JZ      ?C0011
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 139
0142 900000      R     MOV     DPTR,#pStr
0145 120000      E     LCALL   ?C?PLDXDATA
0148 120000      E     LCALL   ?C?CLDPTR
014B FF                MOV     R7,A
014C 900000      R     MOV     DPTR,#descrLength
014F EF                MOV     A,R7
0150 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 141
0151 900000      R     MOV     DPTR,#pStr
0154 120000      E     LCALL   ?C?PLDXDATA
0157 900000      R     MOV     DPTR,#descrLength
015A E0                MOVX    A,@DPTR
015B FF                MOV     R7,A
015C 7E00              MOV     R6,#00H
015E E9                MOV     A,R1
015F 2F                ADD     A,R7
0160 F9                MOV     R1,A
0161 EA                MOV     A,R2
0162 3E                ADDC    A,R6
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 25  

0163 FA                MOV     R2,A
0164 900000      R     MOV     DPTR,#pStr
0167 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 142
016A 900000      R     MOV     DPTR,#nStr
016D E0                MOVX    A,@DPTR
016E 04                INC     A
016F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 143
0170 80B4              SJMP    ?C0010
0172         ?C0011:
                                           ; SOURCE LINE # 147
0172 906002            MOV     DPTR,#06002H
0175 E0                MOVX    A,@DPTR
0176 FF                MOV     R7,A
0177 EF                MOV     A,R7
0178 B4EE0C            CJNE    A,#0EEH,?C0012
                                           ; SOURCE LINE # 148
                                           ; SOURCE LINE # 149
017B 7BFF              MOV     R3,#0FFH
017D 7A00        E     MOV     R2,#HIGH USB_MSOS_DESCRIPTOR
017F 7900        E     MOV     R1,#LOW USB_MSOS_DESCRIPTOR
0181 900000      R     MOV     DPTR,#pStr
0184 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 150
0187         ?C0012:
                                           ; SOURCE LINE # 155
0187 906002            MOV     DPTR,#06002H
018A E0                MOVX    A,@DPTR
018B FF                MOV     R7,A
018C EF                MOV     A,R7
018D 6024              JZ      ?C0013
018F 900000      E     MOV     DPTR,#USB_DEVICE0_DESCR+010H
0192 E4                CLR     A
0193 93                MOVC    A,@A+DPTR
0194 FF                MOV     R7,A
0195 906002            MOV     DPTR,#06002H
0198 E0                MOVX    A,@DPTR
0199 FE                MOV     R6,A
019A EE                MOV     A,R6
019B B50715            CJNE    A,AR7,?C0013
                                           ; SOURCE LINE # 157
                                           ; SOURCE LINE # 161
019E 7B01              MOV     R3,#01H
01A0 7A00        E     MOV     R2,#HIGH USB_idSerialNumberStringDescriptor
01A2 7900        E     MOV     R1,#LOW USB_idSerialNumberStringDescriptor
01A4 120000      R     LCALL   _USB_ReadDieID
                                           ; SOURCE LINE # 162
01A7 7B01              MOV     R3,#01H
01A9 7A00        E     MOV     R2,#HIGH USB_idSerialNumberStringDescriptor
01AB 7900        E     MOV     R1,#LOW USB_idSerialNumberStringDescriptor
01AD 900000      R     MOV     DPTR,#pStr
01B0 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 175
01B3         ?C0013:
                                           ; SOURCE LINE # 177
01B3 900000      R     MOV     DPTR,#pStr
01B6 120000      E     LCALL   ?C?PLDXDATA
01B9 120000      E     LCALL   ?C?CLDPTR
01BC FF                MOV     R7,A
01BD EF                MOV     A,R7
01BE 7003              JNZ     $ + 5H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 26  

01C0 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
01C3 900000      R     MOV     DPTR,#pStr
01C6 120000      E     LCALL   ?C?PLDXDATA
01C9 120000      E     LCALL   ?C?CLDPTR
01CC FF                MOV     R7,A
01CD 7E00              MOV     R6,#00H
01CF 900000      E     MOV     DPTR,#USB_currentTD
01D2 EE                MOV     A,R6
01D3 F0                MOVX    @DPTR,A
01D4 A3                INC     DPTR
01D5 EF                MOV     A,R7
01D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 180
01D7 900000      R     MOV     DPTR,#pStr
01DA 120000      E     LCALL   ?C?PLDXDATA
01DD 900000      E     MOV     DPTR,#USB_currentTD+02H
01E0 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 181
01E3 120000      E     LCALL   USB_InitControlRead
01E6 900000      R     MOV     DPTR,#requestHandled
01E9 EF                MOV     A,R7
01EA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
01EB 020000      R     LJMP    ?C0024
01EE         ?C0009:
                                           ; SOURCE LINE # 186
                                           ; SOURCE LINE # 187
01EE 120000      E     LCALL   USB_DispatchClassRqst
01F1 900000      R     MOV     DPTR,#requestHandled
01F4 EF                MOV     A,R7
01F5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 188
                                           ; SOURCE LINE # 189
01F6 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 190
01F9         ?C0016:
                                           ; SOURCE LINE # 191
01F9 906000            MOV     DPTR,#06000H
01FC E0                MOVX    A,@DPTR
01FD FF                MOV     R7,A
01FE EF                MOV     A,R7
01FF 5403              ANL     A,#03H
0201 FF                MOV     R7,A
0202 EF                MOV     A,R7
0203 120000      E     LCALL   ?C?CCASE
0206 0000        R     DW      ?C0019
0208 00                DB      00H
0209 0000        R     DW      ?C0018
020B 02                DB      02H
020C 0000              DW      00H
020E 0000        R     DW      ?C0024
                                           ; SOURCE LINE # 192
                                           ; SOURCE LINE # 193
0210         ?C0018:
                                           ; SOURCE LINE # 194
0210 900000      E     MOV     DPTR,#USB_currentTD
0213 E4                CLR     A
0214 F0                MOVX    @DPTR,A
0215 A3                INC     DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 27  

0216 7402              MOV     A,#02H
0218 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 195
0219 906004            MOV     DPTR,#06004H
021C E0                MOVX    A,@DPTR
021D FF                MOV     R7,A
021E EF                MOV     A,R7
021F 547F              ANL     A,#07FH
0221 FF                MOV     R7,A
0222 EF                MOV     A,R7
0223 75F00B            MOV     B,#0BH
0226 A4                MUL     AB
0227 2400        E     ADD     A,#LOW USB_EP+02H
0229 F582              MOV     DPL,A
022B E4                CLR     A
022C 3400        E     ADDC    A,#HIGH USB_EP+02H
022E F583              MOV     DPH,A
0230 E0                MOVX    A,@DPTR
0231 FF                MOV     R7,A
0232 900000      R     MOV     DPTR,#USB_tBuffer
0235 EF                MOV     A,R7
0236 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 197
0237 900000      R     MOV     DPTR,#USB_tBuffer+01H
023A E4                CLR     A
023B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 198
023C 7B01              MOV     R3,#01H
023E 7A00        R     MOV     R2,#HIGH USB_tBuffer
0240 7900        R     MOV     R1,#LOW USB_tBuffer
0242 900000      E     MOV     DPTR,#USB_currentTD+02H
0245 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 199
0248 120000      E     LCALL   USB_InitControlRead
024B 900000      R     MOV     DPTR,#requestHandled
024E EF                MOV     A,R7
024F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 200
0250 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 201
0253         ?C0019:
                                           ; SOURCE LINE # 202
0253 900000      E     MOV     DPTR,#USB_currentTD
0256 E4                CLR     A
0257 F0                MOVX    @DPTR,A
0258 A3                INC     DPTR
0259 7402              MOV     A,#02H
025B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 203
025C 900000      E     MOV     DPTR,#USB_deviceStatus
025F E0                MOVX    A,@DPTR
0260 FF                MOV     R7,A
0261 900000      R     MOV     DPTR,#USB_tBuffer
0264 EF                MOV     A,R7
0265 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 204
0266 900000      R     MOV     DPTR,#USB_tBuffer+01H
0269 E4                CLR     A
026A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 205
026B 7B01              MOV     R3,#01H
026D 7A00        R     MOV     R2,#HIGH USB_tBuffer
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 28  

026F 7900        R     MOV     R1,#LOW USB_tBuffer
0271 900000      E     MOV     DPTR,#USB_currentTD+02H
0274 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 206
0277 120000      E     LCALL   USB_InitControlRead
027A 900000      R     MOV     DPTR,#requestHandled
027D EF                MOV     A,R7
027E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 207
027F 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 208
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
                                           ; SOURCE LINE # 211
0282 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 212
0285         ?C0021:
                                           ; SOURCE LINE # 213
0285 900000      E     MOV     DPTR,#USB_currentTD
0288 E4                CLR     A
0289 F0                MOVX    @DPTR,A
028A A3                INC     DPTR
028B 7401              MOV     A,#01H
028D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 214
028E 7B01              MOV     R3,#01H
0290 7A00        E     MOV     R2,#HIGH USB_configuration
0292 7900        E     MOV     R1,#LOW USB_configuration
0294 900000      E     MOV     DPTR,#USB_currentTD+02H
0297 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 215
029A 120000      E     LCALL   USB_InitControlRead
029D 900000      R     MOV     DPTR,#requestHandled
02A0 EF                MOV     A,R7
02A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 216
02A2 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 217
02A5         ?C0022:
                                           ; SOURCE LINE # 218
02A5 900000      E     MOV     DPTR,#USB_currentTD
02A8 E4                CLR     A
02A9 F0                MOVX    @DPTR,A
02AA A3                INC     DPTR
02AB 7401              MOV     A,#01H
02AD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 219
02AE 906004            MOV     DPTR,#06004H
02B1 E0                MOVX    A,@DPTR
02B2 FF                MOV     R7,A
02B3 7400        E     MOV     A,#LOW USB_interfaceSetting
02B5 2F                ADD     A,R7
02B6 F9                MOV     R1,A
02B7 E4                CLR     A
02B8 3400        E     ADDC    A,#HIGH USB_interfaceSetting
02BA FA                MOV     R2,A
02BB 7B01              MOV     R3,#01H
02BD 900000      E     MOV     DPTR,#USB_currentTD+02H
02C0 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 221
02C3 120000      E     LCALL   USB_InitControlRead
02C6 900000      R     MOV     DPTR,#requestHandled
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 29  

02C9 EF                MOV     A,R7
02CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 222
02CB 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 223
                                           ; SOURCE LINE # 224
                                           ; SOURCE LINE # 225
                                           ; SOURCE LINE # 226
02CE 020000      R     LJMP    ?C0024
02D1         ?C0001:
                                           ; SOURCE LINE # 227
                                           ; SOURCE LINE # 229
02D1 906001            MOV     DPTR,#06001H
02D4 E0                MOVX    A,@DPTR
02D5 FF                MOV     R7,A
02D6 EF                MOV     A,R7
02D7 120000      E     LCALL   ?C?CCASE
02DA 0000        R     DW      ?C0035
02DC 01                DB      01H
02DD 0000        R     DW      ?C0044
02DF 03                DB      03H
02E0 0000        R     DW      ?C0026
02E2 05                DB      05H
02E3 0000        R     DW      ?C0027
02E5 09                DB      09H
02E6 0000        R     DW      ?C0033
02E8 0B                DB      0BH
02E9 0000              DW      00H
02EB 0000        R     DW      ?C0024
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
02ED         ?C0026:
                                           ; SOURCE LINE # 232
02ED 906002            MOV     DPTR,#06002H
02F0 E0                MOVX    A,@DPTR
02F1 FF                MOV     R7,A
02F2 900000      E     MOV     DPTR,#USB_deviceAddress
02F5 EF                MOV     A,R7
02F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 233
02F7 120000      E     LCALL   USB_InitNoDataControlTransfer
02FA 900000      R     MOV     DPTR,#requestHandled
02FD EF                MOV     A,R7
02FE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
02FF 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 235
0302         ?C0027:
                                           ; SOURCE LINE # 236
0302 906002            MOV     DPTR,#06002H
0305 E0                MOVX    A,@DPTR
0306 FF                MOV     R7,A
0307 900000      R     MOV     DPTR,#configurationN
030A EF                MOV     A,R7
030B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 237
030C 900000      R     MOV     DPTR,#configurationN
030F E0                MOVX    A,@DPTR
0310 FF                MOV     R7,A
0311 EF                MOV     A,R7
0312 D3                SETB    C
0313 9400              SUBB    A,#00H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 30  

0315 4013              JC      ?C0028
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 239
0317 900000      R     MOV     DPTR,#configurationN
031A E0                MOVX    A,@DPTR
031B FF                MOV     R7,A
031C EF                MOV     A,R7
031D 14                DEC     A
031E FF                MOV     R7,A
031F 120000      R     LCALL   _?USB_GetConfigTablePtr
0322 900000      R     MOV     DPTR,#pTmp
0325 EE                MOV     A,R6
0326 F0                MOVX    @DPTR,A
0327 A3                INC     DPTR
0328 EF                MOV     A,R7
0329 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 240
032A         ?C0028:
                                           ; SOURCE LINE # 242
032A 900000      R     MOV     DPTR,#configurationN
032D E0                MOVX    A,@DPTR
032E FF                MOV     R7,A
032F EF                MOV     A,R7
0330 D3                SETB    C
0331 9400              SUBB    A,#00H
0333 400C              JC      ?C0031
0335 900000      R     MOV     DPTR,#pTmp
0338 E0                MOVX    A,@DPTR
0339 FE                MOV     R6,A
033A A3                INC     DPTR
033B E0                MOVX    A,@DPTR
033C FF                MOV     R7,A
033D EF                MOV     A,R7
033E 4E                ORL     A,R6
033F 700B              JNZ     ?C0030
0341         ?C0031:
0341 900000      R     MOV     DPTR,#configurationN
0344 E0                MOVX    A,@DPTR
0345 FF                MOV     R7,A
0346 EF                MOV     A,R7
0347 6003              JZ      $ + 5H
0349 020000      R     LJMP    ?C0024
034C         ?C0030:
                                           ; SOURCE LINE # 243
                                           ; SOURCE LINE # 245
034C 900000      E     MOV     DPTR,#USB_configuration
034F E0                MOVX    A,@DPTR
0350 FF                MOV     R7,A
0351 900000      R     MOV     DPTR,#configurationN
0354 E0                MOVX    A,@DPTR
0355 FE                MOV     R6,A
0356 EE                MOV     A,R6
0357 6F                XRL     A,R7
0358 6015              JZ      ?C0032
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 247
035A 900000      R     MOV     DPTR,#configurationN
035D E0                MOVX    A,@DPTR
035E FF                MOV     R7,A
035F 900000      E     MOV     DPTR,#USB_configuration
0362 EF                MOV     A,R7
0363 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 31  

                                           ; SOURCE LINE # 248
0364 900000      E     MOV     DPTR,#USB_configurationChanged
0367 7401              MOV     A,#01H
0369 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 249
036A 7F01              MOV     R7,#01H
036C 120000      R     LCALL   _?USB_Config
                                           ; SOURCE LINE # 250
036F         ?C0032:
                                           ; SOURCE LINE # 251
036F 120000      E     LCALL   USB_InitNoDataControlTransfer
0372 900000      R     MOV     DPTR,#requestHandled
0375 EF                MOV     A,R7
0376 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
0377 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 254
037A         ?C0033:
                                           ; SOURCE LINE # 255
037A 120000      R     LCALL   USB_ValidateAlternateSetting
037D EF                MOV     A,R7
037E 7003              JNZ     $ + 5H
0380 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 256
                                           ; SOURCE LINE # 257
0383 906004            MOV     DPTR,#06004H
0386 E0                MOVX    A,@DPTR
0387 FF                MOV     R7,A
0388 900000      R     MOV     DPTR,#interfaceNumber
038B EF                MOV     A,R7
038C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 258
038D 900000      R     MOV     DPTR,#interfaceNumber
0390 E0                MOVX    A,@DPTR
0391 FF                MOV     R7,A
0392 900000      E     MOV     DPTR,#USB_interfaceNumber
0395 EF                MOV     A,R7
0396 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 259
0397 900000      E     MOV     DPTR,#USB_configurationChanged
039A 7401              MOV     A,#01H
039C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 264
039D 120000      R     LCALL   USB_ConfigAltChanged
                                           ; SOURCE LINE # 267
03A0 900000      R     MOV     DPTR,#interfaceNumber
03A3 E0                MOVX    A,@DPTR
03A4 FF                MOV     R7,A
03A5 7400        E     MOV     A,#LOW USB_interfaceSetting
03A7 2F                ADD     A,R7
03A8 F582              MOV     DPL,A
03AA E4                CLR     A
03AB 3400        E     ADDC    A,#HIGH USB_interfaceSetting
03AD F583              MOV     DPH,A
03AF E0                MOVX    A,@DPTR
03B0 FF                MOV     R7,A
03B1 900000      R     MOV     DPTR,#interfaceNumber
03B4 E0                MOVX    A,@DPTR
03B5 FE                MOV     R6,A
03B6 7400        E     MOV     A,#LOW USB_interfaceSetting_last
03B8 2E                ADD     A,R6
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 32  

03B9 F582              MOV     DPL,A
03BB E4                CLR     A
03BC 3400        E     ADDC    A,#HIGH USB_interfaceSetting_last
03BE F583              MOV     DPH,A
03C0 EF                MOV     A,R7
03C1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 269
03C2 120000      E     LCALL   USB_InitNoDataControlTransfer
03C5 900000      R     MOV     DPTR,#requestHandled
03C8 EF                MOV     A,R7
03C9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 270
                                           ; SOURCE LINE # 271
03CA 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 272
03CD         ?C0035:
                                           ; SOURCE LINE # 273
03CD 906000            MOV     DPTR,#06000H
03D0 E0                MOVX    A,@DPTR
03D1 FF                MOV     R7,A
03D2 EF                MOV     A,R7
03D3 5403              ANL     A,#03H
03D5 FF                MOV     R7,A
03D6 EF                MOV     A,R7
03D7 120000      E     LCALL   ?C?CCASE
03DA 0000        R     DW      ?C0039
03DC 00                DB      00H
03DD 0000        R     DW      ?C0041
03DF 01                DB      01H
03E0 0000        R     DW      ?C0037
03E2 02                DB      02H
03E3 0000              DW      00H
03E5 0000        R     DW      ?C0024
                                           ; SOURCE LINE # 274
                                           ; SOURCE LINE # 275
03E7         ?C0037:
                                           ; SOURCE LINE # 276
03E7 906002            MOV     DPTR,#06002H
03EA E0                MOVX    A,@DPTR
03EB FF                MOV     R7,A
03EC EF                MOV     A,R7
03ED 6003              JZ      $ + 5H
03EF 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 277
                                           ; SOURCE LINE # 278
03F2 120000      R     LCALL   USB_ClearEndpointHalt
03F5 900000      R     MOV     DPTR,#requestHandled
03F8 EF                MOV     A,R7
03F9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 280
03FA 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 281
03FD         ?C0039:
                                           ; SOURCE LINE # 283
03FD 906002            MOV     DPTR,#06002H
0400 E0                MOVX    A,@DPTR
0401 FF                MOV     R7,A
0402 EF                MOV     A,R7
0403 6401              XRL     A,#01H
0405 6003              JZ      $ + 5H
0407 020000      R     LJMP    ?C0024
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 33  

                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 285
040A 900000      E     MOV     DPTR,#USB_deviceStatus
040D E0                MOVX    A,@DPTR
040E FF                MOV     R7,A
040F EF                MOV     A,R7
0410 54FD              ANL     A,#0FDH
0412 FF                MOV     R7,A
0413 900000      E     MOV     DPTR,#USB_deviceStatus
0416 EF                MOV     A,R7
0417 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 286
0418 120000      E     LCALL   USB_InitNoDataControlTransfer
041B 900000      R     MOV     DPTR,#requestHandled
041E EF                MOV     A,R7
041F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
0420 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 289
0423         ?C0041:
                                           ; SOURCE LINE # 291
0423 906004            MOV     DPTR,#06004H
0426 E0                MOVX    A,@DPTR
0427 FF                MOV     R7,A
0428 EF                MOV     A,R7
0429 C3                CLR     C
042A 9402              SUBB    A,#02H
042C 4003              JC      $ + 5H
042E 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 294
0431 906004            MOV     DPTR,#06004H
0434 E0                MOVX    A,@DPTR
0435 FF                MOV     R7,A
0436 7400        E     MOV     A,#LOW USB_interfaceStatus
0438 2F                ADD     A,R7
0439 F582              MOV     DPL,A
043B E4                CLR     A
043C 3400        E     ADDC    A,#HIGH USB_interfaceStatus
043E F583              MOV     DPH,A
0440 C083              PUSH    DPH
0442 C082              PUSH    DPL
0444 E0                MOVX    A,@DPTR
0445 FF                MOV     R7,A
0446 906002            MOV     DPTR,#06002H
0449 E0                MOVX    A,@DPTR
044A FE                MOV     R6,A
044B EE                MOV     A,R6
044C F4                CPL     A
044D FE                MOV     R6,A
044E EF                MOV     A,R7
044F 5E                ANL     A,R6
0450 FF                MOV     R7,A
0451 D082              POP     DPL
0453 D083              POP     DPH
0455 EF                MOV     A,R7
0456 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 295
0457 120000      E     LCALL   USB_InitNoDataControlTransfer
045A 900000      R     MOV     DPTR,#requestHandled
045D EF                MOV     A,R7
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 34  

045E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 296
                                           ; SOURCE LINE # 297
045F 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 298
                                           ; SOURCE LINE # 299
                                           ; SOURCE LINE # 300
                                           ; SOURCE LINE # 301
0462 020000      R     LJMP    ?C0024
                                           ; SOURCE LINE # 302
0465         ?C0044:
                                           ; SOURCE LINE # 303
0465 906000            MOV     DPTR,#06000H
0468 E0                MOVX    A,@DPTR
0469 FF                MOV     R7,A
046A EF                MOV     A,R7
046B 5403              ANL     A,#03H
046D FF                MOV     R7,A
046E EF                MOV     A,R7
046F 120000      E     LCALL   ?C?CCASE
0472 0000        R     DW      ?C0048
0474 00                DB      00H
0475 0000        R     DW      ?C0050
0477 01                DB      01H
0478 0000        R     DW      ?C0046
047A 02                DB      02H
047B 0000              DW      00H
047D 0000        R     DW      ?C0024
                                           ; SOURCE LINE # 304
                                           ; SOURCE LINE # 305
047F         ?C0046:
                                           ; SOURCE LINE # 306
047F 906002            MOV     DPTR,#06002H
0482 E0                MOVX    A,@DPTR
0483 FF                MOV     R7,A
0484 EF                MOV     A,R7
0485 7065              JNZ     ?C0024
                                           ; SOURCE LINE # 307
                                           ; SOURCE LINE # 308
0487 120000      R     LCALL   USB_SetEndpointHalt
048A 900000      R     MOV     DPTR,#requestHandled
048D EF                MOV     A,R7
048E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 309
                                           ; SOURCE LINE # 310
048F 805B              SJMP    ?C0024
                                           ; SOURCE LINE # 311
0491         ?C0048:
                                           ; SOURCE LINE # 313
0491 906002            MOV     DPTR,#06002H
0494 E0                MOVX    A,@DPTR
0495 FF                MOV     R7,A
0496 EF                MOV     A,R7
0497 6401              XRL     A,#01H
0499 7051              JNZ     ?C0024
                                           ; SOURCE LINE # 314
                                           ; SOURCE LINE # 315
049B 900000      E     MOV     DPTR,#USB_deviceStatus
049E E0                MOVX    A,@DPTR
049F FF                MOV     R7,A
04A0 EF                MOV     A,R7
04A1 4402              ORL     A,#02H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 35  

04A3 FF                MOV     R7,A
04A4 900000      E     MOV     DPTR,#USB_deviceStatus
04A7 EF                MOV     A,R7
04A8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 316
04A9 120000      E     LCALL   USB_InitNoDataControlTransfer
04AC 900000      R     MOV     DPTR,#requestHandled
04AF EF                MOV     A,R7
04B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 317
                                           ; SOURCE LINE # 318
04B1 8039              SJMP    ?C0024
                                           ; SOURCE LINE # 319
04B3         ?C0050:
                                           ; SOURCE LINE # 321
04B3 906004            MOV     DPTR,#06004H
04B6 E0                MOVX    A,@DPTR
04B7 FF                MOV     R7,A
04B8 EF                MOV     A,R7
04B9 C3                CLR     C
04BA 9402              SUBB    A,#02H
04BC 502E              JNC     ?C0024
                                           ; SOURCE LINE # 322
                                           ; SOURCE LINE # 324
04BE 906004            MOV     DPTR,#06004H
04C1 E0                MOVX    A,@DPTR
04C2 FF                MOV     R7,A
04C3 7400        E     MOV     A,#LOW USB_interfaceStatus
04C5 2F                ADD     A,R7
04C6 F582              MOV     DPL,A
04C8 E4                CLR     A
04C9 3400        E     ADDC    A,#HIGH USB_interfaceStatus
04CB F583              MOV     DPH,A
04CD C083              PUSH    DPH
04CF C082              PUSH    DPL
04D1 E0                MOVX    A,@DPTR
04D2 FF                MOV     R7,A
04D3 906002            MOV     DPTR,#06002H
04D6 E0                MOVX    A,@DPTR
04D7 FE                MOV     R6,A
04D8 EE                MOV     A,R6
04D9 F4                CPL     A
04DA FE                MOV     R6,A
04DB EF                MOV     A,R7
04DC 5E                ANL     A,R6
04DD FF                MOV     R7,A
04DE D082              POP     DPL
04E0 D083              POP     DPH
04E2 EF                MOV     A,R7
04E3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 325
04E4 120000      E     LCALL   USB_InitNoDataControlTransfer
04E7 900000      R     MOV     DPTR,#requestHandled
04EA EF                MOV     A,R7
04EB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 326
                                           ; SOURCE LINE # 327
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
                                           ; SOURCE LINE # 332
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 36  

                                           ; SOURCE LINE # 333
                                           ; SOURCE LINE # 334
                                           ; SOURCE LINE # 335
04EC         ?C0024:
                                           ; SOURCE LINE # 336
04EC 900000      R     MOV     DPTR,#requestHandled
04EF E0                MOVX    A,@DPTR
04F0 FF                MOV     R7,A
                                           ; SOURCE LINE # 337
04F1         ?C0054:
04F1 22                RET     
             ; FUNCTION USB_HandleStandardRqst (END)

             ; FUNCTION _USB_ReadDieID (BEGIN)
                                           ; SOURCE LINE # 359
0000 900000      R     MOV     DPTR,#descr
0003 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 360
                                           ; SOURCE LINE # 362
0006 900000      R     MOV     DPTR,#j
0009 E4                CLR     A
000A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 367
000B 7B00              MOV     R3,#00H
000D 7A00              MOV     R2,#00H
000F 7900              MOV     R1,#00H
0011 C003              PUSH    AR3
0013 C002              PUSH    AR2
0015 C001              PUSH    AR1
0017 900000      R     MOV     DPTR,#descr
001A 120000      E     LCALL   ?C?PLDXDATA
001D D082              POP     DPL
001F D083              POP     DPH
0021 D0E0              POP     ACC
0023 6B                XRL     A,R3
0024 7008              JNZ     ?C0141
0026 E9                MOV     A,R1
0027 6582              XRL     A,DPL
0029 7003              JNZ     ?C0141
002B EA                MOV     A,R2
002C 6583              XRL     A,DPH
002E         ?C0141:
002E 7003              JNZ     $ + 5H
0030 020000      R     LJMP    ?C0059
                                           ; SOURCE LINE # 368
                                           ; SOURCE LINE # 369
0033 900000      R     MOV     DPTR,#descr
0036 120000      E     LCALL   ?C?PLDXDATA
0039 7422              MOV     A,#022H
003B 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 370
003E 900000      R     MOV     DPTR,#descr
0041 120000      E     LCALL   ?C?PLDXDATA
0044 E9                MOV     A,R1
0045 2401              ADD     A,#01H
0047 F9                MOV     R1,A
0048 EA                MOV     A,R2
0049 3400              ADDC    A,#00H
004B FA                MOV     R2,A
004C 7403              MOV     A,#03H
004E 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 373
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 37  

0051 900000      R     MOV     DPTR,#i
0054 7402              MOV     A,#02H
0056 F0                MOVX    @DPTR,A
0057         ?C0056:
0057 900000      R     MOV     DPTR,#i
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C EF                MOV     A,R7
005D C3                CLR     C
005E 9422              SUBB    A,#022H
0060 4003              JC      $ + 5H
0062 020000      R     LJMP    ?C0059
                                           ; SOURCE LINE # 374
                                           ; SOURCE LINE # 375
0065 900000      R     MOV     DPTR,#j
0068 E0                MOVX    A,@DPTR
0069 FF                MOV     R7,A
006A E4                CLR     A
006B FC                MOV     R4,A
006C FD                MOV     R5,A
006D FE                MOV     R6,A
006E EF                MOV     A,R7
006F 2400              ADD     A,#00H
0071 FF                MOV     R7,A
0072 EE                MOV     A,R6
0073 3401              ADDC    A,#01H
0075 FE                MOV     R6,A
0076 ED                MOV     A,R5
0077 340C              ADDC    A,#0CH
0079 FD                MOV     R5,A
007A EC                MOV     A,R4
007B 3400              ADDC    A,#00H
007D FC                MOV     R4,A
007E A907              MOV     R1,AR7
0080 AA06              MOV     R2,AR6
0082 AB05              MOV     R3,AR5
0084 120000      E     LCALL   _cyread8
0087 900000      R     MOV     DPTR,#value
008A EF                MOV     A,R7
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 376
008C 900000      R     MOV     DPTR,#j
008F E0                MOVX    A,@DPTR
0090 04                INC     A
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 377
0092 900000      R     MOV     DPTR,#value
0095 E0                MOVX    A,@DPTR
0096 FF                MOV     R7,A
0097 EF                MOV     A,R7
0098 C4                SWAP    A
0099 540F              ANL     A,#0FH
009B FF                MOV     R7,A
009C EF                MOV     A,R7
009D 900000      R     MOV     DPTR,#hex
00A0 93                MOVC    A,@A+DPTR
00A1 FF                MOV     R7,A
00A2 900000      R     MOV     DPTR,#descr
00A5 120000      E     LCALL   ?C?PLDXDATA
00A8 900000      R     MOV     DPTR,#i
00AB E0                MOVX    A,@DPTR
00AC FE                MOV     R6,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 38  

00AD E9                MOV     A,R1
00AE 2E                ADD     A,R6
00AF F9                MOV     R1,A
00B0 E4                CLR     A
00B1 3A                ADDC    A,R2
00B2 FA                MOV     R2,A
00B3 EF                MOV     A,R7
00B4 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 378
00B7 900000      R     MOV     DPTR,#value
00BA E0                MOVX    A,@DPTR
00BB FF                MOV     R7,A
00BC EF                MOV     A,R7
00BD 540F              ANL     A,#0FH
00BF FF                MOV     R7,A
00C0 EF                MOV     A,R7
00C1 900000      R     MOV     DPTR,#hex
00C4 93                MOVC    A,@A+DPTR
00C5 FF                MOV     R7,A
00C6 900000      R     MOV     DPTR,#i
00C9 E0                MOVX    A,@DPTR
00CA FE                MOV     R6,A
00CB EE                MOV     A,R6
00CC FD                MOV     R5,A
00CD 7C00              MOV     R4,#00H
00CF ED                MOV     A,R5
00D0 2402              ADD     A,#02H
00D2 FD                MOV     R5,A
00D3 EC                MOV     A,R4
00D4 3400              ADDC    A,#00H
00D6 FC                MOV     R4,A
00D7 900000      R     MOV     DPTR,#descr
00DA 120000      E     LCALL   ?C?PLDXDATA
00DD E9                MOV     A,R1
00DE 2D                ADD     A,R5
00DF F9                MOV     R1,A
00E0 EA                MOV     A,R2
00E1 3C                ADDC    A,R4
00E2 FA                MOV     R2,A
00E3 EF                MOV     A,R7
00E4 120000      E     LCALL   ?C?CSTPTR
                                           ; SOURCE LINE # 379
00E7 900000      R     MOV     DPTR,#i
00EA E0                MOVX    A,@DPTR
00EB 2404              ADD     A,#04H
00ED F0                MOVX    @DPTR,A
00EE 020000      R     LJMP    ?C0056
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
00F1         ?C0059:
00F1 22                RET     
             ; FUNCTION _USB_ReadDieID (END)

             ; FUNCTION _?USB_ConfigReg (BEGIN)
                                           ; SOURCE LINE # 402
0000 90FFFE            MOV     DPTR,#0FFFEH
0003 120000      E     LCALL   ?C?ADDXBP
                                           ; SOURCE LINE # 411
0006 850083      E     MOV     DPH,?C_XBP
0009 850082      E     MOV     DPL,?C_XBP+01H
000C 7401              MOV     A,#01H
000E F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 39  

                                           ; SOURCE LINE # 412
000F 850083      E     MOV     DPH,?C_XBP
0012 850082      E     MOV     DPL,?C_XBP+01H
0015 A3                INC     DPTR
0016 E4                CLR     A
0017 F0                MOVX    @DPTR,A
0018         ?C0060:
0018 850083      E     MOV     DPH,?C_XBP
001B 850082      E     MOV     DPL,?C_XBP+01H
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FF                MOV     R7,A
0021 EF                MOV     A,R7
0022 C3                CLR     C
0023 9480              SUBB    A,#080H
0025 4003              JC      $ + 5H
0027 020000      R     LJMP    ?C0061
                                           ; SOURCE LINE # 413
                                           ; SOURCE LINE # 414
002A 850083      E     MOV     DPH,?C_XBP
002D 850082      E     MOV     DPL,?C_XBP+01H
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FF                MOV     R7,A
0033 7E00              MOV     R6,#00H
0035 EF                MOV     A,R7
0036 2480              ADD     A,#080H
0038 FF                MOV     R7,A
0039 EE                MOV     A,R6
003A 3460              ADDC    A,#060H
003C FE                MOV     R6,A
003D 8F82              MOV     DPL,R7
003F 8E83              MOV     DPH,R6
0041 740C              MOV     A,#0CH
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 420
0044 850083      E     MOV     DPH,?C_XBP
0047 850082      E     MOV     DPL,?C_XBP+01H
004A E0                MOVX    A,@DPTR
004B FF                MOV     R7,A
004C EF                MOV     A,R7
004D 75F00B            MOV     B,#0BH
0050 A4                MUL     AB
0051 2400        E     ADD     A,#LOW USB_EP+05H
0053 F582              MOV     DPL,A
0055 E4                CLR     A
0056 3400        E     ADDC    A,#HIGH USB_EP+05H
0058 F583              MOV     DPH,A
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C EF                MOV     A,R7
005D 605A              JZ      ?C0063
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
005F 850083      E     MOV     DPH,?C_XBP
0062 850082      E     MOV     DPL,?C_XBP+01H
0065 E0                MOVX    A,@DPTR
0066 FF                MOV     R7,A
0067 EF                MOV     A,R7
0068 75F00B            MOV     B,#0BH
006B A4                MUL     AB
006C 2400        E     ADD     A,#LOW USB_EP+04H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 40  

006E F582              MOV     DPL,A
0070 E4                CLR     A
0071 3400        E     ADDC    A,#HIGH USB_EP+04H
0073 F583              MOV     DPH,A
0075 E0                MOVX    A,@DPTR
0076 FF                MOV     R7,A
0077 EF                MOV     A,R7
0078 5480              ANL     A,#080H
007A FF                MOV     R7,A
007B 7E00              MOV     R6,#00H
007D EF                MOV     A,R7
007E 4E                ORL     A,R6
007F 601C              JZ      ?C0064
                                           ; SOURCE LINE # 423
                                           ; SOURCE LINE # 424
0081 850083      E     MOV     DPH,?C_XBP
0084 850082      E     MOV     DPL,?C_XBP+01H
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 FF                MOV     R7,A
008A 7E00              MOV     R6,#00H
008C EF                MOV     A,R7
008D 240E              ADD     A,#0EH
008F FF                MOV     R7,A
0090 EE                MOV     A,R6
0091 3460              ADDC    A,#060H
0093 FE                MOV     R6,A
0094 8F82              MOV     DPL,R7
0096 8E83              MOV     DPH,R6
0098 740C              MOV     A,#0CH
009A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 425
009B 8036              SJMP    ?C0066
009D         ?C0064:
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
009D 850083      E     MOV     DPH,?C_XBP
00A0 850082      E     MOV     DPL,?C_XBP+01H
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FF                MOV     R7,A
00A6 7E00              MOV     R6,#00H
00A8 EF                MOV     A,R7
00A9 240E              ADD     A,#0EH
00AB FF                MOV     R7,A
00AC EE                MOV     A,R6
00AD 3460              ADDC    A,#060H
00AF FE                MOV     R6,A
00B0 8F82              MOV     DPL,R7
00B2 8E83              MOV     DPH,R6
00B4 7408              MOV     A,#08H
00B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 433
                                           ; SOURCE LINE # 434
00B7 801A              SJMP    ?C0066
00B9         ?C0063:
                                           ; SOURCE LINE # 436
                                           ; SOURCE LINE # 437
00B9 850083      E     MOV     DPH,?C_XBP
00BC 850082      E     MOV     DPL,?C_XBP+01H
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 41  

00C1 FF                MOV     R7,A
00C2 7E00              MOV     R6,#00H
00C4 EF                MOV     A,R7
00C5 240E              ADD     A,#0EH
00C7 FF                MOV     R7,A
00C8 EE                MOV     A,R6
00C9 3460              ADDC    A,#060H
00CB FE                MOV     R6,A
00CC 8F82              MOV     DPL,R7
00CE 8E83              MOV     DPH,R6
00D0 7480              MOV     A,#080H
00D2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 438
00D3         ?C0066:
                                           ; SOURCE LINE # 441
00D3 850083      E     MOV     DPH,?C_XBP
00D6 850082      E     MOV     DPL,?C_XBP+01H
00D9 E0                MOVX    A,@DPTR
00DA FF                MOV     R7,A
00DB EF                MOV     A,R7
00DC 75F00B            MOV     B,#0BH
00DF A4                MUL     AB
00E0 2400        E     ADD     A,#LOW USB_EP+08H
00E2 F582              MOV     DPL,A
00E4 E4                CLR     A
00E5 3400        E     ADDC    A,#HIGH USB_EP+08H
00E7 F583              MOV     DPH,A
00E9 E0                MOVX    A,@DPTR
00EA FE                MOV     R6,A
00EB A3                INC     DPTR
00EC E0                MOVX    A,@DPTR
00ED FF                MOV     R7,A
00EE EE                MOV     A,R6
00EF FF                MOV     R7,A
00F0 7E00              MOV     R6,#00H
00F2 850083      E     MOV     DPH,?C_XBP
00F5 850082      E     MOV     DPL,?C_XBP+01H
00F8 A3                INC     DPTR
00F9 E0                MOVX    A,@DPTR
00FA FE                MOV     R6,A
00FB EE                MOV     A,R6
00FC FD                MOV     R5,A
00FD 7C00              MOV     R4,#00H
00FF ED                MOV     A,R5
0100 240C              ADD     A,#0CH
0102 FD                MOV     R5,A
0103 EC                MOV     A,R4
0104 3460              ADDC    A,#060H
0106 FC                MOV     R4,A
0107 8D82              MOV     DPL,R5
0109 8C83              MOV     DPH,R4
010B EF                MOV     A,R7
010C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 442
010D 850083      E     MOV     DPH,?C_XBP
0110 850082      E     MOV     DPL,?C_XBP+01H
0113 E0                MOVX    A,@DPTR
0114 FF                MOV     R7,A
0115 EF                MOV     A,R7
0116 75F00B            MOV     B,#0BH
0119 A4                MUL     AB
011A 2400        E     ADD     A,#LOW USB_EP+08H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 42  

011C F582              MOV     DPL,A
011E E4                CLR     A
011F 3400        E     ADDC    A,#HIGH USB_EP+08H
0121 F583              MOV     DPH,A
0123 E0                MOVX    A,@DPTR
0124 FE                MOV     R6,A
0125 A3                INC     DPTR
0126 E0                MOVX    A,@DPTR
0127 FF                MOV     R7,A
0128 EF                MOV     A,R7
0129 54FF              ANL     A,#0FFH
012B FF                MOV     R7,A
012C 850083      E     MOV     DPH,?C_XBP
012F 850082      E     MOV     DPL,?C_XBP+01H
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FE                MOV     R6,A
0135 EE                MOV     A,R6
0136 FD                MOV     R5,A
0137 7C00              MOV     R4,#00H
0139 ED                MOV     A,R5
013A 240D              ADD     A,#0DH
013C FD                MOV     R5,A
013D EC                MOV     A,R4
013E 3460              ADDC    A,#060H
0140 FC                MOV     R4,A
0141 8D82              MOV     DPL,R5
0143 8C83              MOV     DPH,R4
0145 EF                MOV     A,R7
0146 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 444
0147 850083      E     MOV     DPH,?C_XBP
014A 850082      E     MOV     DPL,?C_XBP+01H
014D E0                MOVX    A,@DPTR
014E FF                MOV     R7,A
014F EF                MOV     A,R7
0150 75F00B            MOV     B,#0BH
0153 A4                MUL     AB
0154 2400        E     ADD     A,#LOW USB_EP+06H
0156 F582              MOV     DPL,A
0158 E4                CLR     A
0159 3400        E     ADDC    A,#HIGH USB_EP+06H
015B F583              MOV     DPH,A
015D E0                MOVX    A,@DPTR
015E FE                MOV     R6,A
015F A3                INC     DPTR
0160 E0                MOVX    A,@DPTR
0161 FF                MOV     R7,A
0162 EF                MOV     A,R7
0163 54FF              ANL     A,#0FFH
0165 FF                MOV     R7,A
0166 850083      E     MOV     DPH,?C_XBP
0169 850082      E     MOV     DPL,?C_XBP+01H
016C A3                INC     DPTR
016D E0                MOVX    A,@DPTR
016E FE                MOV     R6,A
016F EE                MOV     A,R6
0170 FD                MOV     R5,A
0171 7C00              MOV     R4,#00H
0173 ED                MOV     A,R5
0174 2486              ADD     A,#086H
0176 FD                MOV     R5,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 43  

0177 EC                MOV     A,R4
0178 3460              ADDC    A,#060H
017A FC                MOV     R4,A
017B 8D82              MOV     DPL,R5
017D 8C83              MOV     DPH,R4
017F EF                MOV     A,R7
0180 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
0181 850083      E     MOV     DPH,?C_XBP
0184 850082      E     MOV     DPL,?C_XBP+01H
0187 E0                MOVX    A,@DPTR
0188 FF                MOV     R7,A
0189 EF                MOV     A,R7
018A 75F00B            MOV     B,#0BH
018D A4                MUL     AB
018E 2400        E     ADD     A,#LOW USB_EP+06H
0190 F582              MOV     DPL,A
0192 E4                CLR     A
0193 3400        E     ADDC    A,#HIGH USB_EP+06H
0195 F583              MOV     DPH,A
0197 E0                MOVX    A,@DPTR
0198 FE                MOV     R6,A
0199 A3                INC     DPTR
019A E0                MOVX    A,@DPTR
019B FF                MOV     R7,A
019C EE                MOV     A,R6
019D FF                MOV     R7,A
019E 7E00              MOV     R6,#00H
01A0 850083      E     MOV     DPH,?C_XBP
01A3 850082      E     MOV     DPL,?C_XBP+01H
01A6 A3                INC     DPTR
01A7 E0                MOVX    A,@DPTR
01A8 FE                MOV     R6,A
01A9 EE                MOV     A,R6
01AA FD                MOV     R5,A
01AB 7C00              MOV     R4,#00H
01AD ED                MOV     A,R5
01AE 2487              ADD     A,#087H
01B0 FD                MOV     R5,A
01B1 EC                MOV     A,R4
01B2 3460              ADDC    A,#060H
01B4 FC                MOV     R4,A
01B5 8D82              MOV     DPL,R5
01B7 8C83              MOV     DPH,R4
01B9 EF                MOV     A,R7
01BA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 446
01BB 850083      E     MOV     DPH,?C_XBP
01BE 850082      E     MOV     DPL,?C_XBP+01H
01C1 E0                MOVX    A,@DPTR
01C2 FF                MOV     R7,A
01C3 EF                MOV     A,R7
01C4 75F00B            MOV     B,#0BH
01C7 A4                MUL     AB
01C8 2400        E     ADD     A,#LOW USB_EP+06H
01CA F582              MOV     DPL,A
01CC E4                CLR     A
01CD 3400        E     ADDC    A,#HIGH USB_EP+06H
01CF F583              MOV     DPH,A
01D1 E0                MOVX    A,@DPTR
01D2 FE                MOV     R6,A
01D3 A3                INC     DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 44  

01D4 E0                MOVX    A,@DPTR
01D5 FF                MOV     R7,A
01D6 EF                MOV     A,R7
01D7 54FF              ANL     A,#0FFH
01D9 FF                MOV     R7,A
01DA 850083      E     MOV     DPH,?C_XBP
01DD 850082      E     MOV     DPL,?C_XBP+01H
01E0 A3                INC     DPTR
01E1 E0                MOVX    A,@DPTR
01E2 FE                MOV     R6,A
01E3 EE                MOV     A,R6
01E4 FD                MOV     R5,A
01E5 7C00              MOV     R4,#00H
01E7 ED                MOV     A,R5
01E8 2484              ADD     A,#084H
01EA FD                MOV     R5,A
01EB EC                MOV     A,R4
01EC 3460              ADDC    A,#060H
01EE FC                MOV     R4,A
01EF 8D82              MOV     DPL,R5
01F1 8C83              MOV     DPH,R4
01F3 EF                MOV     A,R7
01F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 447
01F5 850083      E     MOV     DPH,?C_XBP
01F8 850082      E     MOV     DPL,?C_XBP+01H
01FB E0                MOVX    A,@DPTR
01FC FF                MOV     R7,A
01FD EF                MOV     A,R7
01FE 75F00B            MOV     B,#0BH
0201 A4                MUL     AB
0202 2400        E     ADD     A,#LOW USB_EP+06H
0204 F582              MOV     DPL,A
0206 E4                CLR     A
0207 3400        E     ADDC    A,#HIGH USB_EP+06H
0209 F583              MOV     DPH,A
020B E0                MOVX    A,@DPTR
020C FE                MOV     R6,A
020D A3                INC     DPTR
020E E0                MOVX    A,@DPTR
020F FF                MOV     R7,A
0210 EE                MOV     A,R6
0211 FF                MOV     R7,A
0212 7E00              MOV     R6,#00H
0214 850083      E     MOV     DPH,?C_XBP
0217 850082      E     MOV     DPL,?C_XBP+01H
021A A3                INC     DPTR
021B E0                MOVX    A,@DPTR
021C FE                MOV     R6,A
021D EE                MOV     A,R6
021E FD                MOV     R5,A
021F 7C00              MOV     R4,#00H
0221 ED                MOV     A,R5
0222 2485              ADD     A,#085H
0224 FD                MOV     R5,A
0225 EC                MOV     A,R4
0226 3460              ADDC    A,#060H
0228 FC                MOV     R4,A
0229 8D82              MOV     DPL,R5
022B 8C83              MOV     DPH,R4
022D EF                MOV     A,R7
022E F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 45  

                                           ; SOURCE LINE # 450
022F 850083      E     MOV     DPH,?C_XBP
0232 850082      E     MOV     DPL,?C_XBP+01H
0235 E0                MOVX    A,@DPTR
0236 04                INC     A
0237 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 451
0238 850083      E     MOV     DPH,?C_XBP
023B 850082      E     MOV     DPL,?C_XBP+01H
023E A3                INC     DPTR
023F E0                MOVX    A,@DPTR
0240 2410              ADD     A,#010H
0242 F0                MOVX    @DPTR,A
0243 020000      R     LJMP    ?C0060
0246         ?C0061:
                                           ; SOURCE LINE # 467
0246 90600A            MOV     DPTR,#0600AH
0249 74FF              MOV     A,#0FFH
024B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 468
024C 900002            MOV     DPTR,#02H
024F 120000      E     LCALL   ?C?ADDXBP
0252 22                RET     
             ; FUNCTION _?USB_ConfigReg (END)

             ; FUNCTION _?USB_Config (BEGIN)
                                           ; SOURCE LINE # 493
0000 90FFFF            MOV     DPTR,#0FFFFH
0003 120000      E     LCALL   ?C?ADDXBP
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
0008 90FFF3            MOV     DPTR,#0FFF3H
000B 120000      E     LCALL   ?C?ADDXBP
                                           ; SOURCE LINE # 501
000E 900007            MOV     DPTR,#07H
0011 120000      E     LCALL   ?C?XBPOFF
0014 E4                CLR     A
0015 F0                MOVX    @DPTR,A
0016 A3                INC     DPTR
0017 E4                CLR     A
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 508
0019 850083      E     MOV     DPH,?C_XBP
001C 850082      E     MOV     DPL,?C_XBP+01H
001F E4                CLR     A
0020 F0                MOVX    @DPTR,A
0021         ?C0068:
0021 850083      E     MOV     DPH,?C_XBP
0024 850082      E     MOV     DPL,?C_XBP+01H
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 EF                MOV     A,R7
002A C3                CLR     C
002B 9409              SUBB    A,#09H
002D 4003              JC      $ + 5H
002F 020000      R     LJMP    ?C0069
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
0032 850083      E     MOV     DPH,?C_XBP
0035 850082      E     MOV     DPL,?C_XBP+01H
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 46  

003A EF                MOV     A,R7
003B 75F00B            MOV     B,#0BH
003E A4                MUL     AB
003F 2400        E     ADD     A,#LOW USB_EP
0041 F582              MOV     DPL,A
0043 E4                CLR     A
0044 3400        E     ADDC    A,#HIGH USB_EP
0046 F583              MOV     DPH,A
0048 E4                CLR     A
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 511
004A 850083      E     MOV     DPH,?C_XBP
004D 850082      E     MOV     DPL,?C_XBP+01H
0050 E0                MOVX    A,@DPTR
0051 FF                MOV     R7,A
0052 EF                MOV     A,R7
0053 75F00B            MOV     B,#0BH
0056 A4                MUL     AB
0057 2400        E     ADD     A,#LOW USB_EP+02H
0059 F582              MOV     DPL,A
005B E4                CLR     A
005C 3400        E     ADDC    A,#HIGH USB_EP+02H
005E F583              MOV     DPH,A
0060 E4                CLR     A
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 512
0062 850083      E     MOV     DPH,?C_XBP
0065 850082      E     MOV     DPL,?C_XBP+01H
0068 E0                MOVX    A,@DPTR
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B 75F00B            MOV     B,#0BH
006E A4                MUL     AB
006F 2400        E     ADD     A,#LOW USB_EP+01H
0071 F582              MOV     DPL,A
0073 E4                CLR     A
0074 3400        E     ADDC    A,#HIGH USB_EP+01H
0076 F583              MOV     DPH,A
0078 E4                CLR     A
0079 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 513
007A 850083      E     MOV     DPH,?C_XBP
007D 850082      E     MOV     DPL,?C_XBP+01H
0080 E0                MOVX    A,@DPTR
0081 FF                MOV     R7,A
0082 EF                MOV     A,R7
0083 75F00B            MOV     B,#0BH
0086 A4                MUL     AB
0087 2400        E     ADD     A,#LOW USB_EP+03H
0089 F582              MOV     DPL,A
008B E4                CLR     A
008C 3400        E     ADDC    A,#HIGH USB_EP+03H
008E F583              MOV     DPH,A
0090 E4                CLR     A
0091 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 514
0092 850083      E     MOV     DPH,?C_XBP
0095 850082      E     MOV     DPL,?C_XBP+01H
0098 E0                MOVX    A,@DPTR
0099 FF                MOV     R7,A
009A EF                MOV     A,R7
009B 75F00B            MOV     B,#0BH
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 47  

009E A4                MUL     AB
009F 2400        E     ADD     A,#LOW USB_EP+05H
00A1 F582              MOV     DPL,A
00A3 E4                CLR     A
00A4 3400        E     ADDC    A,#HIGH USB_EP+05H
00A6 F583              MOV     DPH,A
00A8 E4                CLR     A
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 515
00AA 850083      E     MOV     DPH,?C_XBP
00AD 850082      E     MOV     DPL,?C_XBP+01H
00B0 E0                MOVX    A,@DPTR
00B1 FF                MOV     R7,A
00B2 EF                MOV     A,R7
00B3 75F00B            MOV     B,#0BH
00B6 A4                MUL     AB
00B7 2400        E     ADD     A,#LOW USB_EP+08H
00B9 F582              MOV     DPL,A
00BB E4                CLR     A
00BC 3400        E     ADDC    A,#HIGH USB_EP+08H
00BE F583              MOV     DPH,A
00C0 E4                CLR     A
00C1 F0                MOVX    @DPTR,A
00C2 A3                INC     DPTR
00C3 E4                CLR     A
00C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 516
00C5 850083      E     MOV     DPH,?C_XBP
00C8 850082      E     MOV     DPL,?C_XBP+01H
00CB E0                MOVX    A,@DPTR
00CC FF                MOV     R7,A
00CD EF                MOV     A,R7
00CE 75F00B            MOV     B,#0BH
00D1 A4                MUL     AB
00D2 2400        E     ADD     A,#LOW USB_EP+0AH
00D4 F582              MOV     DPL,A
00D6 E4                CLR     A
00D7 3400        E     ADDC    A,#HIGH USB_EP+0AH
00D9 F583              MOV     DPH,A
00DB E4                CLR     A
00DC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 518
00DD 850083      E     MOV     DPH,?C_XBP
00E0 850082      E     MOV     DPL,?C_XBP+01H
00E3 E0                MOVX    A,@DPTR
00E4 04                INC     A
00E5 F0                MOVX    @DPTR,A
00E6 020000      R     LJMP    ?C0068
00E9         ?C0069:
                                           ; SOURCE LINE # 521
00E9 90000D            MOV     DPTR,#0DH
00EC 120000      E     LCALL   ?C?XBPOFF
00EF E0                MOVX    A,@DPTR
00F0 FF                MOV     R7,A
00F1 EF                MOV     A,R7
00F2 6053              JZ      ?C0071
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
00F4 850083      E     MOV     DPH,?C_XBP
00F7 850082      E     MOV     DPL,?C_XBP+01H
00FA A3                INC     DPTR
00FB A3                INC     DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 48  

00FC E4                CLR     A
00FD F0                MOVX    @DPTR,A
00FE         ?C0072:
00FE 850083      E     MOV     DPH,?C_XBP
0101 850082      E     MOV     DPL,?C_XBP+01H
0104 A3                INC     DPTR
0105 A3                INC     DPTR
0106 E0                MOVX    A,@DPTR
0107 FF                MOV     R7,A
0108 EF                MOV     A,R7
0109 C3                CLR     C
010A 9402              SUBB    A,#02H
010C 5039              JNC     ?C0071
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
010E 850083      E     MOV     DPH,?C_XBP
0111 850082      E     MOV     DPL,?C_XBP+01H
0114 A3                INC     DPTR
0115 A3                INC     DPTR
0116 E0                MOVX    A,@DPTR
0117 FF                MOV     R7,A
0118 7400        E     MOV     A,#LOW USB_interfaceSetting
011A 2F                ADD     A,R7
011B F582              MOV     DPL,A
011D E4                CLR     A
011E 3400        E     ADDC    A,#HIGH USB_interfaceSetting
0120 F583              MOV     DPH,A
0122 E4                CLR     A
0123 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 526
0124 850083      E     MOV     DPH,?C_XBP
0127 850082      E     MOV     DPL,?C_XBP+01H
012A A3                INC     DPTR
012B A3                INC     DPTR
012C E0                MOVX    A,@DPTR
012D FF                MOV     R7,A
012E 7400        E     MOV     A,#LOW USB_interfaceSetting_last
0130 2F                ADD     A,R7
0131 F582              MOV     DPL,A
0133 E4                CLR     A
0134 3400        E     ADDC    A,#HIGH USB_interfaceSetting_last
0136 F583              MOV     DPH,A
0138 E4                CLR     A
0139 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 527
013A 850083      E     MOV     DPH,?C_XBP
013D 850082      E     MOV     DPL,?C_XBP+01H
0140 A3                INC     DPTR
0141 A3                INC     DPTR
0142 E0                MOVX    A,@DPTR
0143 04                INC     A
0144 F0                MOVX    @DPTR,A
0145 80B7              SJMP    ?C0072
                                           ; SOURCE LINE # 528
0147         ?C0071:
                                           ; SOURCE LINE # 531
0147 900000      E     MOV     DPTR,#USB_configuration
014A E0                MOVX    A,@DPTR
014B FF                MOV     R7,A
014C EF                MOV     A,R7
014D D3                SETB    C
014E 9400              SUBB    A,#00H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 49  

0150 5003              JNC     $ + 5H
0152 020000      R     LJMP    ?C0101
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 533
0155 900000      E     MOV     DPTR,#USB_configuration
0158 E0                MOVX    A,@DPTR
0159 FF                MOV     R7,A
015A EF                MOV     A,R7
015B 14                DEC     A
015C FF                MOV     R7,A
015D 120000      R     LCALL   _?USB_GetConfigTablePtr
0160 900009            MOV     DPTR,#09H
0163 120000      E     LCALL   ?C?XBPOFF
0166 EE                MOV     A,R6
0167 F0                MOVX    @DPTR,A
0168 A3                INC     DPTR
0169 EF                MOV     A,R7
016A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 535
016B 900009            MOV     DPTR,#09H
016E 120000      E     LCALL   ?C?XBPOFF
0171 E0                MOVX    A,@DPTR
0172 FE                MOV     R6,A
0173 A3                INC     DPTR
0174 E0                MOVX    A,@DPTR
0175 FF                MOV     R7,A
0176 8F82              MOV     DPL,R7
0178 8E83              MOV     DPH,R6
017A A3                INC     DPTR
017B 120000      E     LCALL   ?C?PLDCODE
017E 900004            MOV     DPTR,#04H
0181 120000      E     LCALL   ?C?XBPOFF
0184 120000      E     LCALL   ?C?PSTXDATA
                                           ; SOURCE LINE # 536
0187 900004            MOV     DPTR,#04H
018A 120000      E     LCALL   ?C?XBPOFF
018D 120000      E     LCALL   ?C?PLDXDATA
0190 E9                MOV     A,R1
0191 2407              ADD     A,#07H
0193 F9                MOV     R1,A
0194 EA                MOV     A,R2
0195 3400              ADDC    A,#00H
0197 FA                MOV     R2,A
0198 120000      E     LCALL   ?C?CLDPTR
019B FF                MOV     R7,A
019C EF                MOV     A,R7
019D 5440              ANL     A,#040H
019F FF                MOV     R7,A
01A0 7E00              MOV     R6,#00H
01A2 EF                MOV     A,R7
01A3 4E                ORL     A,R6
01A4 6010              JZ      ?C0076
                                           ; SOURCE LINE # 537
                                           ; SOURCE LINE # 538
01A6 900000      E     MOV     DPTR,#USB_deviceStatus
01A9 E0                MOVX    A,@DPTR
01AA FF                MOV     R7,A
01AB EF                MOV     A,R7
01AC 4401              ORL     A,#01H
01AE FF                MOV     R7,A
01AF 900000      E     MOV     DPTR,#USB_deviceStatus
01B2 EF                MOV     A,R7
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 50  

01B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
01B4 800E              SJMP    ?C0077
01B6         ?C0076:
                                           ; SOURCE LINE # 541
                                           ; SOURCE LINE # 542
01B6 900000      E     MOV     DPTR,#USB_deviceStatus
01B9 E0                MOVX    A,@DPTR
01BA FF                MOV     R7,A
01BB EF                MOV     A,R7
01BC 54FE              ANL     A,#0FEH
01BE FF                MOV     R7,A
01BF 900000      E     MOV     DPTR,#USB_deviceStatus
01C2 EF                MOV     A,R7
01C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 543
01C4         ?C0077:
                                           ; SOURCE LINE # 545
01C4 900009            MOV     DPTR,#09H
01C7 120000      E     LCALL   ?C?XBPOFF
01CA E0                MOVX    A,@DPTR
01CB FE                MOV     R6,A
01CC A3                INC     DPTR
01CD E0                MOVX    A,@DPTR
01CE FF                MOV     R7,A
01CF EF                MOV     A,R7
01D0 2404              ADD     A,#04H
01D2 FF                MOV     R7,A
01D3 EE                MOV     A,R6
01D4 3400              ADDC    A,#00H
01D6 FE                MOV     R6,A
01D7 900009            MOV     DPTR,#09H
01DA 120000      E     LCALL   ?C?XBPOFF
01DD EE                MOV     A,R6
01DE F0                MOVX    @DPTR,A
01DF A3                INC     DPTR
01E0 EF                MOV     A,R7
01E1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 546
01E2 900009            MOV     DPTR,#09H
01E5 120000      E     LCALL   ?C?XBPOFF
01E8 E0                MOVX    A,@DPTR
01E9 FE                MOV     R6,A
01EA A3                INC     DPTR
01EB E0                MOVX    A,@DPTR
01EC FF                MOV     R7,A
01ED 8F82              MOV     DPL,R7
01EF 8E83              MOV     DPH,R6
01F1 E4                CLR     A
01F2 93                MOVC    A,@A+DPTR
01F3 FF                MOV     R7,A
01F4 850083      E     MOV     DPH,?C_XBP
01F7 850082      E     MOV     DPL,?C_XBP+01H
01FA EF                MOV     A,R7
01FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 613
01FC 850083      E     MOV     DPH,?C_XBP
01FF 850082      E     MOV     DPL,?C_XBP+01H
0202 A3                INC     DPTR
0203 A3                INC     DPTR
0204 7401              MOV     A,#01H
0206 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 51  

0207         ?C0078:
0207 850083      E     MOV     DPH,?C_XBP
020A 850082      E     MOV     DPL,?C_XBP+01H
020D A3                INC     DPTR
020E A3                INC     DPTR
020F E0                MOVX    A,@DPTR
0210 FF                MOV     R7,A
0211 EF                MOV     A,R7
0212 C3                CLR     C
0213 9409              SUBB    A,#09H
0215 4003              JC      $ + 5H
0217 020000      R     LJMP    ?C0079
                                           ; SOURCE LINE # 614
                                           ; SOURCE LINE # 616
021A 900009            MOV     DPTR,#09H
021D 120000      E     LCALL   ?C?XBPOFF
0220 E0                MOVX    A,@DPTR
0221 FE                MOV     R6,A
0222 A3                INC     DPTR
0223 E0                MOVX    A,@DPTR
0224 FF                MOV     R7,A
0225 8F82              MOV     DPL,R7
0227 8E83              MOV     DPH,R6
0229 A3                INC     DPTR
022A 120000      E     LCALL   ?C?PLDCODE
022D AE02              MOV     R6,AR2
022F AF01              MOV     R7,AR1
0231 90000B            MOV     DPTR,#0BH
0234 120000      E     LCALL   ?C?XBPOFF
0237 EE                MOV     A,R6
0238 F0                MOVX    @DPTR,A
0239 A3                INC     DPTR
023A EF                MOV     A,R7
023B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 619
023C 850083      E     MOV     DPH,?C_XBP
023F 850082      E     MOV     DPL,?C_XBP+01H
0242 A3                INC     DPTR
0243 E4                CLR     A
0244 F0                MOVX    @DPTR,A
0245         ?C0081:
0245 850083      E     MOV     DPH,?C_XBP
0248 850082      E     MOV     DPL,?C_XBP+01H
024B E0                MOVX    A,@DPTR
024C FF                MOV     R7,A
024D 850083      E     MOV     DPH,?C_XBP
0250 850082      E     MOV     DPL,?C_XBP+01H
0253 A3                INC     DPTR
0254 E0                MOVX    A,@DPTR
0255 FE                MOV     R6,A
0256 EE                MOV     A,R6
0257 C3                CLR     C
0258 9F                SUBB    A,R7
0259 4003              JC      $ + 5H
025B 020000      R     LJMP    ?C0080
                                           ; SOURCE LINE # 620
                                           ; SOURCE LINE # 622
025E 90000B            MOV     DPTR,#0BH
0261 120000      E     LCALL   ?C?XBPOFF
0264 E0                MOVX    A,@DPTR
0265 FE                MOV     R6,A
0266 A3                INC     DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 52  

0267 E0                MOVX    A,@DPTR
0268 FF                MOV     R7,A
0269 8F82              MOV     DPL,R7
026B 8E83              MOV     DPH,R6
026D 7402              MOV     A,#02H
026F 93                MOVC    A,@A+DPTR
0270 FF                MOV     R7,A
0271 EF                MOV     A,R7
0272 547F              ANL     A,#07FH
0274 FF                MOV     R7,A
0275 7E00              MOV     R6,#00H
0277 850083      E     MOV     DPH,?C_XBP
027A 850082      E     MOV     DPL,?C_XBP+01H
027D A3                INC     DPTR
027E A3                INC     DPTR
027F E0                MOVX    A,@DPTR
0280 FD                MOV     R5,A
0281 7C00              MOV     R4,#00H
0283 ED                MOV     A,R5
0284 6F                XRL     A,R7
0285 7002              JNZ     ?C0142
0287 EC                MOV     A,R4
0288 6E                XRL     A,R6
0289         ?C0142:
0289 6003              JZ      $ + 5H
028B 020000      R     LJMP    ?C0084
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 624
028E 90000B            MOV     DPTR,#0BH
0291 120000      E     LCALL   ?C?XBPOFF
0294 E0                MOVX    A,@DPTR
0295 FE                MOV     R6,A
0296 A3                INC     DPTR
0297 E0                MOVX    A,@DPTR
0298 FF                MOV     R7,A
0299 8F82              MOV     DPL,R7
029B 8E83              MOV     DPH,R6
029D 7404              MOV     A,#04H
029F 93                MOVC    A,@A+DPTR
02A0 FE                MOV     R6,A
02A1 7405              MOV     A,#05H
02A3 93                MOVC    A,@A+DPTR
02A4 FF                MOV     R7,A
02A5 850083      E     MOV     DPH,?C_XBP
02A8 850082      E     MOV     DPL,?C_XBP+01H
02AB A3                INC     DPTR
02AC A3                INC     DPTR
02AD E0                MOVX    A,@DPTR
02AE FD                MOV     R5,A
02AF ED                MOV     A,R5
02B0 75F00B            MOV     B,#0BH
02B3 A4                MUL     AB
02B4 2400        E     ADD     A,#LOW USB_EP+08H
02B6 F582              MOV     DPL,A
02B8 E4                CLR     A
02B9 3400        E     ADDC    A,#HIGH USB_EP+08H
02BB F583              MOV     DPH,A
02BD E0                MOVX    A,@DPTR
02BE FC                MOV     R4,A
02BF A3                INC     DPTR
02C0 E0                MOVX    A,@DPTR
02C1 FD                MOV     R5,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 53  

02C2 C3                CLR     C
02C3 ED                MOV     A,R5
02C4 9F                SUBB    A,R7
02C5 EC                MOV     A,R4
02C6 9E                SUBB    A,R6
02C7 5034              JNC     ?C0085
                                           ; SOURCE LINE # 625
                                           ; SOURCE LINE # 626
02C9 90000B            MOV     DPTR,#0BH
02CC 120000      E     LCALL   ?C?XBPOFF
02CF E0                MOVX    A,@DPTR
02D0 FE                MOV     R6,A
02D1 A3                INC     DPTR
02D2 E0                MOVX    A,@DPTR
02D3 FF                MOV     R7,A
02D4 8F82              MOV     DPL,R7
02D6 8E83              MOV     DPH,R6
02D8 7404              MOV     A,#04H
02DA 93                MOVC    A,@A+DPTR
02DB FE                MOV     R6,A
02DC 7405              MOV     A,#05H
02DE 93                MOVC    A,@A+DPTR
02DF FF                MOV     R7,A
02E0 850083      E     MOV     DPH,?C_XBP
02E3 850082      E     MOV     DPL,?C_XBP+01H
02E6 A3                INC     DPTR
02E7 A3                INC     DPTR
02E8 E0                MOVX    A,@DPTR
02E9 FD                MOV     R5,A
02EA ED                MOV     A,R5
02EB 75F00B            MOV     B,#0BH
02EE A4                MUL     AB
02EF 2400        E     ADD     A,#LOW USB_EP+08H
02F1 F582              MOV     DPL,A
02F3 E4                CLR     A
02F4 3400        E     ADDC    A,#HIGH USB_EP+08H
02F6 F583              MOV     DPH,A
02F8 EE                MOV     A,R6
02F9 F0                MOVX    @DPTR,A
02FA A3                INC     DPTR
02FB EF                MOV     A,R7
02FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 627
02FD         ?C0085:
                                           ; SOURCE LINE # 629
02FD 90000B            MOV     DPTR,#0BH
0300 120000      E     LCALL   ?C?XBPOFF
0303 E0                MOVX    A,@DPTR
0304 FE                MOV     R6,A
0305 A3                INC     DPTR
0306 E0                MOVX    A,@DPTR
0307 FF                MOV     R7,A
0308 8F82              MOV     DPL,R7
030A 8E83              MOV     DPH,R6
030C E4                CLR     A
030D 93                MOVC    A,@A+DPTR
030E FF                MOV     R7,A
030F 7400        E     MOV     A,#LOW USB_interfaceSetting
0311 2F                ADD     A,R7
0312 F582              MOV     DPL,A
0314 E4                CLR     A
0315 3400        E     ADDC    A,#HIGH USB_interfaceSetting
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 54  

0317 F583              MOV     DPH,A
0319 E0                MOVX    A,@DPTR
031A FF                MOV     R7,A
031B 90000B            MOV     DPTR,#0BH
031E 120000      E     LCALL   ?C?XBPOFF
0321 E0                MOVX    A,@DPTR
0322 FC                MOV     R4,A
0323 A3                INC     DPTR
0324 E0                MOVX    A,@DPTR
0325 FD                MOV     R5,A
0326 8D82              MOV     DPL,R5
0328 8C83              MOV     DPH,R4
032A 7401              MOV     A,#01H
032C 93                MOVC    A,@A+DPTR
032D FE                MOV     R6,A
032E EF                MOV     A,R7
032F 6E                XRL     A,R6
0330 6003              JZ      $ + 5H
0332 020000      R     LJMP    ?C0084
                                           ; SOURCE LINE # 630
                                           ; SOURCE LINE # 631
0335 90000B            MOV     DPTR,#0BH
0338 120000      E     LCALL   ?C?XBPOFF
033B E0                MOVX    A,@DPTR
033C FE                MOV     R6,A
033D A3                INC     DPTR
033E E0                MOVX    A,@DPTR
033F FF                MOV     R7,A
0340 8F82              MOV     DPL,R7
0342 8E83              MOV     DPH,R6
0344 7403              MOV     A,#03H
0346 93                MOVC    A,@A+DPTR
0347 FF                MOV     R7,A
0348 EF                MOV     A,R7
0349 5403              ANL     A,#03H
034B FF                MOV     R7,A
034C 900003            MOV     DPTR,#03H
034F 120000      E     LCALL   ?C?XBPOFF
0352 EF                MOV     A,R7
0353 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 632
0354 90000B            MOV     DPTR,#0BH
0357 120000      E     LCALL   ?C?XBPOFF
035A E0                MOVX    A,@DPTR
035B FE                MOV     R6,A
035C A3                INC     DPTR
035D E0                MOVX    A,@DPTR
035E FF                MOV     R7,A
035F 8F82              MOV     DPL,R7
0361 8E83              MOV     DPH,R6
0363 7402              MOV     A,#02H
0365 93                MOVC    A,@A+DPTR
0366 FF                MOV     R7,A
0367 EF                MOV     A,R7
0368 5480              ANL     A,#080H
036A FF                MOV     R7,A
036B 7E00              MOV     R6,#00H
036D EF                MOV     A,R7
036E 4E                ORL     A,R6
036F 7003              JNZ     $ + 5H
0371 020000      R     LJMP    ?C0087
                                           ; SOURCE LINE # 633
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 55  

                                           ; SOURCE LINE # 635
0374 850083      E     MOV     DPH,?C_XBP
0377 850082      E     MOV     DPL,?C_XBP+01H
037A A3                INC     DPTR
037B A3                INC     DPTR
037C E0                MOVX    A,@DPTR
037D FF                MOV     R7,A
037E EF                MOV     A,R7
037F 75F00B            MOV     B,#0BH
0382 A4                MUL     AB
0383 2400        E     ADD     A,#LOW USB_EP+01H
0385 F582              MOV     DPL,A
0387 E4                CLR     A
0388 3400        E     ADDC    A,#HIGH USB_EP+01H
038A F583              MOV     DPH,A
038C 7401              MOV     A,#01H
038E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 636
038F 900003            MOV     DPTR,#03H
0392 120000      E     LCALL   ?C?XBPOFF
0395 E0                MOVX    A,@DPTR
0396 FF                MOV     R7,A
0397 EF                MOV     A,R7
0398 B40104            CJNE    A,#01H,?C0088
039B 7F07              MOV     R7,#07H
039D 8002              SJMP    ?C0089
039F         ?C0088:
039F 7F0D              MOV     R7,#0DH
03A1         ?C0089:
03A1 850083      E     MOV     DPH,?C_XBP
03A4 850082      E     MOV     DPL,?C_XBP+01H
03A7 A3                INC     DPTR
03A8 A3                INC     DPTR
03A9 E0                MOVX    A,@DPTR
03AA FE                MOV     R6,A
03AB EE                MOV     A,R6
03AC 75F00B            MOV     B,#0BH
03AF A4                MUL     AB
03B0 2400        E     ADD     A,#LOW USB_EP+05H
03B2 F582              MOV     DPL,A
03B4 E4                CLR     A
03B5 3400        E     ADDC    A,#HIGH USB_EP+05H
03B7 F583              MOV     DPH,A
03B9 EF                MOV     A,R7
03BA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 649
03BB 90000B            MOV     DPTR,#0BH
03BE 120000      E     LCALL   ?C?XBPOFF
03C1 E0                MOVX    A,@DPTR
03C2 FE                MOV     R6,A
03C3 A3                INC     DPTR
03C4 E0                MOVX    A,@DPTR
03C5 FF                MOV     R7,A
03C6 8F82              MOV     DPL,R7
03C8 8E83              MOV     DPH,R6
03CA 7406              MOV     A,#06H
03CC 93                MOVC    A,@A+DPTR
03CD FF                MOV     R7,A
03CE EF                MOV     A,R7
03CF 6401              XRL     A,#01H
03D1 6003              JZ      $ + 5H
03D3 020000      R     LJMP    ?C0091
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 56  

03D6 900003            MOV     DPTR,#03H
03D9 120000      E     LCALL   ?C?XBPOFF
03DC E0                MOVX    A,@DPTR
03DD FF                MOV     R7,A
03DE EF                MOV     A,R7
03DF 6402              XRL     A,#02H
03E1 6003              JZ      $ + 5H
03E3 020000      R     LJMP    ?C0091
                                           ; SOURCE LINE # 651
                                           ; SOURCE LINE # 652
03E6 850083      E     MOV     DPH,?C_XBP
03E9 850082      E     MOV     DPL,?C_XBP+01H
03EC A3                INC     DPTR
03ED A3                INC     DPTR
03EE E0                MOVX    A,@DPTR
03EF FF                MOV     R7,A
03F0 900000      E     MOV     DPTR,#USB_midi_in_ep
03F3 EF                MOV     A,R7
03F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 653
                                           ; SOURCE LINE # 655
03F5 8078              SJMP    ?C0091
03F7         ?C0087:
                                           ; SOURCE LINE # 657
                                           ; SOURCE LINE # 659
03F7 850083      E     MOV     DPH,?C_XBP
03FA 850082      E     MOV     DPL,?C_XBP+01H
03FD A3                INC     DPTR
03FE A3                INC     DPTR
03FF E0                MOVX    A,@DPTR
0400 FF                MOV     R7,A
0401 EF                MOV     A,R7
0402 75F00B            MOV     B,#0BH
0405 A4                MUL     AB
0406 2400        E     ADD     A,#LOW USB_EP+01H
0408 F582              MOV     DPL,A
040A E4                CLR     A
040B 3400        E     ADDC    A,#HIGH USB_EP+01H
040D F583              MOV     DPH,A
040F E4                CLR     A
0410 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 660
0411 900003            MOV     DPTR,#03H
0414 120000      E     LCALL   ?C?XBPOFF
0417 E0                MOVX    A,@DPTR
0418 FF                MOV     R7,A
0419 EF                MOV     A,R7
041A B40104            CJNE    A,#01H,?C0092
041D 7F05              MOV     R7,#05H
041F 8002              SJMP    ?C0093
0421         ?C0092:
0421 7F09              MOV     R7,#09H
0423         ?C0093:
0423 850083      E     MOV     DPH,?C_XBP
0426 850082      E     MOV     DPL,?C_XBP+01H
0429 A3                INC     DPTR
042A A3                INC     DPTR
042B E0                MOVX    A,@DPTR
042C FE                MOV     R6,A
042D EE                MOV     A,R6
042E 75F00B            MOV     B,#0BH
0431 A4                MUL     AB
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 57  

0432 2400        E     ADD     A,#LOW USB_EP+05H
0434 F582              MOV     DPL,A
0436 E4                CLR     A
0437 3400        E     ADDC    A,#HIGH USB_EP+05H
0439 F583              MOV     DPH,A
043B EF                MOV     A,R7
043C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 673
043D 90000B            MOV     DPTR,#0BH
0440 120000      E     LCALL   ?C?XBPOFF
0443 E0                MOVX    A,@DPTR
0444 FE                MOV     R6,A
0445 A3                INC     DPTR
0446 E0                MOVX    A,@DPTR
0447 FF                MOV     R7,A
0448 8F82              MOV     DPL,R7
044A 8E83              MOV     DPH,R6
044C 7406              MOV     A,#06H
044E 93                MOVC    A,@A+DPTR
044F FF                MOV     R7,A
0450 EF                MOV     A,R7
0451 B4011B            CJNE    A,#01H,?C0091
0454 900003            MOV     DPTR,#03H
0457 120000      E     LCALL   ?C?XBPOFF
045A E0                MOVX    A,@DPTR
045B FF                MOV     R7,A
045C EF                MOV     A,R7
045D B4020F            CJNE    A,#02H,?C0091
                                           ; SOURCE LINE # 675
                                           ; SOURCE LINE # 676
0460 850083      E     MOV     DPH,?C_XBP
0463 850082      E     MOV     DPL,?C_XBP+01H
0466 A3                INC     DPTR
0467 A3                INC     DPTR
0468 E0                MOVX    A,@DPTR
0469 FF                MOV     R7,A
046A 900000      E     MOV     DPTR,#USB_midi_out_ep
046D EF                MOV     A,R7
046E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 677
                                           ; SOURCE LINE # 679
046F         ?C0091:
                                           ; SOURCE LINE # 680
046F 90000B            MOV     DPTR,#0BH
0472 120000      E     LCALL   ?C?XBPOFF
0475 E0                MOVX    A,@DPTR
0476 FE                MOV     R6,A
0477 A3                INC     DPTR
0478 E0                MOVX    A,@DPTR
0479 FF                MOV     R7,A
047A 8F82              MOV     DPL,R7
047C 8E83              MOV     DPH,R6
047E 7402              MOV     A,#02H
0480 93                MOVC    A,@A+DPTR
0481 FF                MOV     R7,A
0482 850083      E     MOV     DPH,?C_XBP
0485 850082      E     MOV     DPL,?C_XBP+01H
0488 A3                INC     DPTR
0489 A3                INC     DPTR
048A E0                MOVX    A,@DPTR
048B FE                MOV     R6,A
048C EE                MOV     A,R6
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 58  

048D 75F00B            MOV     B,#0BH
0490 A4                MUL     AB
0491 2400        E     ADD     A,#LOW USB_EP+04H
0493 F582              MOV     DPL,A
0495 E4                CLR     A
0496 3400        E     ADDC    A,#HIGH USB_EP+04H
0498 F583              MOV     DPH,A
049A EF                MOV     A,R7
049B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 681
049C 90000B            MOV     DPTR,#0BH
049F 120000      E     LCALL   ?C?XBPOFF
04A2 E0                MOVX    A,@DPTR
04A3 FE                MOV     R6,A
04A4 A3                INC     DPTR
04A5 E0                MOVX    A,@DPTR
04A6 FF                MOV     R7,A
04A7 8F82              MOV     DPL,R7
04A9 8E83              MOV     DPH,R6
04AB 7403              MOV     A,#03H
04AD 93                MOVC    A,@A+DPTR
04AE FF                MOV     R7,A
04AF 850083      E     MOV     DPH,?C_XBP
04B2 850082      E     MOV     DPL,?C_XBP+01H
04B5 A3                INC     DPTR
04B6 A3                INC     DPTR
04B7 E0                MOVX    A,@DPTR
04B8 FE                MOV     R6,A
04B9 EE                MOV     A,R6
04BA 75F00B            MOV     B,#0BH
04BD A4                MUL     AB
04BE 2400        E     ADD     A,#LOW USB_EP
04C0 F582              MOV     DPL,A
04C2 E4                CLR     A
04C3 3400        E     ADDC    A,#HIGH USB_EP
04C5 F583              MOV     DPH,A
04C7 EF                MOV     A,R7
04C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 686
                                           ; SOURCE LINE # 687
04C9         ?C0084:
                                           ; SOURCE LINE # 688
04C9 90000B            MOV     DPTR,#0BH
04CC 120000      E     LCALL   ?C?XBPOFF
04CF E0                MOVX    A,@DPTR
04D0 FE                MOV     R6,A
04D1 A3                INC     DPTR
04D2 E0                MOVX    A,@DPTR
04D3 FF                MOV     R7,A
04D4 EF                MOV     A,R7
04D5 2407              ADD     A,#07H
04D7 FF                MOV     R7,A
04D8 EE                MOV     A,R6
04D9 3400              ADDC    A,#00H
04DB FE                MOV     R6,A
04DC 90000B            MOV     DPTR,#0BH
04DF 120000      E     LCALL   ?C?XBPOFF
04E2 EE                MOV     A,R6
04E3 F0                MOVX    @DPTR,A
04E4 A3                INC     DPTR
04E5 EF                MOV     A,R7
04E6 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 59  

                                           ; SOURCE LINE # 689
04E7 850083      E     MOV     DPH,?C_XBP
04EA 850082      E     MOV     DPL,?C_XBP+01H
04ED A3                INC     DPTR
04EE E0                MOVX    A,@DPTR
04EF 04                INC     A
04F0 F0                MOVX    @DPTR,A
04F1 020000      R     LJMP    ?C0081
                                           ; SOURCE LINE # 690
04F4         ?C0080:
04F4 850083      E     MOV     DPH,?C_XBP
04F7 850082      E     MOV     DPL,?C_XBP+01H
04FA A3                INC     DPTR
04FB A3                INC     DPTR
04FC E0                MOVX    A,@DPTR
04FD 04                INC     A
04FE F0                MOVX    @DPTR,A
04FF 020000      R     LJMP    ?C0078
0502         ?C0079:
                                           ; SOURCE LINE # 698
0502 900009            MOV     DPTR,#09H
0505 120000      E     LCALL   ?C?XBPOFF
0508 E0                MOVX    A,@DPTR
0509 FE                MOV     R6,A
050A A3                INC     DPTR
050B E0                MOVX    A,@DPTR
050C FF                MOV     R7,A
050D 8F82              MOV     DPL,R7
050F 8E83              MOV     DPH,R6
0511 A3                INC     DPTR
0512 120000      E     LCALL   ?C?PLDCODE
0515 AE02              MOV     R6,AR2
0517 AF01              MOV     R7,AR1
0519 90000B            MOV     DPTR,#0BH
051C 120000      E     LCALL   ?C?XBPOFF
051F EE                MOV     A,R6
0520 F0                MOVX    @DPTR,A
0521 A3                INC     DPTR
0522 EF                MOV     A,R7
0523 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 699
0524 850083      E     MOV     DPH,?C_XBP
0527 850082      E     MOV     DPL,?C_XBP+01H
052A A3                INC     DPTR
052B A3                INC     DPTR
052C E4                CLR     A
052D F0                MOVX    @DPTR,A
052E         ?C0095:
052E 850083      E     MOV     DPH,?C_XBP
0531 850082      E     MOV     DPL,?C_XBP+01H
0534 E0                MOVX    A,@DPTR
0535 FF                MOV     R7,A
0536 850083      E     MOV     DPH,?C_XBP
0539 850082      E     MOV     DPL,?C_XBP+01H
053C A3                INC     DPTR
053D A3                INC     DPTR
053E E0                MOVX    A,@DPTR
053F FE                MOV     R6,A
0540 EE                MOV     A,R6
0541 C3                CLR     C
0542 9F                SUBB    A,R7
0543 5064              JNC     ?C0096
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 60  

                                           ; SOURCE LINE # 700
                                           ; SOURCE LINE # 702
0545 90000B            MOV     DPTR,#0BH
0548 120000      E     LCALL   ?C?XBPOFF
054B E0                MOVX    A,@DPTR
054C FE                MOV     R6,A
054D A3                INC     DPTR
054E E0                MOVX    A,@DPTR
054F FF                MOV     R7,A
0550 8F82              MOV     DPL,R7
0552 8E83              MOV     DPH,R6
0554 E4                CLR     A
0555 93                MOVC    A,@A+DPTR
0556 FF                MOV     R7,A
0557 90000B            MOV     DPTR,#0BH
055A 120000      E     LCALL   ?C?XBPOFF
055D E0                MOVX    A,@DPTR
055E FC                MOV     R4,A
055F A3                INC     DPTR
0560 E0                MOVX    A,@DPTR
0561 FD                MOV     R5,A
0562 8D82              MOV     DPL,R5
0564 8C83              MOV     DPH,R4
0566 7402              MOV     A,#02H
0568 93                MOVC    A,@A+DPTR
0569 FE                MOV     R6,A
056A EE                MOV     A,R6
056B 547F              ANL     A,#07FH
056D FE                MOV     R6,A
056E EE                MOV     A,R6
056F 75F00B            MOV     B,#0BH
0572 A4                MUL     AB
0573 2400        E     ADD     A,#LOW USB_EP+0AH
0575 F582              MOV     DPL,A
0577 E4                CLR     A
0578 3400        E     ADDC    A,#HIGH USB_EP+0AH
057A F583              MOV     DPH,A
057C EF                MOV     A,R7
057D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 703
057E 90000B            MOV     DPTR,#0BH
0581 120000      E     LCALL   ?C?XBPOFF
0584 E0                MOVX    A,@DPTR
0585 FE                MOV     R6,A
0586 A3                INC     DPTR
0587 E0                MOVX    A,@DPTR
0588 FF                MOV     R7,A
0589 EF                MOV     A,R7
058A 2407              ADD     A,#07H
058C FF                MOV     R7,A
058D EE                MOV     A,R6
058E 3400              ADDC    A,#00H
0590 FE                MOV     R6,A
0591 90000B            MOV     DPTR,#0BH
0594 120000      E     LCALL   ?C?XBPOFF
0597 EE                MOV     A,R6
0598 F0                MOVX    @DPTR,A
0599 A3                INC     DPTR
059A EF                MOV     A,R7
059B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 704
059C 850083      E     MOV     DPH,?C_XBP
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 61  

059F 850082      E     MOV     DPL,?C_XBP+01H
05A2 A3                INC     DPTR
05A3 A3                INC     DPTR
05A4 E0                MOVX    A,@DPTR
05A5 04                INC     A
05A6 F0                MOVX    @DPTR,A
05A7 8085              SJMP    ?C0095
05A9         ?C0096:
                                           ; SOURCE LINE # 706
05A9 120000      R     LCALL   _?USB_GetInterfaceClassTablePtr
05AC 900000      E     MOV     DPTR,#USB_interfaceClass
05AF EE                MOV     A,R6
05B0 F0                MOVX    @DPTR,A
05B1 A3                INC     DPTR
05B2 EF                MOV     A,R7
05B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 710
05B4 850083      E     MOV     DPH,?C_XBP
05B7 850082      E     MOV     DPL,?C_XBP+01H
05BA 7401              MOV     A,#01H
05BC F0                MOVX    @DPTR,A
05BD         ?C0098:
05BD 850083      E     MOV     DPH,?C_XBP
05C0 850082      E     MOV     DPL,?C_XBP+01H
05C3 E0                MOVX    A,@DPTR
05C4 FF                MOV     R7,A
05C5 EF                MOV     A,R7
05C6 C3                CLR     C
05C7 9409              SUBB    A,#09H
05C9 5058              JNC     ?C0099
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
05CB 900007            MOV     DPTR,#07H
05CE 120000      E     LCALL   ?C?XBPOFF
05D1 E0                MOVX    A,@DPTR
05D2 FE                MOV     R6,A
05D3 A3                INC     DPTR
05D4 E0                MOVX    A,@DPTR
05D5 FF                MOV     R7,A
05D6 850083      E     MOV     DPH,?C_XBP
05D9 850082      E     MOV     DPL,?C_XBP+01H
05DC E0                MOVX    A,@DPTR
05DD FD                MOV     R5,A
05DE ED                MOV     A,R5
05DF 75F00B            MOV     B,#0BH
05E2 A4                MUL     AB
05E3 2400        E     ADD     A,#LOW USB_EP+06H
05E5 F582              MOV     DPL,A
05E7 E4                CLR     A
05E8 3400        E     ADDC    A,#HIGH USB_EP+06H
05EA F583              MOV     DPH,A
05EC EE                MOV     A,R6
05ED F0                MOVX    @DPTR,A
05EE A3                INC     DPTR
05EF EF                MOV     A,R7
05F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 713
05F1 850083      E     MOV     DPH,?C_XBP
05F4 850082      E     MOV     DPL,?C_XBP+01H
05F7 E0                MOVX    A,@DPTR
05F8 FF                MOV     R7,A
05F9 EF                MOV     A,R7
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 62  

05FA 75F00B            MOV     B,#0BH
05FD A4                MUL     AB
05FE 2400        E     ADD     A,#LOW USB_EP+08H
0600 F582              MOV     DPL,A
0602 E4                CLR     A
0603 3400        E     ADDC    A,#HIGH USB_EP+08H
0605 F583              MOV     DPH,A
0607 E0                MOVX    A,@DPTR
0608 FE                MOV     R6,A
0609 A3                INC     DPTR
060A E0                MOVX    A,@DPTR
060B FF                MOV     R7,A
060C 900007            MOV     DPTR,#07H
060F 120000      E     LCALL   ?C?XBPOFF
0612 EE                MOV     A,R6
0613 8FF0              MOV     B,R7
0615 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 714
0618 850083      E     MOV     DPH,?C_XBP
061B 850082      E     MOV     DPL,?C_XBP+01H
061E E0                MOVX    A,@DPTR
061F 04                INC     A
0620 F0                MOVX    @DPTR,A
0621 809A              SJMP    ?C0098
0623         ?C0099:
                                           ; SOURCE LINE # 718
0623 120000      R     LCALL   _?USB_ConfigReg
                                           ; SOURCE LINE # 719
                                           ; SOURCE LINE # 720
0626         ?C0101:
0626 90000E            MOV     DPTR,#0EH
0629 120000      E     LCALL   ?C?ADDXBP
062C 22                RET     
             ; FUNCTION _?USB_Config (END)

             ; FUNCTION USB_ConfigAltChanged (BEGIN)
                                           ; SOURCE LINE # 741
                                           ; SOURCE LINE # 742
                                           ; SOURCE LINE # 754
0000 900000      E     MOV     DPTR,#USB_configuration
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 D3                SETB    C
0007 9400              SUBB    A,#00H
0009 5003              JNC     $ + 5H
000B 020000      R     LJMP    ?C0113
                                           ; SOURCE LINE # 755
                                           ; SOURCE LINE # 756
000E 900000      E     MOV     DPTR,#USB_configuration
0011 E0                MOVX    A,@DPTR
0012 FF                MOV     R7,A
0013 EF                MOV     A,R7
0014 14                DEC     A
0015 FF                MOV     R7,A
0016 120000      R     LCALL   _?USB_GetConfigTablePtr
0019 900000      R     MOV     DPTR,#pTmp
001C EE                MOV     A,R6
001D F0                MOVX    @DPTR,A
001E A3                INC     DPTR
001F EF                MOV     A,R7
0020 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 63  

                                           ; SOURCE LINE # 757
0021 900000      R     MOV     DPTR,#pTmp
0024 E0                MOVX    A,@DPTR
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 EF                MOV     A,R7
002A 2404              ADD     A,#04H
002C FF                MOV     R7,A
002D EE                MOV     A,R6
002E 3400              ADDC    A,#00H
0030 FE                MOV     R6,A
0031 900000      R     MOV     DPTR,#pTmp
0034 EE                MOV     A,R6
0035 F0                MOVX    @DPTR,A
0036 A3                INC     DPTR
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 758
0039 900000      R     MOV     DPTR,#pTmp
003C E0                MOVX    A,@DPTR
003D FE                MOV     R6,A
003E A3                INC     DPTR
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 8F82              MOV     DPL,R7
0043 8E83              MOV     DPH,R6
0045 E4                CLR     A
0046 93                MOVC    A,@A+DPTR
0047 FF                MOV     R7,A
0048 900000      R     MOV     DPTR,#ep
004B EF                MOV     A,R7
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
004D 900000      R     MOV     DPTR,#pTmp
0050 E0                MOVX    A,@DPTR
0051 FE                MOV     R6,A
0052 A3                INC     DPTR
0053 E0                MOVX    A,@DPTR
0054 FF                MOV     R7,A
0055 8F82              MOV     DPL,R7
0057 8E83              MOV     DPH,R6
0059 A3                INC     DPTR
005A 120000      E     LCALL   ?C?PLDCODE
005D AE02              MOV     R6,AR2
005F AF01              MOV     R7,AR1
0061 900000      R     MOV     DPTR,#pEP
0064 EE                MOV     A,R6
0065 F0                MOVX    @DPTR,A
0066 A3                INC     DPTR
0067 EF                MOV     A,R7
0068 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 764
0069 900000      R     MOV     DPTR,#i
006C E4                CLR     A
006D F0                MOVX    @DPTR,A
006E         ?C0103:
006E 900000      R     MOV     DPTR,#ep
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 900000      R     MOV     DPTR,#i
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 64  

0076 E0                MOVX    A,@DPTR
0077 FE                MOV     R6,A
0078 EE                MOV     A,R6
0079 C3                CLR     C
007A 9F                SUBB    A,R7
007B 4003              JC      $ + 5H
007D 020000      R     LJMP    ?C0113
                                           ; SOURCE LINE # 765
                                           ; SOURCE LINE # 770
0080 900000      R     MOV     DPTR,#pEP
0083 E0                MOVX    A,@DPTR
0084 FE                MOV     R6,A
0085 A3                INC     DPTR
0086 E0                MOVX    A,@DPTR
0087 FF                MOV     R7,A
0088 8F82              MOV     DPL,R7
008A 8E83              MOV     DPH,R6
008C E4                CLR     A
008D 93                MOVC    A,@A+DPTR
008E FF                MOV     R7,A
008F 7400        E     MOV     A,#LOW USB_interfaceSetting_last
0091 2F                ADD     A,R7
0092 F582              MOV     DPL,A
0094 E4                CLR     A
0095 3400        E     ADDC    A,#HIGH USB_interfaceSetting_last
0097 F583              MOV     DPH,A
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B 900000      R     MOV     DPTR,#pEP
009E E0                MOVX    A,@DPTR
009F FC                MOV     R4,A
00A0 A3                INC     DPTR
00A1 E0                MOVX    A,@DPTR
00A2 FD                MOV     R5,A
00A3 8D82              MOV     DPL,R5
00A5 8C83              MOV     DPH,R4
00A7 E4                CLR     A
00A8 93                MOVC    A,@A+DPTR
00A9 FE                MOV     R6,A
00AA 7400        E     MOV     A,#LOW USB_interfaceSetting
00AC 2E                ADD     A,R6
00AD F582              MOV     DPL,A
00AF E4                CLR     A
00B0 3400        E     ADDC    A,#HIGH USB_interfaceSetting
00B2 F583              MOV     DPH,A
00B4 E0                MOVX    A,@DPTR
00B5 FE                MOV     R6,A
00B6 EE                MOV     A,R6
00B7 6F                XRL     A,R7
00B8 7003              JNZ     $ + 5H
00BA 020000      R     LJMP    ?C0106
00BD 900000      R     MOV     DPTR,#pEP
00C0 E0                MOVX    A,@DPTR
00C1 FE                MOV     R6,A
00C2 A3                INC     DPTR
00C3 E0                MOVX    A,@DPTR
00C4 FF                MOV     R7,A
00C5 8F82              MOV     DPL,R7
00C7 8E83              MOV     DPH,R6
00C9 E4                CLR     A
00CA 93                MOVC    A,@A+DPTR
00CB FF                MOV     R7,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 65  

00CC 7400        E     MOV     A,#LOW USB_interfaceSetting
00CE 2F                ADD     A,R7
00CF F582              MOV     DPL,A
00D1 E4                CLR     A
00D2 3400        E     ADDC    A,#HIGH USB_interfaceSetting
00D4 F583              MOV     DPH,A
00D6 E0                MOVX    A,@DPTR
00D7 FF                MOV     R7,A
00D8 900000      R     MOV     DPTR,#pEP
00DB E0                MOVX    A,@DPTR
00DC FC                MOV     R4,A
00DD A3                INC     DPTR
00DE E0                MOVX    A,@DPTR
00DF FD                MOV     R5,A
00E0 8D82              MOV     DPL,R5
00E2 8C83              MOV     DPH,R4
00E4 7401              MOV     A,#01H
00E6 93                MOVC    A,@A+DPTR
00E7 FE                MOV     R6,A
00E8 EF                MOV     A,R7
00E9 6E                XRL     A,R6
00EA 6003              JZ      $ + 5H
00EC 020000      R     LJMP    ?C0106
00EF 900000      R     MOV     DPTR,#pEP
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 8F82              MOV     DPL,R7
00F9 8E83              MOV     DPH,R6
00FB E4                CLR     A
00FC 93                MOVC    A,@A+DPTR
00FD FF                MOV     R7,A
00FE 906004            MOV     DPTR,#06004H
0101 E0                MOVX    A,@DPTR
0102 FE                MOV     R6,A
0103 EF                MOV     A,R7
0104 6E                XRL     A,R6
0105 6003              JZ      $ + 5H
0107 020000      R     LJMP    ?C0106
                                           ; SOURCE LINE # 771
                                           ; SOURCE LINE # 772
010A 900000      R     MOV     DPTR,#pEP
010D E0                MOVX    A,@DPTR
010E FE                MOV     R6,A
010F A3                INC     DPTR
0110 E0                MOVX    A,@DPTR
0111 FF                MOV     R7,A
0112 8F82              MOV     DPL,R7
0114 8E83              MOV     DPH,R6
0116 7402              MOV     A,#02H
0118 93                MOVC    A,@A+DPTR
0119 FF                MOV     R7,A
011A EF                MOV     A,R7
011B 547F              ANL     A,#07FH
011D FF                MOV     R7,A
011E 900000      R     MOV     DPTR,#cur_ep
0121 EF                MOV     A,R7
0122 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 773
0123 900000      R     MOV     DPTR,#cur_ep
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 66  

0126 E0                MOVX    A,@DPTR
0127 FF                MOV     R7,A
0128 7E00              MOV     R6,#00H
012A EF                MOV     A,R7
012B 24FF              ADD     A,#0FFH
012D FF                MOV     R7,A
012E EE                MOV     A,R6
012F 34FF              ADDC    A,#0FFH
0131 FE                MOV     R6,A
0132 EF                MOV     A,R7
0133 C4                SWAP    A
0134 F8                MOV     R0,A
0135 540F              ANL     A,#0FH
0137 C8                XCH     A,R0
0138 68                XRL     A,R0
0139 FF                MOV     R7,A
013A EE                MOV     A,R6
013B C4                SWAP    A
013C 54F0              ANL     A,#0F0H
013E 48                ORL     A,R0
013F FE                MOV     R6,A
0140 900000      R     MOV     DPTR,#ri
0143 EF                MOV     A,R7
0144 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 774
0145 900000      R     MOV     DPTR,#pEP
0148 E0                MOVX    A,@DPTR
0149 FE                MOV     R6,A
014A A3                INC     DPTR
014B E0                MOVX    A,@DPTR
014C FF                MOV     R7,A
014D 8F82              MOV     DPL,R7
014F 8E83              MOV     DPH,R6
0151 7403              MOV     A,#03H
0153 93                MOVC    A,@A+DPTR
0154 FF                MOV     R7,A
0155 EF                MOV     A,R7
0156 5403              ANL     A,#03H
0158 FF                MOV     R7,A
0159 900000      R     MOV     DPTR,#epType
015C EF                MOV     A,R7
015D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 775
015E 900000      R     MOV     DPTR,#pEP
0161 E0                MOVX    A,@DPTR
0162 FE                MOV     R6,A
0163 A3                INC     DPTR
0164 E0                MOVX    A,@DPTR
0165 FF                MOV     R7,A
0166 8F82              MOV     DPL,R7
0168 8E83              MOV     DPH,R6
016A 7402              MOV     A,#02H
016C 93                MOVC    A,@A+DPTR
016D FF                MOV     R7,A
016E EF                MOV     A,R7
016F 5480              ANL     A,#080H
0171 FF                MOV     R7,A
0172 7E00              MOV     R6,#00H
0174 EF                MOV     A,R7
0175 4E                ORL     A,R6
0176 603C              JZ      ?C0107
                                           ; SOURCE LINE # 776
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 67  

                                           ; SOURCE LINE # 778
0178 900000      R     MOV     DPTR,#cur_ep
017B E0                MOVX    A,@DPTR
017C FF                MOV     R7,A
017D EF                MOV     A,R7
017E 75F00B            MOV     B,#0BH
0181 A4                MUL     AB
0182 2400        E     ADD     A,#LOW USB_EP+01H
0184 F582              MOV     DPL,A
0186 E4                CLR     A
0187 3400        E     ADDC    A,#HIGH USB_EP+01H
0189 F583              MOV     DPH,A
018B 7401              MOV     A,#01H
018D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 779
018E 900000      R     MOV     DPTR,#epType
0191 E0                MOVX    A,@DPTR
0192 FF                MOV     R7,A
0193 EF                MOV     A,R7
0194 B40104            CJNE    A,#01H,?C0108
0197 7F07              MOV     R7,#07H
0199 8002              SJMP    ?C0109
019B         ?C0108:
019B 7F0D              MOV     R7,#0DH
019D         ?C0109:
019D 900000      R     MOV     DPTR,#cur_ep
01A0 E0                MOVX    A,@DPTR
01A1 FE                MOV     R6,A
01A2 EE                MOV     A,R6
01A3 75F00B            MOV     B,#0BH
01A6 A4                MUL     AB
01A7 2400        E     ADD     A,#LOW USB_EP+05H
01A9 F582              MOV     DPL,A
01AB E4                CLR     A
01AC 3400        E     ADDC    A,#HIGH USB_EP+05H
01AE F583              MOV     DPH,A
01B0 EF                MOV     A,R7
01B1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 781
01B2 8039              SJMP    ?C0110
01B4         ?C0107:
                                           ; SOURCE LINE # 783
                                           ; SOURCE LINE # 785
01B4 900000      R     MOV     DPTR,#cur_ep
01B7 E0                MOVX    A,@DPTR
01B8 FF                MOV     R7,A
01B9 EF                MOV     A,R7
01BA 75F00B            MOV     B,#0BH
01BD A4                MUL     AB
01BE 2400        E     ADD     A,#LOW USB_EP+01H
01C0 F582              MOV     DPL,A
01C2 E4                CLR     A
01C3 3400        E     ADDC    A,#HIGH USB_EP+01H
01C5 F583              MOV     DPH,A
01C7 E4                CLR     A
01C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 786
01C9 900000      R     MOV     DPTR,#epType
01CC E0                MOVX    A,@DPTR
01CD FF                MOV     R7,A
01CE EF                MOV     A,R7
01CF B40104            CJNE    A,#01H,?C0111
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 68  

01D2 7F05              MOV     R7,#05H
01D4 8002              SJMP    ?C0112
01D6         ?C0111:
01D6 7F09              MOV     R7,#09H
01D8         ?C0112:
01D8 900000      R     MOV     DPTR,#cur_ep
01DB E0                MOVX    A,@DPTR
01DC FE                MOV     R6,A
01DD EE                MOV     A,R6
01DE 75F00B            MOV     B,#0BH
01E1 A4                MUL     AB
01E2 2400        E     ADD     A,#LOW USB_EP+05H
01E4 F582              MOV     DPL,A
01E6 E4                CLR     A
01E7 3400        E     ADDC    A,#HIGH USB_EP+05H
01E9 F583              MOV     DPH,A
01EB EF                MOV     A,R7
01EC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 788
01ED         ?C0110:
                                           ; SOURCE LINE # 790
01ED 900000      R     MOV     DPTR,#ri
01F0 E0                MOVX    A,@DPTR
01F1 FF                MOV     R7,A
01F2 7E00              MOV     R6,#00H
01F4 EF                MOV     A,R7
01F5 240E              ADD     A,#0EH
01F7 FF                MOV     R7,A
01F8 EE                MOV     A,R6
01F9 3460              ADDC    A,#060H
01FB FE                MOV     R6,A
01FC 8F82              MOV     DPL,R7
01FE 8E83              MOV     DPH,R6
0200 7401              MOV     A,#01H
0202 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 791
0203 900000      R     MOV     DPTR,#pEP
0206 E0                MOVX    A,@DPTR
0207 FE                MOV     R6,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FF                MOV     R7,A
020B 8F82              MOV     DPL,R7
020D 8E83              MOV     DPH,R6
020F 7404              MOV     A,#04H
0211 93                MOVC    A,@A+DPTR
0212 FE                MOV     R6,A
0213 7405              MOV     A,#05H
0215 93                MOVC    A,@A+DPTR
0216 FF                MOV     R7,A
0217 900000      R     MOV     DPTR,#cur_ep
021A E0                MOVX    A,@DPTR
021B FD                MOV     R5,A
021C ED                MOV     A,R5
021D 75F00B            MOV     B,#0BH
0220 A4                MUL     AB
0221 2400        E     ADD     A,#LOW USB_EP+08H
0223 F582              MOV     DPL,A
0225 E4                CLR     A
0226 3400        E     ADDC    A,#HIGH USB_EP+08H
0228 F583              MOV     DPH,A
022A EE                MOV     A,R6
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 69  

022B F0                MOVX    @DPTR,A
022C A3                INC     DPTR
022D EF                MOV     A,R7
022E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 792
022F 900000      R     MOV     DPTR,#pEP
0232 E0                MOVX    A,@DPTR
0233 FE                MOV     R6,A
0234 A3                INC     DPTR
0235 E0                MOVX    A,@DPTR
0236 FF                MOV     R7,A
0237 8F82              MOV     DPL,R7
0239 8E83              MOV     DPH,R6
023B 7402              MOV     A,#02H
023D 93                MOVC    A,@A+DPTR
023E FF                MOV     R7,A
023F 900000      R     MOV     DPTR,#cur_ep
0242 E0                MOVX    A,@DPTR
0243 FE                MOV     R6,A
0244 EE                MOV     A,R6
0245 75F00B            MOV     B,#0BH
0248 A4                MUL     AB
0249 2400        E     ADD     A,#LOW USB_EP+04H
024B F582              MOV     DPL,A
024D E4                CLR     A
024E 3400        E     ADDC    A,#HIGH USB_EP+04H
0250 F583              MOV     DPH,A
0252 EF                MOV     A,R7
0253 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 793
0254 900000      R     MOV     DPTR,#pEP
0257 E0                MOVX    A,@DPTR
0258 FE                MOV     R6,A
0259 A3                INC     DPTR
025A E0                MOVX    A,@DPTR
025B FF                MOV     R7,A
025C 8F82              MOV     DPL,R7
025E 8E83              MOV     DPH,R6
0260 7403              MOV     A,#03H
0262 93                MOVC    A,@A+DPTR
0263 FF                MOV     R7,A
0264 900000      R     MOV     DPTR,#cur_ep
0267 E0                MOVX    A,@DPTR
0268 FE                MOV     R6,A
0269 EE                MOV     A,R6
026A 75F00B            MOV     B,#0BH
026D A4                MUL     AB
026E 2400        E     ADD     A,#LOW USB_EP
0270 F582              MOV     DPL,A
0272 E4                CLR     A
0273 3400        E     ADDC    A,#HIGH USB_EP
0275 F583              MOV     DPH,A
0277 EF                MOV     A,R7
0278 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 796
0279 900000      R     MOV     DPTR,#cur_ep
027C E0                MOVX    A,@DPTR
027D FF                MOV     R7,A
027E EF                MOV     A,R7
027F 75F00B            MOV     B,#0BH
0282 A4                MUL     AB
0283 2400        E     ADD     A,#LOW USB_EP+03H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 70  

0285 F582              MOV     DPL,A
0287 E4                CLR     A
0288 3400        E     ADDC    A,#HIGH USB_EP+03H
028A F583              MOV     DPH,A
028C E4                CLR     A
028D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 833
028E 900000      R     MOV     DPTR,#cur_ep
0291 E0                MOVX    A,@DPTR
0292 FF                MOV     R7,A
0293 EF                MOV     A,R7
0294 75F00B            MOV     B,#0BH
0297 A4                MUL     AB
0298 2400        E     ADD     A,#LOW USB_EP+08H
029A F582              MOV     DPL,A
029C E4                CLR     A
029D 3400        E     ADDC    A,#HIGH USB_EP+08H
029F F583              MOV     DPH,A
02A1 E0                MOVX    A,@DPTR
02A2 FE                MOV     R6,A
02A3 A3                INC     DPTR
02A4 E0                MOVX    A,@DPTR
02A5 FF                MOV     R7,A
02A6 EE                MOV     A,R6
02A7 FF                MOV     R7,A
02A8 7E00              MOV     R6,#00H
02AA 900000      R     MOV     DPTR,#ri
02AD E0                MOVX    A,@DPTR
02AE FE                MOV     R6,A
02AF EE                MOV     A,R6
02B0 FD                MOV     R5,A
02B1 7C00              MOV     R4,#00H
02B3 ED                MOV     A,R5
02B4 240C              ADD     A,#0CH
02B6 FD                MOV     R5,A
02B7 EC                MOV     A,R4
02B8 3460              ADDC    A,#060H
02BA FC                MOV     R4,A
02BB 8D82              MOV     DPL,R5
02BD 8C83              MOV     DPH,R4
02BF EF                MOV     A,R7
02C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 835
02C1 900000      R     MOV     DPTR,#cur_ep
02C4 E0                MOVX    A,@DPTR
02C5 FF                MOV     R7,A
02C6 EF                MOV     A,R7
02C7 75F00B            MOV     B,#0BH
02CA A4                MUL     AB
02CB 2400        E     ADD     A,#LOW USB_EP+08H
02CD F582              MOV     DPL,A
02CF E4                CLR     A
02D0 3400        E     ADDC    A,#HIGH USB_EP+08H
02D2 F583              MOV     DPH,A
02D4 E0                MOVX    A,@DPTR
02D5 FE                MOV     R6,A
02D6 A3                INC     DPTR
02D7 E0                MOVX    A,@DPTR
02D8 FF                MOV     R7,A
02D9 EF                MOV     A,R7
02DA 54FF              ANL     A,#0FFH
02DC FF                MOV     R7,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 71  

02DD 900000      R     MOV     DPTR,#ri
02E0 E0                MOVX    A,@DPTR
02E1 FE                MOV     R6,A
02E2 EE                MOV     A,R6
02E3 FD                MOV     R5,A
02E4 7C00              MOV     R4,#00H
02E6 ED                MOV     A,R5
02E7 240D              ADD     A,#0DH
02E9 FD                MOV     R5,A
02EA EC                MOV     A,R4
02EB 3460              ADDC    A,#060H
02ED FC                MOV     R4,A
02EE 8D82              MOV     DPL,R5
02F0 8C83              MOV     DPH,R4
02F2 EF                MOV     A,R7
02F3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 837
02F4 900000      R     MOV     DPTR,#cur_ep
02F7 E0                MOVX    A,@DPTR
02F8 FF                MOV     R7,A
02F9 EF                MOV     A,R7
02FA 75F00B            MOV     B,#0BH
02FD A4                MUL     AB
02FE 2400        E     ADD     A,#LOW USB_EP+06H
0300 F582              MOV     DPL,A
0302 E4                CLR     A
0303 3400        E     ADDC    A,#HIGH USB_EP+06H
0305 F583              MOV     DPH,A
0307 E0                MOVX    A,@DPTR
0308 FE                MOV     R6,A
0309 A3                INC     DPTR
030A E0                MOVX    A,@DPTR
030B FF                MOV     R7,A
030C EF                MOV     A,R7
030D 54FF              ANL     A,#0FFH
030F FF                MOV     R7,A
0310 900000      R     MOV     DPTR,#ri
0313 E0                MOVX    A,@DPTR
0314 FE                MOV     R6,A
0315 EE                MOV     A,R6
0316 FD                MOV     R5,A
0317 7C00              MOV     R4,#00H
0319 ED                MOV     A,R5
031A 2486              ADD     A,#086H
031C FD                MOV     R5,A
031D EC                MOV     A,R4
031E 3460              ADDC    A,#060H
0320 FC                MOV     R4,A
0321 8D82              MOV     DPL,R5
0323 8C83              MOV     DPH,R4
0325 EF                MOV     A,R7
0326 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 839
0327 900000      R     MOV     DPTR,#cur_ep
032A E0                MOVX    A,@DPTR
032B FF                MOV     R7,A
032C EF                MOV     A,R7
032D 75F00B            MOV     B,#0BH
0330 A4                MUL     AB
0331 2400        E     ADD     A,#LOW USB_EP+06H
0333 F582              MOV     DPL,A
0335 E4                CLR     A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 72  

0336 3400        E     ADDC    A,#HIGH USB_EP+06H
0338 F583              MOV     DPH,A
033A E0                MOVX    A,@DPTR
033B FE                MOV     R6,A
033C A3                INC     DPTR
033D E0                MOVX    A,@DPTR
033E FF                MOV     R7,A
033F EE                MOV     A,R6
0340 FF                MOV     R7,A
0341 7E00              MOV     R6,#00H
0343 900000      R     MOV     DPTR,#ri
0346 E0                MOVX    A,@DPTR
0347 FE                MOV     R6,A
0348 EE                MOV     A,R6
0349 FD                MOV     R5,A
034A 7C00              MOV     R4,#00H
034C ED                MOV     A,R5
034D 2487              ADD     A,#087H
034F FD                MOV     R5,A
0350 EC                MOV     A,R4
0351 3460              ADDC    A,#060H
0353 FC                MOV     R4,A
0354 8D82              MOV     DPL,R5
0356 8C83              MOV     DPH,R4
0358 EF                MOV     A,R7
0359 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 841
035A 900000      R     MOV     DPTR,#cur_ep
035D E0                MOVX    A,@DPTR
035E FF                MOV     R7,A
035F EF                MOV     A,R7
0360 75F00B            MOV     B,#0BH
0363 A4                MUL     AB
0364 2400        E     ADD     A,#LOW USB_EP+06H
0366 F582              MOV     DPL,A
0368 E4                CLR     A
0369 3400        E     ADDC    A,#HIGH USB_EP+06H
036B F583              MOV     DPH,A
036D E0                MOVX    A,@DPTR
036E FE                MOV     R6,A
036F A3                INC     DPTR
0370 E0                MOVX    A,@DPTR
0371 FF                MOV     R7,A
0372 EF                MOV     A,R7
0373 54FF              ANL     A,#0FFH
0375 FF                MOV     R7,A
0376 900000      R     MOV     DPTR,#ri
0379 E0                MOVX    A,@DPTR
037A FE                MOV     R6,A
037B EE                MOV     A,R6
037C FD                MOV     R5,A
037D 7C00              MOV     R4,#00H
037F ED                MOV     A,R5
0380 2484              ADD     A,#084H
0382 FD                MOV     R5,A
0383 EC                MOV     A,R4
0384 3460              ADDC    A,#060H
0386 FC                MOV     R4,A
0387 8D82              MOV     DPL,R5
0389 8C83              MOV     DPH,R4
038B EF                MOV     A,R7
038C F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 73  

                                           ; SOURCE LINE # 843
038D 900000      R     MOV     DPTR,#cur_ep
0390 E0                MOVX    A,@DPTR
0391 FF                MOV     R7,A
0392 EF                MOV     A,R7
0393 75F00B            MOV     B,#0BH
0396 A4                MUL     AB
0397 2400        E     ADD     A,#LOW USB_EP+06H
0399 F582              MOV     DPL,A
039B E4                CLR     A
039C 3400        E     ADDC    A,#HIGH USB_EP+06H
039E F583              MOV     DPH,A
03A0 E0                MOVX    A,@DPTR
03A1 FE                MOV     R6,A
03A2 A3                INC     DPTR
03A3 E0                MOVX    A,@DPTR
03A4 FF                MOV     R7,A
03A5 EE                MOV     A,R6
03A6 FF                MOV     R7,A
03A7 7E00              MOV     R6,#00H
03A9 900000      R     MOV     DPTR,#ri
03AC E0                MOVX    A,@DPTR
03AD FE                MOV     R6,A
03AE EE                MOV     A,R6
03AF FD                MOV     R5,A
03B0 7C00              MOV     R4,#00H
03B2 ED                MOV     A,R5
03B3 2485              ADD     A,#085H
03B5 FD                MOV     R5,A
03B6 EC                MOV     A,R4
03B7 3460              ADDC    A,#060H
03B9 FC                MOV     R4,A
03BA 8D82              MOV     DPL,R5
03BC 8C83              MOV     DPH,R4
03BE EF                MOV     A,R7
03BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 845
03C0         ?C0106:
                                           ; SOURCE LINE # 847
03C0 900000      R     MOV     DPTR,#pEP
03C3 E0                MOVX    A,@DPTR
03C4 FE                MOV     R6,A
03C5 A3                INC     DPTR
03C6 E0                MOVX    A,@DPTR
03C7 FF                MOV     R7,A
03C8 EF                MOV     A,R7
03C9 2407              ADD     A,#07H
03CB FF                MOV     R7,A
03CC EE                MOV     A,R6
03CD 3400              ADDC    A,#00H
03CF FE                MOV     R6,A
03D0 900000      R     MOV     DPTR,#pEP
03D3 EE                MOV     A,R6
03D4 F0                MOVX    @DPTR,A
03D5 A3                INC     DPTR
03D6 EF                MOV     A,R7
03D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 848
03D8 900000      R     MOV     DPTR,#i
03DB E0                MOVX    A,@DPTR
03DC 04                INC     A
03DD F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 74  

03DE 020000      R     LJMP    ?C0103
                                           ; SOURCE LINE # 849
                                           ; SOURCE LINE # 850
03E1         ?C0113:
03E1 22                RET     
             ; FUNCTION USB_ConfigAltChanged (END)

             ; FUNCTION _?USB_GetConfigTablePtr (BEGIN)
                                           ; SOURCE LINE # 867
0000 90FFFF            MOV     DPTR,#0FFFFH
0003 120000      E     LCALL   ?C?ADDXBP
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
0008 90FFFE            MOV     DPTR,#0FFFEH
000B 120000      E     LCALL   ?C?ADDXBP
                                           ; SOURCE LINE # 868
                                           ; SOURCE LINE # 873
000E 900000      E     MOV     DPTR,#USB_device
0011 E0                MOVX    A,@DPTR
0012 FF                MOV     R7,A
0013 EF                MOV     A,R7
0014 25E0              ADD     A,ACC
0016 25E0              ADD     A,ACC
0018 2400        E     ADD     A,#LOW USB_TABLE+01H
001A F582              MOV     DPL,A
001C E4                CLR     A
001D 3400        E     ADDC    A,#HIGH USB_TABLE+01H
001F F583              MOV     DPH,A
0021 120000      E     LCALL   ?C?PLDCODE
0024 AE02              MOV     R6,AR2
0026 AF01              MOV     R7,AR1
0028 850083      E     MOV     DPH,?C_XBP
002B 850082      E     MOV     DPL,?C_XBP+01H
002E EE                MOV     A,R6
002F F0                MOVX    @DPTR,A
0030 A3                INC     DPTR
0031 EF                MOV     A,R7
0032 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 879
0033 850083      E     MOV     DPH,?C_XBP
0036 850082      E     MOV     DPL,?C_XBP+01H
0039 E0                MOVX    A,@DPTR
003A FE                MOV     R6,A
003B A3                INC     DPTR
003C E0                MOVX    A,@DPTR
003D FF                MOV     R7,A
003E EF                MOV     A,R7
003F 2404              ADD     A,#04H
0041 FF                MOV     R7,A
0042 EE                MOV     A,R6
0043 3400              ADDC    A,#00H
0045 FE                MOV     R6,A
0046 850083      E     MOV     DPH,?C_XBP
0049 850082      E     MOV     DPL,?C_XBP+01H
004C EE                MOV     A,R6
004D F0                MOVX    @DPTR,A
004E A3                INC     DPTR
004F EF                MOV     A,R7
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 881
0051 850083      E     MOV     DPH,?C_XBP
0054 850082      E     MOV     DPL,?C_XBP+01H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 75  

0057 E0                MOVX    A,@DPTR
0058 FE                MOV     R6,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C 8F82              MOV     DPL,R7
005E 8E83              MOV     DPH,R6
0060 E4                CLR     A
0061 93                MOVC    A,@A+DPTR
0062 FF                MOV     R7,A
0063 850083      E     MOV     DPH,?C_XBP
0066 850082      E     MOV     DPL,?C_XBP+01H
0069 A3                INC     DPTR
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FE                MOV     R6,A
006D EE                MOV     A,R6
006E C3                CLR     C
006F 9F                SUBB    A,R7
0070 400D              JC      ?C0114
                                           ; SOURCE LINE # 882
                                           ; SOURCE LINE # 883
0072 850083      E     MOV     DPH,?C_XBP
0075 850082      E     MOV     DPL,?C_XBP+01H
0078 E4                CLR     A
0079 F0                MOVX    @DPTR,A
007A A3                INC     DPTR
007B E4                CLR     A
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 884
007D 803B              SJMP    ?C0115
007F         ?C0114:
                                           ; SOURCE LINE # 886
                                           ; SOURCE LINE # 887
007F 850083      E     MOV     DPH,?C_XBP
0082 850082      E     MOV     DPL,?C_XBP+01H
0085 E0                MOVX    A,@DPTR
0086 FE                MOV     R6,A
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 FF                MOV     R7,A
008A 8F82              MOV     DPL,R7
008C 8E83              MOV     DPH,R6
008E C083              PUSH    DPH
0090 C082              PUSH    DPL
0092 850083      E     MOV     DPH,?C_XBP
0095 850082      E     MOV     DPL,?C_XBP+01H
0098 A3                INC     DPTR
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B FF                MOV     R7,A
009C D082              POP     DPL
009E D083              POP     DPH
00A0 75F004            MOV     B,#04H
00A3 EF                MOV     A,R7
00A4 120000      E     LCALL   ?C?OFFXADD
00A7 A3                INC     DPTR
00A8 120000      E     LCALL   ?C?PLDCODE
00AB AE02              MOV     R6,AR2
00AD AF01              MOV     R7,AR1
00AF 850083      E     MOV     DPH,?C_XBP
00B2 850082      E     MOV     DPL,?C_XBP+01H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 76  

00B5 EE                MOV     A,R6
00B6 F0                MOVX    @DPTR,A
00B7 A3                INC     DPTR
00B8 EF                MOV     A,R7
00B9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 888
00BA         ?C0115:
                                           ; SOURCE LINE # 890
00BA 850083      E     MOV     DPH,?C_XBP
00BD 850082      E     MOV     DPL,?C_XBP+01H
00C0 E0                MOVX    A,@DPTR
00C1 FE                MOV     R6,A
00C2 A3                INC     DPTR
00C3 E0                MOVX    A,@DPTR
00C4 FF                MOV     R7,A
                                           ; SOURCE LINE # 891
00C5         ?C0116:
00C5 900003            MOV     DPTR,#03H
00C8 120000      E     LCALL   ?C?ADDXBP
00CB 22                RET     
             ; FUNCTION _?USB_GetConfigTablePtr (END)

             ; FUNCTION USB_GetDeviceTablePtr (BEGIN)
                                           ; SOURCE LINE # 908
                                           ; SOURCE LINE # 910
                                           ; SOURCE LINE # 912
0000 900000      E     MOV     DPTR,#USB_device
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 25E0              ADD     A,ACC
0008 25E0              ADD     A,ACC
000A 2400        E     ADD     A,#LOW USB_TABLE+01H
000C F582              MOV     DPL,A
000E E4                CLR     A
000F 3400        E     ADDC    A,#HIGH USB_TABLE+01H
0011 F583              MOV     DPH,A
0013 120000      E     LCALL   ?C?PLDCODE
0016 AE02              MOV     R6,AR2
0018 AF01              MOV     R7,AR1
                                           ; SOURCE LINE # 913
001A         ?C0117:
001A 22                RET     
             ; FUNCTION USB_GetDeviceTablePtr (END)

             ; FUNCTION _?USB_GetInterfaceClassTablePtr (BEGIN)
                                           ; SOURCE LINE # 931
0000 90FFFB            MOV     DPTR,#0FFFBH
0003 120000      E     LCALL   ?C?ADDXBP
                                           ; SOURCE LINE # 932
                                           ; SOURCE LINE # 938
0006 900000      E     MOV     DPTR,#USB_configuration
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B EF                MOV     A,R7
000C 14                DEC     A
000D FF                MOV     R7,A
000E 120000      R     LCALL   _?USB_GetConfigTablePtr
0011 850083      E     MOV     DPH,?C_XBP
0014 850082      E     MOV     DPL,?C_XBP+01H
0017 EE                MOV     A,R6
0018 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 77  

0019 A3                INC     DPTR
001A EF                MOV     A,R7
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 939
001C 850083      E     MOV     DPH,?C_XBP
001F 850082      E     MOV     DPL,?C_XBP+01H
0022 E0                MOVX    A,@DPTR
0023 FE                MOV     R6,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FF                MOV     R7,A
0027 EF                MOV     A,R7
0028 4E                ORL     A,R6
0029 7003              JNZ     $ + 5H
002B 020000      R     LJMP    ?C0118
                                           ; SOURCE LINE # 940
                                           ; SOURCE LINE # 941
002E 850083      E     MOV     DPH,?C_XBP
0031 850082      E     MOV     DPL,?C_XBP+01H
0034 E0                MOVX    A,@DPTR
0035 FE                MOV     R6,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 FF                MOV     R7,A
0039 8F82              MOV     DPL,R7
003B 8E83              MOV     DPH,R6
003D A3                INC     DPTR
003E 120000      E     LCALL   ?C?PLDCODE
0041 E9                MOV     A,R1
0042 2404              ADD     A,#04H
0044 F9                MOV     R1,A
0045 EA                MOV     A,R2
0046 3400              ADDC    A,#00H
0048 FA                MOV     R2,A
0049 120000      E     LCALL   ?C?CLDPTR
004C FF                MOV     R7,A
004D 900004            MOV     DPTR,#04H
0050 120000      E     LCALL   ?C?XBPOFF
0053 EF                MOV     A,R7
0054 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 944
0055 900004            MOV     DPTR,#04H
0058 120000      E     LCALL   ?C?XBPOFF
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D 7E00              MOV     R6,#00H
005F EF                MOV     A,R7
0060 2402              ADD     A,#02H
0062 FF                MOV     R7,A
0063 EE                MOV     A,R6
0064 3400              ADDC    A,#00H
0066 FE                MOV     R6,A
0067 EF                MOV     A,R7
0068 7802              MOV     R0,#02H
006A         ?C0143:
006A C3                CLR     C
006B 33                RLC     A
006C CE                XCH     A,R6
006D 33                RLC     A
006E CE                XCH     A,R6
006F D8F9              DJNZ    R0,?C0143
0071 FF                MOV     R7,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 78  

0072 850083      E     MOV     DPH,?C_XBP
0075 850082      E     MOV     DPL,?C_XBP+01H
0078 E0                MOVX    A,@DPTR
0079 FC                MOV     R4,A
007A A3                INC     DPTR
007B E0                MOVX    A,@DPTR
007C FD                MOV     R5,A
007D EF                MOV     A,R7
007E 2D                ADD     A,R5
007F FF                MOV     R7,A
0080 EE                MOV     A,R6
0081 3C                ADDC    A,R4
0082 FE                MOV     R6,A
0083 850083      E     MOV     DPH,?C_XBP
0086 850082      E     MOV     DPL,?C_XBP+01H
0089 EE                MOV     A,R6
008A F0                MOVX    @DPTR,A
008B A3                INC     DPTR
008C EF                MOV     A,R7
008D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 945
008E 850083      E     MOV     DPH,?C_XBP
0091 850082      E     MOV     DPL,?C_XBP+01H
0094 E0                MOVX    A,@DPTR
0095 FE                MOV     R6,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FF                MOV     R7,A
0099 8F82              MOV     DPL,R7
009B 8E83              MOV     DPH,R6
009D A3                INC     DPTR
009E 120000      E     LCALL   ?C?PLDCODE
00A1 AE02              MOV     R6,AR2
00A3 AF01              MOV     R7,AR1
00A5 850083      E     MOV     DPH,?C_XBP
00A8 850082      E     MOV     DPL,?C_XBP+01H
00AB A3                INC     DPTR
00AC A3                INC     DPTR
00AD EE                MOV     A,R6
00AE F0                MOVX    @DPTR,A
00AF A3                INC     DPTR
00B0 EF                MOV     A,R7
00B1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 946
00B2 800D              SJMP    ?C0119
00B4         ?C0118:
                                           ; SOURCE LINE # 948
                                           ; SOURCE LINE # 949
00B4 850083      E     MOV     DPH,?C_XBP
00B7 850082      E     MOV     DPL,?C_XBP+01H
00BA A3                INC     DPTR
00BB A3                INC     DPTR
00BC E4                CLR     A
00BD F0                MOVX    @DPTR,A
00BE A3                INC     DPTR
00BF E4                CLR     A
00C0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 950
00C1         ?C0119:
                                           ; SOURCE LINE # 952
00C1 850083      E     MOV     DPH,?C_XBP
00C4 850082      E     MOV     DPL,?C_XBP+01H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 79  

00C7 A3                INC     DPTR
00C8 A3                INC     DPTR
00C9 E0                MOVX    A,@DPTR
00CA FE                MOV     R6,A
00CB A3                INC     DPTR
00CC E0                MOVX    A,@DPTR
00CD FF                MOV     R7,A
                                           ; SOURCE LINE # 953
00CE         ?C0120:
00CE 900005            MOV     DPTR,#05H
00D1 120000      E     LCALL   ?C?ADDXBP
00D4 22                RET     
             ; FUNCTION _?USB_GetInterfaceClassTablePtr (END)

             ; FUNCTION _USB_TerminateEP (BEGIN)
                                           ; SOURCE LINE # 974
0000 900000      R     MOV     DPTR,#ep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
                                           ; SOURCE LINE # 978
0005 900000      R     MOV     DPTR,#ep
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 547F              ANL     A,#07FH
000D FF                MOV     R7,A
000E 900000      R     MOV     DPTR,#ep
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 979
0013 900000      R     MOV     DPTR,#ep
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 7E00              MOV     R6,#00H
001A EF                MOV     A,R7
001B 24FF              ADD     A,#0FFH
001D FF                MOV     R7,A
001E EE                MOV     A,R6
001F 34FF              ADDC    A,#0FFH
0021 FE                MOV     R6,A
0022 EF                MOV     A,R7
0023 C4                SWAP    A
0024 F8                MOV     R0,A
0025 540F              ANL     A,#0FH
0027 C8                XCH     A,R0
0028 68                XRL     A,R0
0029 FF                MOV     R7,A
002A EE                MOV     A,R6
002B C4                SWAP    A
002C 54F0              ANL     A,#0F0H
002E 48                ORL     A,R0
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ri
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 981
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B D3                SETB    C
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 80  

003C 9400              SUBB    A,#00H
003E 5003              JNC     $ + 5H
0040 020000      R     LJMP    ?C0124
0043 900000      R     MOV     DPTR,#ep
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 9409              SUBB    A,#09H
004C 4003              JC      $ + 5H
004E 020000      R     LJMP    ?C0124
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 984
0051 900000      R     MOV     DPTR,#ep
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 EF                MOV     A,R7
0057 75F00B            MOV     B,#0BH
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW USB_EP+02H
005D F582              MOV     DPL,A
005F E4                CLR     A
0060 3400        E     ADDC    A,#HIGH USB_EP+02H
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 EF                MOV     A,R7
0067 4401              ORL     A,#01H
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 987
006C 900000      R     MOV     DPTR,#ep
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 75F00B            MOV     B,#0BH
0075 A4                MUL     AB
0076 2400        E     ADD     A,#LOW USB_EP+03H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        E     ADDC    A,#HIGH USB_EP+03H
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 988
0081 900000      R     MOV     DPTR,#ep
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 EF                MOV     A,R7
0087 75F00B            MOV     B,#0BH
008A A4                MUL     AB
008B 2400        E     ADD     A,#LOW USB_EP+01H
008D F582              MOV     DPL,A
008F E4                CLR     A
0090 3400        E     ADDC    A,#HIGH USB_EP+01H
0092 F583              MOV     DPH,A
0094 7402              MOV     A,#02H
0096 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 990
0097 900000      R     MOV     DPTR,#ep
009A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 81  

009B FF                MOV     R7,A
009C EF                MOV     A,R7
009D 75F00B            MOV     B,#0BH
00A0 A4                MUL     AB
00A1 2400        E     ADD     A,#LOW USB_EP+04H
00A3 F582              MOV     DPL,A
00A5 E4                CLR     A
00A6 3400        E     ADDC    A,#HIGH USB_EP+04H
00A8 F583              MOV     DPH,A
00AA E0                MOVX    A,@DPTR
00AB FF                MOV     R7,A
00AC EF                MOV     A,R7
00AD 5480              ANL     A,#080H
00AF FF                MOV     R7,A
00B0 7E00              MOV     R6,#00H
00B2 EF                MOV     A,R7
00B3 4E                ORL     A,R6
00B4 6017              JZ      ?C0122
                                           ; SOURCE LINE # 991
                                           ; SOURCE LINE # 993
00B6 900000      R     MOV     DPTR,#ri
00B9 E0                MOVX    A,@DPTR
00BA FF                MOV     R7,A
00BB 7E00              MOV     R6,#00H
00BD EF                MOV     A,R7
00BE 240E              ADD     A,#0EH
00C0 FF                MOV     R7,A
00C1 EE                MOV     A,R6
00C2 3460              ADDC    A,#060H
00C4 FE                MOV     R6,A
00C5 8F82              MOV     DPL,R7
00C7 8E83              MOV     DPH,R6
00C9 740C              MOV     A,#0CH
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 994
00CC 22                RET     
00CD         ?C0122:
                                           ; SOURCE LINE # 996
                                           ; SOURCE LINE # 998
00CD 900000      R     MOV     DPTR,#ri
00D0 E0                MOVX    A,@DPTR
00D1 FF                MOV     R7,A
00D2 7E00              MOV     R6,#00H
00D4 EF                MOV     A,R7
00D5 240E              ADD     A,#0EH
00D7 FF                MOV     R7,A
00D8 EE                MOV     A,R6
00D9 3460              ADDC    A,#060H
00DB FE                MOV     R6,A
00DC 8F82              MOV     DPL,R7
00DE 8E83              MOV     DPH,R6
00E0 7408              MOV     A,#08H
00E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 999
                                           ; SOURCE LINE # 1000
                                           ; SOURCE LINE # 1001
00E3         ?C0124:
00E3 22                RET     
             ; FUNCTION _USB_TerminateEP (END)

             ; FUNCTION USB_SetEndpointHalt (BEGIN)
                                           ; SOURCE LINE # 1021
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 82  

                                           ; SOURCE LINE # 1022
                                           ; SOURCE LINE # 1025
0000 900000      R     MOV     DPTR,#requestHandled
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1028
0005 906004            MOV     DPTR,#06004H
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 547F              ANL     A,#07FH
000D FF                MOV     R7,A
000E 900000      R     MOV     DPTR,#ep
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1029
0013 900000      R     MOV     DPTR,#ep
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 7E00              MOV     R6,#00H
001A EF                MOV     A,R7
001B 24FF              ADD     A,#0FFH
001D FF                MOV     R7,A
001E EE                MOV     A,R6
001F 34FF              ADDC    A,#0FFH
0021 FE                MOV     R6,A
0022 EF                MOV     A,R7
0023 C4                SWAP    A
0024 F8                MOV     R0,A
0025 540F              ANL     A,#0FH
0027 C8                XCH     A,R0
0028 68                XRL     A,R0
0029 FF                MOV     R7,A
002A EE                MOV     A,R6
002B C4                SWAP    A
002C 54F0              ANL     A,#0F0H
002E 48                ORL     A,R0
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ri
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1031
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9400              SUBB    A,#00H
003E 5003              JNC     $ + 5H
0040 020000      R     LJMP    ?C0125
0043 900000      R     MOV     DPTR,#ep
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 9409              SUBB    A,#09H
004C 4003              JC      $ + 5H
004E 020000      R     LJMP    ?C0125
                                           ; SOURCE LINE # 1032
                                           ; SOURCE LINE # 1034
0051 900000      R     MOV     DPTR,#ep
0054 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 83  

0055 FF                MOV     R7,A
0056 EF                MOV     A,R7
0057 75F00B            MOV     B,#0BH
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW USB_EP+02H
005D F582              MOV     DPL,A
005F E4                CLR     A
0060 3400        E     ADDC    A,#HIGH USB_EP+02H
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 EF                MOV     A,R7
0067 4401              ORL     A,#01H
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1037
006C 900000      R     MOV     DPTR,#ep
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 75F00B            MOV     B,#0BH
0075 A4                MUL     AB
0076 2400        E     ADD     A,#LOW USB_EP+03H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        E     ADDC    A,#HIGH USB_EP+03H
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1038
0081 900000      R     MOV     DPTR,#ep
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 EF                MOV     A,R7
0087 75F00B            MOV     B,#0BH
008A A4                MUL     AB
008B 2400        E     ADD     A,#LOW USB_EP+01H
008D F582              MOV     DPL,A
008F E4                CLR     A
0090 3400        E     ADDC    A,#HIGH USB_EP+01H
0092 F583              MOV     DPH,A
0094 E0                MOVX    A,@DPTR
0095 FF                MOV     R7,A
0096 EF                MOV     A,R7
0097 4402              ORL     A,#02H
0099 FF                MOV     R7,A
009A EF                MOV     A,R7
009B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1040
009C 900000      R     MOV     DPTR,#ep
009F E0                MOVX    A,@DPTR
00A0 FF                MOV     R7,A
00A1 EF                MOV     A,R7
00A2 75F00B            MOV     B,#0BH
00A5 A4                MUL     AB
00A6 2400        E     ADD     A,#LOW USB_EP+04H
00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        E     ADDC    A,#HIGH USB_EP+04H
00AD F583              MOV     DPH,A
00AF E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 84  

00B0 FF                MOV     R7,A
00B1 EF                MOV     A,R7
00B2 5480              ANL     A,#080H
00B4 FF                MOV     R7,A
00B5 7E00              MOV     R6,#00H
00B7 EF                MOV     A,R7
00B8 4E                ORL     A,R6
00B9 6018              JZ      ?C0126
                                           ; SOURCE LINE # 1041
                                           ; SOURCE LINE # 1044
00BB 900000      R     MOV     DPTR,#ri
00BE E0                MOVX    A,@DPTR
00BF FF                MOV     R7,A
00C0 7E00              MOV     R6,#00H
00C2 EF                MOV     A,R7
00C3 240E              ADD     A,#0EH
00C5 FF                MOV     R7,A
00C6 EE                MOV     A,R6
00C7 3460              ADDC    A,#060H
00C9 FE                MOV     R6,A
00CA 8F82              MOV     DPL,R7
00CC 8E83              MOV     DPH,R6
00CE 748D              MOV     A,#08DH
00D0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1045
00D1 8016              SJMP    ?C0127
00D3         ?C0126:
                                           ; SOURCE LINE # 1047
                                           ; SOURCE LINE # 1050
00D3 900000      R     MOV     DPTR,#ri
00D6 E0                MOVX    A,@DPTR
00D7 FF                MOV     R7,A
00D8 7E00              MOV     R6,#00H
00DA EF                MOV     A,R7
00DB 240E              ADD     A,#0EH
00DD FF                MOV     R7,A
00DE EE                MOV     A,R6
00DF 3460              ADDC    A,#060H
00E1 FE                MOV     R6,A
00E2 8F82              MOV     DPL,R7
00E4 8E83              MOV     DPH,R6
00E6 7489              MOV     A,#089H
00E8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1051
00E9         ?C0127:
                                           ; SOURCE LINE # 1052
00E9 120000      E     LCALL   USB_InitNoDataControlTransfer
00EC 900000      R     MOV     DPTR,#requestHandled
00EF EF                MOV     A,R7
00F0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1053
00F1         ?C0125:
                                           ; SOURCE LINE # 1055
00F1 900000      R     MOV     DPTR,#requestHandled
00F4 E0                MOVX    A,@DPTR
00F5 FF                MOV     R7,A
                                           ; SOURCE LINE # 1056
00F6         ?C0128:
00F6 22                RET     
             ; FUNCTION USB_SetEndpointHalt (END)

             ; FUNCTION USB_ClearEndpointHalt (BEGIN)
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 85  

                                           ; SOURCE LINE # 1076
                                           ; SOURCE LINE # 1077
                                           ; SOURCE LINE # 1080
0000 900000      R     MOV     DPTR,#requestHandled
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1083
0005 906004            MOV     DPTR,#06004H
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 547F              ANL     A,#07FH
000D FF                MOV     R7,A
000E 900000      R     MOV     DPTR,#ep
0011 EF                MOV     A,R7
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1084
0013 900000      R     MOV     DPTR,#ep
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 7E00              MOV     R6,#00H
001A EF                MOV     A,R7
001B 24FF              ADD     A,#0FFH
001D FF                MOV     R7,A
001E EE                MOV     A,R6
001F 34FF              ADDC    A,#0FFH
0021 FE                MOV     R6,A
0022 EF                MOV     A,R7
0023 C4                SWAP    A
0024 F8                MOV     R0,A
0025 540F              ANL     A,#0FH
0027 C8                XCH     A,R0
0028 68                XRL     A,R0
0029 FF                MOV     R7,A
002A EE                MOV     A,R6
002B C4                SWAP    A
002C 54F0              ANL     A,#0F0H
002E 48                ORL     A,R0
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ri
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1086
0035 900000      R     MOV     DPTR,#ep
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B D3                SETB    C
003C 9400              SUBB    A,#00H
003E 5003              JNC     $ + 5H
0040 020000      R     LJMP    ?C0129
0043 900000      R     MOV     DPTR,#ep
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 9409              SUBB    A,#09H
004C 4003              JC      $ + 5H
004E 020000      R     LJMP    ?C0129
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1089
0051 900000      R     MOV     DPTR,#ep
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 86  

0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 EF                MOV     A,R7
0057 75F00B            MOV     B,#0BH
005A A4                MUL     AB
005B 2400        E     ADD     A,#LOW USB_EP+02H
005D F582              MOV     DPL,A
005F E4                CLR     A
0060 3400        E     ADDC    A,#HIGH USB_EP+02H
0062 F583              MOV     DPH,A
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 EF                MOV     A,R7
0067 54FE              ANL     A,#0FEH
0069 FF                MOV     R7,A
006A EF                MOV     A,R7
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1092
006C 900000      R     MOV     DPTR,#ep
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 75F00B            MOV     B,#0BH
0075 A4                MUL     AB
0076 2400        E     ADD     A,#LOW USB_EP+03H
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        E     ADDC    A,#HIGH USB_EP+03H
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1095
0081 900000      R     MOV     DPTR,#ri
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 7E00              MOV     R6,#00H
0088 EF                MOV     A,R7
0089 240C              ADD     A,#0CH
008B FF                MOV     R7,A
008C EE                MOV     A,R6
008D 3460              ADDC    A,#060H
008F FE                MOV     R6,A
0090 8F82              MOV     DPL,R7
0092 8E83              MOV     DPH,R6
0094 E0                MOVX    A,@DPTR
0095 FF                MOV     R7,A
0096 EF                MOV     A,R7
0097 547F              ANL     A,#07FH
0099 FF                MOV     R7,A
009A EF                MOV     A,R7
009B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1097
009C 900000      R     MOV     DPTR,#ep
009F E0                MOVX    A,@DPTR
00A0 FF                MOV     R7,A
00A1 EF                MOV     A,R7
00A2 75F00B            MOV     B,#0BH
00A5 A4                MUL     AB
00A6 2400        E     ADD     A,#LOW USB_EP+01H
00A8 F582              MOV     DPL,A
00AA E4                CLR     A
00AB 3400        E     ADDC    A,#HIGH USB_EP+01H
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 87  

00AD F583              MOV     DPH,A
00AF E0                MOVX    A,@DPTR
00B0 FF                MOV     R7,A
00B1 EF                MOV     A,R7
00B2 54FD              ANL     A,#0FDH
00B4 FF                MOV     R7,A
00B5 EF                MOV     A,R7
00B6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1099
00B7 900000      R     MOV     DPTR,#ep
00BA E0                MOVX    A,@DPTR
00BB FF                MOV     R7,A
00BC EF                MOV     A,R7
00BD 75F00B            MOV     B,#0BH
00C0 A4                MUL     AB
00C1 2400        E     ADD     A,#LOW USB_EP+04H
00C3 F582              MOV     DPL,A
00C5 E4                CLR     A
00C6 3400        E     ADDC    A,#HIGH USB_EP+04H
00C8 F583              MOV     DPH,A
00CA E0                MOVX    A,@DPTR
00CB FF                MOV     R7,A
00CC EF                MOV     A,R7
00CD 5480              ANL     A,#080H
00CF FF                MOV     R7,A
00D0 7E00              MOV     R6,#00H
00D2 EF                MOV     A,R7
00D3 4E                ORL     A,R6
00D4 6049              JZ      ?C0130
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1102
00D6 900000      R     MOV     DPTR,#ep
00D9 E0                MOVX    A,@DPTR
00DA FF                MOV     R7,A
00DB EF                MOV     A,R7
00DC 75F00B            MOV     B,#0BH
00DF A4                MUL     AB
00E0 2400        E     ADD     A,#LOW USB_EP+01H
00E2 F582              MOV     DPL,A
00E4 E4                CLR     A
00E5 3400        E     ADDC    A,#HIGH USB_EP+01H
00E7 F583              MOV     DPH,A
00E9 E0                MOVX    A,@DPTR
00EA FF                MOV     R7,A
00EB EF                MOV     A,R7
00EC B40118            CJNE    A,#01H,?C0131
                                           ; SOURCE LINE # 1103
                                           ; SOURCE LINE # 1104
00EF 900000      R     MOV     DPTR,#ri
00F2 E0                MOVX    A,@DPTR
00F3 FF                MOV     R7,A
00F4 7E00              MOV     R6,#00H
00F6 EF                MOV     A,R7
00F7 240E              ADD     A,#0EH
00F9 FF                MOV     R7,A
00FA EE                MOV     A,R6
00FB 3460              ADDC    A,#060H
00FD FE                MOV     R6,A
00FE 8F82              MOV     DPL,R7
0100 8E83              MOV     DPH,R6
0102 740C              MOV     A,#0CH
0104 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 88  

                                           ; SOURCE LINE # 1105
0105 805F              SJMP    ?C0133
0107         ?C0131:
                                           ; SOURCE LINE # 1107
                                           ; SOURCE LINE # 1108
0107 900000      R     MOV     DPTR,#ri
010A E0                MOVX    A,@DPTR
010B FF                MOV     R7,A
010C 7E00              MOV     R6,#00H
010E EF                MOV     A,R7
010F 240E              ADD     A,#0EH
0111 FF                MOV     R7,A
0112 EE                MOV     A,R6
0113 3460              ADDC    A,#060H
0115 FE                MOV     R6,A
0116 8F82              MOV     DPL,R7
0118 8E83              MOV     DPH,R6
011A 740D              MOV     A,#0DH
011C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1109
                                           ; SOURCE LINE # 1110
011D 8047              SJMP    ?C0133
011F         ?C0130:
                                           ; SOURCE LINE # 1112
                                           ; SOURCE LINE # 1114
011F 900000      R     MOV     DPTR,#ep
0122 E0                MOVX    A,@DPTR
0123 FF                MOV     R7,A
0124 EF                MOV     A,R7
0125 75F00B            MOV     B,#0BH
0128 A4                MUL     AB
0129 2400        E     ADD     A,#LOW USB_EP+01H
012B F582              MOV     DPL,A
012D E4                CLR     A
012E 3400        E     ADDC    A,#HIGH USB_EP+01H
0130 F583              MOV     DPH,A
0132 E0                MOVX    A,@DPTR
0133 FF                MOV     R7,A
0134 EF                MOV     A,R7
0135 B40118            CJNE    A,#01H,?C0134
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1116
0138 900000      R     MOV     DPTR,#ri
013B E0                MOVX    A,@DPTR
013C FF                MOV     R7,A
013D 7E00              MOV     R6,#00H
013F EF                MOV     A,R7
0140 240E              ADD     A,#0EH
0142 FF                MOV     R7,A
0143 EE                MOV     A,R6
0144 3460              ADDC    A,#060H
0146 FE                MOV     R6,A
0147 8F82              MOV     DPL,R7
0149 8E83              MOV     DPH,R6
014B 7408              MOV     A,#08H
014D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1117
014E 8016              SJMP    ?C0133
0150         ?C0134:
                                           ; SOURCE LINE # 1119
                                           ; SOURCE LINE # 1120
0150 900000      R     MOV     DPTR,#ri
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 89  

0153 E0                MOVX    A,@DPTR
0154 FF                MOV     R7,A
0155 7E00              MOV     R6,#00H
0157 EF                MOV     A,R7
0158 240E              ADD     A,#0EH
015A FF                MOV     R7,A
015B EE                MOV     A,R6
015C 3460              ADDC    A,#060H
015E FE                MOV     R6,A
015F 8F82              MOV     DPL,R7
0161 8E83              MOV     DPH,R6
0163 7409              MOV     A,#09H
0165 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1121
                                           ; SOURCE LINE # 1122
0166         ?C0133:
                                           ; SOURCE LINE # 1123
0166 120000      E     LCALL   USB_InitNoDataControlTransfer
0169 900000      R     MOV     DPTR,#requestHandled
016C EF                MOV     A,R7
016D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1124
016E         ?C0129:
                                           ; SOURCE LINE # 1126
016E 900000      R     MOV     DPTR,#requestHandled
0171 E0                MOVX    A,@DPTR
0172 FF                MOV     R7,A
                                           ; SOURCE LINE # 1127
0173         ?C0136:
0173 22                RET     
             ; FUNCTION USB_ClearEndpointHalt (END)

             ; FUNCTION USB_ValidateAlternateSetting (BEGIN)
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1149
0000 900000      R     MOV     DPTR,#requestHandled
0003 7401              MOV     A,#01H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1154
0006 906004            MOV     DPTR,#06004H
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B 900000      R     MOV     DPTR,#interfaceNum
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1156
0010 900000      E     MOV     DPTR,#USB_configuration
0013 E0                MOVX    A,@DPTR
0014 FF                MOV     R7,A
0015 EF                MOV     A,R7
0016 14                DEC     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _?USB_GetConfigTablePtr
001B 900000      R     MOV     DPTR,#pTmp
001E EE                MOV     A,R6
001F F0                MOVX    @DPTR,A
0020 A3                INC     DPTR
0021 EF                MOV     A,R7
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1157
0023 900000      R     MOV     DPTR,#pTmp
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 90  

0026 E0                MOVX    A,@DPTR
0027 FE                MOV     R6,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B 8F82              MOV     DPL,R7
002D 8E83              MOV     DPH,R6
002F A3                INC     DPTR
0030 120000      E     LCALL   ?C?PLDCODE
0033 E9                MOV     A,R1
0034 2404              ADD     A,#04H
0036 F9                MOV     R1,A
0037 EA                MOV     A,R2
0038 3400              ADDC    A,#00H
003A FA                MOV     R2,A
003B 120000      E     LCALL   ?C?CLDPTR
003E FF                MOV     R7,A
003F 900000      R     MOV     DPTR,#currentInterfacesNum
0042 EF                MOV     A,R7
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1159
0044 900000      R     MOV     DPTR,#currentInterfacesNum
0047 E0                MOVX    A,@DPTR
0048 FF                MOV     R7,A
0049 900000      R     MOV     DPTR,#interfaceNum
004C E0                MOVX    A,@DPTR
004D FE                MOV     R6,A
004E EE                MOV     A,R6
004F C3                CLR     C
0050 9F                SUBB    A,R7
0051 500B              JNC     ?C0138
0053 900000      R     MOV     DPTR,#interfaceNum
0056 E0                MOVX    A,@DPTR
0057 FF                MOV     R7,A
0058 EF                MOV     A,R7
0059 C3                CLR     C
005A 9402              SUBB    A,#02H
005C 4007              JC      ?C0137
005E         ?C0138:
                                           ; SOURCE LINE # 1160
                                           ; SOURCE LINE # 1161
005E 900000      R     MOV     DPTR,#requestHandled
0061 E4                CLR     A
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1162
0063 8038              SJMP    ?C0139
0065         ?C0137:
                                           ; SOURCE LINE # 1164
                                           ; SOURCE LINE # 1166
0065 900000      R     MOV     DPTR,#interfaceNum
0068 E0                MOVX    A,@DPTR
0069 FF                MOV     R7,A
006A 7400        E     MOV     A,#LOW USB_interfaceSetting
006C 2F                ADD     A,R7
006D F582              MOV     DPL,A
006F E4                CLR     A
0070 3400        E     ADDC    A,#HIGH USB_interfaceSetting
0072 F583              MOV     DPH,A
0074 E0                MOVX    A,@DPTR
0075 FF                MOV     R7,A
0076 900000      R     MOV     DPTR,#interfaceNum
0079 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   USB_STD                                                               02/21/2017 15:19:25 PAGE 91  

007A FE                MOV     R6,A
007B 7400        E     MOV     A,#LOW USB_interfaceSetting_last
007D 2E                ADD     A,R6
007E F582              MOV     DPL,A
0080 E4                CLR     A
0081 3400        E     ADDC    A,#HIGH USB_interfaceSetting_last
0083 F583              MOV     DPH,A
0085 EF                MOV     A,R7
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1167
0087 906002            MOV     DPTR,#06002H
008A E0                MOVX    A,@DPTR
008B FF                MOV     R7,A
008C 900000      R     MOV     DPTR,#interfaceNum
008F E0                MOVX    A,@DPTR
0090 FE                MOV     R6,A
0091 7400        E     MOV     A,#LOW USB_interfaceSetting
0093 2E                ADD     A,R6
0094 F582              MOV     DPL,A
0096 E4                CLR     A
0097 3400        E     ADDC    A,#HIGH USB_interfaceSetting
0099 F583              MOV     DPH,A
009B EF                MOV     A,R7
009C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1168
009D         ?C0139:
                                           ; SOURCE LINE # 1170
009D 900000      R     MOV     DPTR,#requestHandled
00A0 E0                MOVX    A,@DPTR
00A1 FF                MOV     R7,A
                                           ; SOURCE LINE # 1171
00A2         ?C0140:
00A2 22                RET     
             ; FUNCTION USB_ValidateAlternateSetting (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6132    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =      2      38
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
